[toc]

# 一. 计算机网络体系结构

知识预览：

<img src="https://image.sybblogs.fun/img-common/202402151754334.png" alt="计网体系结构" style="zoom: 25%;" />

网络：指的是网一样的东西或网状的系统。如：电信网络，通过电话线链路连接起来的网络。

计算机网络：是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现**资源共享和信息传递**的系统。

<img src="https://image.sybblogs.fun/img-common/202402151800295.png" alt="计算机网络概念" style="zoom:25%;" />

如上图，计算机系统包括各种系统的手机端及电脑端。通过路由设备(也可以是中继器、交换机等)将这些系统用线路连接起来。这里的线路有的可以是逻辑线路，如手机和路由器连接。之后再由于功能完善的软件来实现资源共享和信息传递。同时还要有软件的支撑才能实现每个终端与终端之间的资源共享和信息传递。

简单来说计算机网络是一个互连的、自治的计算机集合。其中互连是指通过通信链路互联互通。自治是终端及各个结点之间是没有主从关系的，是高度自治的。

计算机网络有以下功能：

1. 数据通信

   如：两台电脑之间可以通过邮件传递信息。

2. 资源共享

   同一个计算机网络上的其他计算机可使用某台计算机的计算机资源的行为，可共享硬件、软件、数据等资源。

   硬件共享如：网络打印机。软件共享如：如远程访问另一台电脑上的软件。数据共享如：上传和下载文件。

3. 分布式处理

   多台计算机各自承担同一工作任务的不同部分。如：Hadoop分布式平台。

4. 提高可靠性

   分布式引申功能，可以提高网络可靠性。采用分布式处理如果网络中的一台主机宕机，就可以用另一台机器(替代机)来实现宕机计算机的任务。

5. 负载均衡

   也是分布式引申功能。由于使用了分布式可以让各个计算机之间更加亲密执行任务更加高效。

计算机网络的发展：

- 第一阶段

  美国国防部高级研究计划局(ARPA)设计一个分散的指挥系统，阿帕网：

  <img src="https://image.sybblogs.fun/img-common/202402151814583.png" alt="阿帕网" style="zoom:33%;" />

  如上图由四个分布在不同地区的结点组成。通过无线分组交换网及卫星通信网连接。可以看到如果其中一个结点失去连接，其他结点仍然可以继续通信。

  但是这样做有一个弊端：阿帕网只可以连接同一类型的网络。随着信息量的增长，希望可以实现不同网络的互连，互联网诞生了。

  之后在1983年阿帕网接受TCP$/$IP，选定Internet为主要的计算机通信系统。通过这个协议可以实现不同网络的连接。其中IP协议是基本的通信协议。TCP是帮助IP实现可靠传输的协议。所以这两个协议联合起来就可以实现网路的互联。即因特网。

  因特网也是现在全球范围内最大的互联网。所以上面的阿帕网就是因特网的前身。

  所以网络把许多计算机连接在一起，而互联网则把许多网络连接在一起，因特网是世界上最大的互联网。

- 第二阶段(三级结构)

  1985年起，美国国家科学基金会NSF围绕$6$个大型计算机中心建设计算机网络，即国家科学基金网NSFNET。

  这种网络是三层结构：

  第一层是企业网，这一层次用户如果想连接到互联网上需要再连接到第二层的地区网。并且第二次地区网会再连接到第一层的主干网。

  <img src="https://image.sybblogs.fun/img-common/202402151827939.png" alt="三级结构" style="zoom: 25%;" />

  随着网络发展越来越多的用户都可以连接到这个互联网中。所以就会导致网络的信息量急剧增大。政府决定把这些主干网交给一些私人公司来经营，并且开始对介入因特网的单位进行收费。这也就到了第三阶段。

- 第三阶段(多层次ISP结构)

  ISP即因特网服务提供者$/$因特网服务提供商，是一个向广大用户综合提供互联网接入业务、信息业务、和增值业务的公司，如中国电信、中国联动、中国移动等。且在层次上分为主干ISP、地区ISP和本地ISP

  <img src="https://image.sybblogs.fun/img-common/202402151835360.png" alt="多层次ISP结构" style="zoom:33%;" />

  其实这里也是沿用了之前的三层结构，只不过是把网络的管理权分散。用户通过支付给ISP服务费(网费)之后才能使用ISP服务，以申请到一个IP地址，就可以常有网络。

  具体做法是，全世界会有一个IP池，由一个因特网管理机构尽心管理。如果ISP供应商要给用户提供服务并分配IP，首先就要从IP池中申请一个IP地址，然后再分配给用户。这样每个用户就会有一个IP地址。

  只要每个本地ISP都安装路由器连接到了地区ISP，而地区ISP也由路由器连接到主干ISP，就可以完成因特网中所有数据分组转发任务。

  但是随着流量激增，人们对于网络要求也越来越高。就开始研究怎么更快地转发数据和分组。因此就诞生了上图地因特网交换点(IXP)。原本$A$和$B$两台计算机如果要通信的话，$A$计算机就需要经过一层又一层的ISP结构，通过本地ISP到地区ISP再到主干ISP。之后再通过主干ISP到地区ISP再到本地ISP，最后发送给$B$计算机。有了这个因特网交换点，就可以允许这两个网络直接相连，而不需要第三个网络来转发分组了。这个IXP出现也大大提高了信息传递和资源共享的速度。

计网概念功能总结：

<img src="https://image.sybblogs.fun/img-common/202402151852644.png" alt="计网概念功能总结" style="zoom:33%;" />

## 1. 计算机网络的组成

首先从组成部分上：计算机网络是由硬件、软件、协议(一系列规则和约定的集合)组成的。

硬件即终端系统和中间设备(如：路由器、交换机等)。软件就是在端系统上应用，甚至中间设备上也有软件。协议就是指定了各个硬件之间的通信的规则，计算机网络每个层次都有很多协议，根据这些协议就可以规定数据如何封装、打包、传输等。

<img src="https://image.sybblogs.fun/img-common/202402151856268.png" alt="计网组成" style="zoom:33%;" />

从工作方式上：可以把计算机网络分为边缘部分和核心部分。

- 边缘部分

  边缘部分就是一些端系统组成，这些端系统不仅包括计算机，还包括服务器，网络摄像头等设备。这些设备可以实时捕获信息，并将信息实时发布出去，这些都是边缘部分。

- 核心部分

  光有边缘部分还不够，还需要核心部分提供服务，边缘系统才能实现端系统与端系统之间的通信。核心部分包括路由器中间设备还有一些网络连接起来。核心部分和边缘部分连接起来就构成了计算机网络。

注意这里系统之间的通信是进程之间的通信。那么两个端系统进程之间的通信主要包括两种方式：

1. C$/$S方式

   即客户端到服务器端的通信方式。是因特网最传统最常用的服务。这种方式，多个端系统之间的进程呈现出服务与被服务的关系。

   与之对应还有一种B$/$S通信方式。这种方式与C$/$S类似，只不过客户端换成了浏览器。用户通过浏览器向目标服务器发送请求，之后服务器受到请求后将响应数据再发送给浏览器。

2. P2P方式

   即对等连接。这种情况下端系统身份都是对等的，都有提供服务的服务者和使用服务的享受者(客户端)的身份。

   如：磁力链下载。假如有$A,B,C,D$四台电脑，$A$下载$500$MB视频。P2P下载可以将$A$的$500$MB文件切分为几个大小不等$/$相等的数据块，$B$电脑会先拿到一部分数据块，如$250$MB。之后$B$又马上给$C$传输$200$MB，同时$B$还会继续接收$A$的块数据。$C$之后会把$150$MB分给$D$。同时$D$也可以向$A,B$继续发送请求获取数据块。

   所以可看到$B,C,D$即使客户端又是服务器。	

之前提到过计算机网路有两个功能分别是数据通信及资源共享。所以可以从功能组成方面分为：通信子网、资源子网。

- 通信子网可以实现数据通信。

  之前提到过计算机网络可以按照层次划分，在OSS参考模型中从上到下划分为七层：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。

  其中下三层即网络层、数据链路层、物理层代表的就是通信子网，因为是由各种传输介质、通信设奋、相应的网络协议组成。

  通信子网可以让这个网络具有传输、交换、控制和存储功能，同时也能实现联网计算机之间的通信。

  这三层实现计算机通信设备有：网络层(路由器)、数据链路层(交换机、网桥)、物理层(集线器、中继器)。

  <img src="https://image.sybblogs.fun/img-common/202402151945463.png" alt="通信子网" style="zoom:33%;" />

- 资源子网可以实现资源共享$/$数据处理。

  上面三层，即应用层、表示层、会话层是资源子网。能实现资源共享功能的设备和软件的集合。

  资源子网可以向网络用户提供共享其他计算机上的硬件资源、软件资源和数据资源等服务。

  <img src="https://image.sybblogs.fun/img-common/202402151948705.png" alt="资源子网" style="zoom:33%;" />

其实可以理解为上三层是对数据的封装和处理。下三层就是将这个数据送往上层。中间的传输层起到很重要的媒介作用，其大致作用是为了弥补上三层要求的服务和网络层提供的服务之间的差距，并且向高层用户屏蔽通信子网当中的一些细节，可以说传输层起到了承上启下的作用。

## 2. 计算机网络的分类

计算机网络按照性质不同可以分为以下几类：

- 按分布范围：分广域网WAN、城域网MAN、局域网LAN、个人区域网PAN

  最广的范围是广域网，分布范围从几十到几千公里，是因特网的核心部分。它的任务是通过长距离来发送数据。

  城域网能覆盖一个城市。而局域网在地理上是一个较小的范围，如：一个学校、一个办公楼等。

  最后个人区域网就是将如电脑、手表等通过无线技术连接起来的网络，也成为无线个人区域网。

  这里主要学习广域网和局域网，这两个网络通常使用广播技术。这种网络类型不仅仅是地理上的差别，更重要的是看使用的是什么技术，广域网用的是交换技术、局域网用的是广播技术。

- 按照使用者分：公用网、专用网。

  公用网如中国移动、中国联通等。

  专用网(内网)是某个部门或者行业为了特殊用途需要构建的网络。如：军队、企业部门等。

- 按照交换技术来分：电路交换、报文交换、分组交换。

  这几种方式讲的是数据传输方式。

  电路交换如：打电话。原理是首先会建立连接，占用一个通信资源。之后通话过程中会一直占用这个资源。最后打完电话后会释放链接归还通信资源。有这三个步骤的交换方式是电路交换。所以电路交换特点就是在通话的全部时间内通话的两个人是完全占有中间的资源不能被别人使用。

  报文交换和分组交换技术特点是都使用存储转发技术。主要区别是主体不一样：分组就是将报文数据切开分成不同的组。报文就是一个完整的文件。

  报文交换和分组交换存储转发就是现在要发送的数据首先要放到路由器上传输，此时路由器会存下来这个数据来检查要往哪发，之后再转发出去转发给正确的路由方向。

- 按照拓扑结构可以分为以下结构：

  <img src="https://image.sybblogs.fun/img-common/202402152013598.png" alt="拓扑结构分类" style="zoom:33%;" />

  拓扑结构其实就是把网络中结点(可以是路由器、交换机这些中间设备，也可以是端系统中的主机)，变成上图中的小圆圈。把通信链路抽象成一条线。将圆圈和线结合在一起就是上面拓扑结构。

  常见的拓扑结构如上图。可以看到总线型所有的结点都连接在一条总线上。星型就是由中间结点向四周结点四散。环形就是将结点链接成环状。最后的网状型就是现在常用的拓扑结构，常用于广域网。

- 按照传输技术分：广播式网络、点对点网络

  广播式网络是共享公共通信信道，常应用在局域网中。用的是总线型的拓扑结构。特点是一个结点(主机)发送消息，其他都可以收到。

  点对点网络是使用分组存储转发和路由选择机制。常应用在广域网中，广域网基本都是点对点的网络。指的是在网络当中如果两台主机需要通信，但是没有直接连接，就需要很多中间结点实现分组存储转发和路由的选择。特点是发送消息只有被接受方可以听到，其他结点都接受不到消息。

计算机网络组成和分类总结：

<img src="https://image.sybblogs.fun/img-common/202402152025119.png" alt="计算机网络组成和分类总结" style="zoom:33%;" />

## 3. 标准化工作及相关组织

标准化对计算机网络至关重要。要实现不同厂商的硬、软件之间相互连通，必须遵从统一的标准。

标准分类有：法定标准(由权威机构制定的正式的、合法的标准)，如：OSI。事实标准(某些公司的产品在竞争中占据了主流，时间长了，这些产品中的协议和技术就成了标准)，如：TCP$/$IP。

RFC是一种因特网标准形式，即只要是因特网标准就一定是RFC的形式，但是不代表所有的RFC都是因特网标准。

RFC要上升为因特网正式标准的四个阶段：

1. 因特网草案( Internet Draft)这个阶段还不是RFC文档。
2. 建议标准( Proposed Standard)从这个阶段开始成为RFC文档。可以发布到网上让其进行完善。
3. 因特网标准

标准化工作相关组织：

国际标准化组织ISO：主要贡献是建立了OSI参考模型、HDLC协议。

国际电信联盟ITU：制定了通信准则。

国际电气电子工程师协会IEEE：是一个学术机构，建立了IEEE802系列标准、5G协议。

Internet工程任务组IETF：负责因特网相关标准的制定。

标准化工作及组织总结：

<img src="https://image.sybblogs.fun/img-common/202402161359738.png" alt="标准化工作及组织总结" style="zoom:33%;" />

## 4. 性能指标

计算机网络性能指标由：速率、带宽、吞吐量、时延、时延带宽积、往返时间RTT、利用率决定。前三个指标密切相关，其中的核心是吞吐量。

### 4.1 速率

速率即数据率或称数据传输率或比特率。指连接在计算机网络.上的主机在数字信道上传送数据位数的速率。

这里的比特是计算机中数据量的单位。单位是b$/$s，kb$/$s，Mb$/$s，Gb$/$s，Tb$/$s。

<img src="https://image.sybblogs.fun/img-common/202402161421019.png" alt="速率" style="zoom:33%;" />

假如发送端要发送十位比特数据$0101010101$给接收端。这里假设可以在一秒内发送给接收端，则就说明速率是$10$b$/$s。

换算单位：

> 千1kb$/$s$=10^3$b$/$s
>
> 兆1Mb$/$s$=10^3$kb$/$s$=10^6$b$/$s 
>
> 吉1Gb$/$s$=10^3$Mb/s$=10^6$kb$/$s$=10^9$b$/$s
>
> 太1Tb$/$s$=10^3$Gb$/$s$=10^6$Mb$/$s$=10^9$kb$/$s$=10^{12}$b$/$s

注意这里的是速率换算，其实基本换算就是$10^3$。而在存储容量上换算是：$1$Byte(字节)$=8$bit(比特)。字节是存储容量中最常用的单位。且容量单位的$b$是大写的$B$，基本换算是$2^{10}$。

### 4.2 带宽

"带宽"原本指某个信号具有的频带宽度，即最高频率与最低频率之差，单位是赫兹(Hz)。

在很长一段时间内通信的主干线路传送的都是模拟信号。选择传送的都是$0/1$这样的数字信号。所以说表示通信线路允许通过信号的频带范围就叫做线路的带宽。

在计算机网络中，带宽用来表示网络的通信线路传送数据的能力，通常是指单位时间内从网络中的某一点到另一点所能通过的"最高数据率"单位是"比特每秒"，b$/$s，kb$/$s，Mb$/$s，Gb$/$s。

==带宽也可以理解为网络设备所支持的最高速度==。

<img src="https://image.sybblogs.fun/img-common/202402161455151.png" alt="链路" style="zoom: 25%;" />

假如有如上图所示的一条链路(信道)，并且这个链路的带宽是$1$Mb$/$s，即一秒可以往链路上传输发送$1$Mb的数据量。也就是主机在$1$us内可向链路发$1$bit数据。并且在这个链路上的传播速率为$2\times10^8$m$/$s，也就是说电磁波$1$us可以向前传播$200$m。且链路长$600$m，每隔$200$米分个段。注意：信号是以电磁波为载体在链路上进行传输的。

在第一微秒，交换机(或主机)往链路上发送$1$bit的数据。

<img src="https://image.sybblogs.fun/img-common/202402161501607.png" alt="带宽" style="zoom: 25%;" />

再经过$1$us，第一个bit在这$1$us往前移动$200$m，交换机又往链路上传输$1$bit。

<img src="https://image.sybblogs.fun/img-common/202402161502978.png" alt="带宽2" style="zoom: 25%;" />

同理$3$us时，情况如下：

<img src="https://image.sybblogs.fun/img-common/202402161503056.png" alt="带宽3" style="zoom: 25%;" />

如果链路带宽是$2$Mb$/$s，即$1$us内可向链路发$2$bit数据。则$3$us后链路状况如下：

<img src="https://image.sybblogs.fun/img-common/202402161506079.png" alt="带宽4" style="zoom: 25%;" />

这就是带宽不同所导致的区别。如果带宽变大在单位时间内往链路上注入的数据量会变多，但是不能影响传播速度。

### 4.3 吞吐量

表示在单位时间内通过某个网络(或信道、接口)的数据量。单位b$/$s，kb$/$s，Mb$/$s等。

吞吐量受网络的带宽或网络的额定速率的限制。即指某个网络设备每秒中能通过的最高数据量。

<img src="https://image.sybblogs.fun/img-common/202402161529604.png" alt="吞吐量" style="zoom: 25%;" />

这里的交换机可以理解为服务器与客户端之间的中介。上图中客户端计算机与交换机之间的链路带宽有$100$Mb$/$s，是百兆口，即计算机往外发送的速率最快是$100$Mb$/$s。交换机同样往外发送的速率最快是$100$Mb$/$s。当然这只是发送的速率，而接受速率受的影响因素很多，而且还要看缓存大小。

假如说当前客户端主机要访问两台服务器。第一个服务器速率是$20$Mb$/$s，也就是说这个台服务器$1$s最多能传送$20$Mb的数据。第二个服务器速率是$10$Mb$/$s。这个速率受到的是服务器自身的限制，与客户端计算机无关。所以这里也可以看到客户端计算机的带宽只是一种理论上的最大值，是一种传送速率的理想状态。也可以计算出这台电脑在这一条链路上的吞吐率是$20+10=30$Mb$/$s。即一秒钟这样一台链路可以受到两台服务器发送过来的$20$MB$/$s。故，**吞吐量就是把所有的链路速率加和**。而上面的，链路带宽是一台计算机理想状态下每秒能接收的最大吞吐量。

### 4.4 时延

指数据(报文$/$分组$/$比特流)从网络(或链路)的一端传送到另一端所需的时间。也叫延迟或迟延。单位是$s$。

这个时延包括四大类：发送时延(传输时延)、传播时延、排队时延、处理时延。

<img src="https://image.sybblogs.fun/img-common/202402161549126.png" alt="时延分类" style="zoom:33%;" />

如果题中要求总时延，如果题中都考虑到，则需要将四种时延全部加和。

下面讲解着四种时延出现位置：

<img src="https://image.sybblogs.fun/img-common/202402161551886.png" alt="时延例子" style="zoom:33%;" />

两个主机之间通过链路(路由器等)进行连接。

- 发送时延

  首先是发送时延：从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间。

  假如$A$主机现在有$10$位比特$0101010101$，并且要发送给$B$。首先要经过的就是发送时延，具体是$A$主机将十位比特一个一个发送到链路上，直到最后一位发送到链路上，这段时间就是发送时延。

  <img src="https://image.sybblogs.fun/img-common/202402161555792.png" alt="时延例子2" style="zoom:33%;" />

  可以看到发送时延的快慢和两个因素有关：一个是发送数据的比特位长度。另一个是发送快慢。则发送时延公式：
  $$
  发送时延=\frac{数据长度}{信道带宽(发送速率)}
  $$
  <img src="https://image.sybblogs.fun/img-common/202402161604377.png" alt="时延例子3" style="zoom:33%;" />

  假设$A$主机的带宽是$10$b$/$s，那么发送这十位的比特数据需要的时间就是$10/10$b$/$s$=1$s。即$A$主机将这十位比特发送到信道上的发送时延是$1$s。

- 传播时延

  传播时延是电磁波在信道上传播一定距离所花费的时间。所以传播时延取决于电磁波传播速度和链路长度。

  上面的例子就是将$A$主机发送的十位比特，传送到中介路由器上所花费的时间。

  <img src="https://image.sybblogs.fun/img-common/202402161608617.png" alt="时延例子4" style="zoom: 33%;" />

  计算公式如下：
  $$
  传播时延=\frac{信道长度}{电磁波在信道上的传播速率}
  $$
  假设电磁波在这条信道上传播速率是$10$m$/$s。并且主机$A$和主机$B$之间的距离是$100$m，则$A$主机发送给$B$主机传播时延是$\frac{100m}{10m/s}=10$s。

  所以传播时延和上面的发送时延区别是，发送时延发生的是在主机内部的，而传播时延是发生在机器外的信道上的。

- 排队时延与处理时延

  指的是等待输出$/$入链路可用所需要的等待时间。

  <img src="https://image.sybblogs.fun/img-common/202402161614970.png" alt="时延例子5" style="zoom:33%;" />

  如上图，假如这十个比特已经在路由器上了，但是路由器此时要处理的数据很多，所以会让这十位比特先等待，这个等待其实就是将这些数据放到路由器的缓存上，在缓冲阻塞这段时间就是排队时延。如果阻塞时间结束，路由器就会对这十位比特数据进行转发工作，同时转发也需要一定的时间，因为路由器要识别这十位数据要发送到哪，别还要验证这个数据有没有出错。而识别数据的发送位置和验证数据有没有出错时间就是处理时延。

  所以在路由器上发生的是排队时延和处理时延。

综上所述，如果主机的带宽变为$100$b$/$s，此时发送时延就会变低。另外还需要对高速链路有一个正确理解：即发送速率提高并不会影响电磁波传播速率。上图中链接的线路基本是用光纤或者同轴电缆，这些介质传播速度基本都是$2\times 10^8$m$/$s。所以这里的高速是提高了发送速率(带宽)，减少了发送时延。但是传播时延和传播速率都是不变的。

### 4.5 时延带宽积

指的是时延和带宽的乘积：
$$
时延带宽积=传播时延\times带宽
$$
带宽是发送端在发送数据时可以达到的最高速率，强调的是发送速率，单位是b$/$s。传播时延是指电磁波在信道上传播一定距离所花费的时间，单位是$s$。因此时延带宽积单位就是$s·b/s=b$。故时延带宽积是一个描述信息量的属性。

<img src="https://image.sybblogs.fun/img-common/202402161640366.png" alt="时延带宽积例子" style="zoom:33%;" />

$A,B$两台主机进行通信，中间有一条链路$/$信道，可以是光纤、同轴电缆等。这条链路的长定义为传播时延。横街面是带宽。

传播时延指一个比特从主机$A$到主机$B$走过一个信道花费的时间。由于第一个比特在信道上传输的时候其他比特也紧跟其后传输，直到第一个比特发送到主机$B$为止，信道中所有的比特数就是时延带宽积。

<img src="https://image.sybblogs.fun/img-common/202402161644744.png" alt="时延带宽积例子2" style="zoom: 33%;" />

时延带宽积又称为以比特为单位的链路长度。即"某段链路现在有多少比特"。是一个数据容量的指标。

### 4.6 往返时延RTT

指的是从发送方发送数据开始，到发送方收到接收方的确认(接收方收到数据后立即发送确认)，总共经历的时延。

开始是发送方的第一个比特位刚放到信道上的时间。结束是接收到受到发送方的第一个比特为止。这一段时间是往返时延RTT。

而RTT越大，在收到确认之前，可以发送的数据越多。

RTT包括：

1. 往返的传播时延

   传播时延指的是电磁波在信道上传输一段距离所花费的时间。往返的传播时延$=$传播时延$*2$。

2. 末端处理时间

   通常是接收方在接受到数据后会对数据进行一个处理，然后再发出一个确认帧。

所以RTT不包括传输时延，也就是不包括主机将数据放到信道上的时间。

### 4.7 利用率

利用率分两种：信道利用率和网络利用率。

计算机网络中如果主机$A$和主机$B$，进行通信，两个主机之间的链路就可以看利用率高低，主要是看链路上多长时间是有数据的。如果两个主机间的链路上一直都有数据传输，则链路利用率高。

故==信道利用率==计算：
$$
信道利用率=\frac{有数据通过的时间}{有数据通过时间+无数据通过时间}
$$
网络利用率就是将所有信道的利用率加权再求平均值。

<img src="https://image.sybblogs.fun/img-common/202402161709068.png" alt="利用率" style="zoom:33%;" />

上图是时延与利用率的关系。可以看到利用率越高时延越大。如果信道利用率很高，则时延也会很高，会导致传输数据速率会降低。

性能指标总结：

<img src="https://image.sybblogs.fun/img-common/202402161712148.png" alt="性能指标总结" style="zoom:33%;" />

## 5. 分层结构

假如两台计算机要实现资源共享

<img src="https://image.sybblogs.fun/img-common/202402161721661.png" alt="分层原因" style="zoom:33%;" />

发送文件前要完成以下的工作：

1. 发起通信的计算机必须将数据通信的通路进行激活。

   即计算机会发出一些命令，保证要传送的数据能够在这条通路上正确的发送，及接受。

2. 高速网络如何识别目的主机

3. 发起通信的计算机要查明目的主机是否开机，并且与网络连接正常。

4. 发起通信的计算机要弄清楚，对方计算机中文件管理程序是否已经做好准备工作。

   准备工作分为两种：一种是主机是否做好接收文件的准备。第二个是接受主机是否有空间存储要来接受的文件。

5. 确保差错和意外可以解决

除了上面五个工作外，计算机在发送文件前要处理工作还有很多。这么多的问题放在一起很难同时解决，所以计算机网络要将这些大问题分解为一系列的小问题。故这就是计算机网络要分层的原因。

分层结构中有很多抽象的名词，这里进行解释：

- 实体

  实体指的是每一层当中活动元素叫做实体。且在同一层的实体称为对等实体。

- 协议

  一系列的规则与约定。协议是水平方向的，及对等实体之间才有协议。

- 接口

  每两层之间的通道就是接口。在计算机网络中接口是逻辑上的。

- 服务

  指的是每两个层次之间提供的功能称为服务。在计算机网络中上层使用下层提供的服务。

分层的基本原则：

1. 各层之间相互独立，每层只实现一种相对独立的功能。
2. 每层之间界面自然清晰，易于理解，相互交流尽可能少。
3. 分层时候结构上可分割开。每层都采用最合适的技术来实现。
4. 保持下层对上层的独立性，上层单向使用下层提供的服务。
5. 整个分层结构应该能促进标准化工作。这也是分层的优点之一。

<img src="https://image.sybblogs.fun/img-common/202402161735425.png" alt="分层结构" style="zoom: 50%;" />

上图是计算机网络中正式的分层结构。其中网络和各层单元数据关系也进行了展示。根据上图解释上面各个名词：

1. 实体：第$n$层中的活动元素称为$n$层实体。同一层的实体叫对等实体。

   如上图主机$A$的第五层就可以称为一个实体，与之对等的主机$B$的第五层可以称为对等实体。这两个的层次就是对等层。

2. 协议：为进行网络中的对等实体数据交换而建立的规则、标准或约定称为网络协议。

   这样一组或一系列的协议就可以规定某一个层次的功能。这里的协议是水平的。如上图第四层和第五层的协议不一样，也不能相互使用。

   协议有三大要素：

   语法：规定传输数据的格式。如：$01010001111000$这一串二进制，规定其只能用$0/1$进行传输。其次数据要从哪个地方分割等这就是语法所规定的内容。

   语义：规定所要完成的功能。如：$01010001111000$这一串二进制序列，按照语法对其进行分段，而每一段代表的意义不同，即语义不同。

   同步：规定各种操作的顺序。

3. 接口(访问服务点SAP)：上层使用下层服务的入口。如上图的$H2$。

4. 服务：下层为相邻上层提供的功能调用。因为是上下两层之间的服务，所以是垂直的。

最后，可以将网路各层的数据单元进一步抽出来，分析各个层之间的包含关系：

<img src="https://image.sybblogs.fun/img-common/202402161752658.png" alt="分层结构各层包含关系" style="zoom:33%;" />

首先是SDU服务数据单元：为完成用户所要求的功能而应传送的数据。

还有PCI协议控制信息：控制协议操作的信息。可以理解为一些控制信息。

PDU协议数据单元：对等层次之间传送的数据单位。PCI$+$SDU$=$PDU。如上图，上一层计算出的PDU作为下一层的SDU值使用。

总结：

网络体系结构是从**功能**上描述计算机网络结构。计算机网络体系结构简称网络体系结构，是分层结构。

每层遵循某个$/$些网络协议以完成本层功能。计算机网络体系结构是计算机网络的各层及其协议的集合。

> 计算机网络体系结构包括上面？
>
> 它包括计算机网络中的各个层次，以及各个层次需要完成的功能，同时还包括每一层所对应的协议。

第$n$层在向$n+1$层提供服务时，此服务不仅包含第$n$层本身的功能，还包含由下层服务提供的功能。且仅仅在相邻层间有接口，且所提供服务的具体实现细节对上一层完全屏蔽。

体系结构是抽象的，而实现是指能运行的一些软件和硬件。

分层结构总结：

<img src="https://image.sybblogs.fun/img-common/202402161801901.png" alt="分层结构总结" style="zoom:33%;" />

计算机网络分层结构可以分为：$7$层OSI参考模型和$4$层TCP$/$IP参考模型。

$7$层OSI参考模型是法定标准。而$4$层TCP$/$IP参考模型是事实标准，是现在通用的。

<img src="https://image.sybblogs.fun/img-common/202402161809979.png" alt="计算机网络分层结构" style="zoom:33%;" />

根据这两种模型，就可以总结出一个新的$5$层体系结构，这五层结构主要是为了在学习中更加便于理解产生的。

### 5.1 OSI参考模型

四层和五层模型都是基于七层OSI参考模型。

为了解决计算机网络复杂的大问题，将大问题分成一个一个小问题，因此就产生了分层结构，且每一层都是按功能来分的。

根据这个分层，早起每个公司都有自己的网络体系结构。为了支持这些支持异构网络系统的互联互通。国际标准化组织(ISO) 于1984年提出开放系统互连(OSI) 参考模型。但是这种OSI参考模型只在研发上有很多借鉴意义，而实际市场上是失败的。

OSI参考模型有七层，自上而下分别是：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。

<img src="https://image.sybblogs.fun/img-common/202402161816486.png" alt="OSI七层模型" style="zoom:33%;" />

同时之前提到过计算机网络按照功能可以分为资源子网(负责处理数据)和通信子网(负责数据通信)，通信子网对应的就是七层模型中的下面三层。资源子网就是七层模型的上面三层。而传输层是资源子网和通信子网的接口。

<img src="https://image.sybblogs.fun/img-common/202402161819459.png" alt="OSI七层模型分类" style="zoom:33%;" />

OSI参考模型通信过程：

<img src="https://image.sybblogs.fun/img-common/202402161827713.png" alt="OSI七层模型通信过程" style="zoom:33%;" />

两个主机之间进行通信，如果进行网络通信就一定要有中间系统(路由器)介入。采用OSI模型$A$主机发送数据到$B$主机接收数据需要用到七层中的每一层。而中间系统则需要通信子网三层即可。

<img src="https://image.sybblogs.fun/img-common/202402161830802.png" alt="OSI七层模型通信过程2" style="zoom:25%;" />

物理层有一层传输介质(光纤、电缆等)。且对等层次之间都有一个协议，如：数据链路层和中间系统的数据链路层之间会有协议来规定这两层的功能是一样的。

- 首先$A$主机发送的消息会经过应用层，应用层会给消息附加信息，之后经过的每一层都会给消息附加信息，直到物理层。物理层不会对消息进行太多处理，只是对只有$0/1$比特流转换为电信号的方式传送到传送介质上。
- 接着传输介质会传送到中间系统上，中间系统三层会从下网上依次对主机发送的消息进行还原。这个还原过程其实就是看一下之前对消息进行了哪些操作，接下来这个消息要往哪里送的过程。
- 还原之后，中间系统会从上往下依次再次对消息附加信息。直到物理层上，之后消息会以比特流形式在介质上进行传输。这里默认只有一个中间系统。
- 接着就到了主机$B$，之后从下往上依次还原消息。最后会在应用层还原为原始的消息。

<img src="https://image.sybblogs.fun/img-common/202402161842809.png" alt="OSI七层模型通信过程3" style="zoom:25%;" />

可以看到上面四层就好像直接由主机$A$发送给主机$B$，即直接形成一个端与端之间的连通。所以这四层实现的是**端到端的通信**，即只管自己的目的主机(地址)而不管其他信息。

而下面三层就需要介入中间系统，如果中间系统较多，消息还要继续传递给下一个中间系统。所以这个消息传播过程是**点到点**的。不仅要知道目的主机(地址)还要知道下一步地址。

<img src="https://image.sybblogs.fun/img-common/202402161846005.png" alt="OSI七层模型通信过程4" style="zoom:25%;" />

每一层对数据具体操作如下：

- 应用层

  会将主机$A$的消息进行包装，即为消息添加了一个头部控制信息。头部信息包括一些检验差错的信息、找到下一步消息传送的地址、规定数据包消息的优先级。

  <img src="https://image.sybblogs.fun/img-common/202402161848393.png" alt="OSI七层模型通信过程5" style="zoom:33%;" />

  这里的$DATA$是头部控制信息，$H7$是指第七层应用层。下面每一层结构类似。

- 表示层

  $DATA$数据再加上应用层的头部控制信息之后就形成了第六层表示层的PDU(协议数据单元)。这个PDU加上第六层表示层的头部就形成一个新的PDU

  <img src="https://image.sybblogs.fun/img-common/202402161851486.png" alt="OSI七层模型通信过程6" style="zoom:33%;" />

- 之后继续往下传，本层再加上一个头部信息就是下一层的PDU。直到数据链路层，在加上头部同时还加上了尾部。

  <img src="https://image.sybblogs.fun/img-common/202402161913202.png" alt="OSI七层模型通信过程7" style="zoom: 25%;" />

- 最后的物理层会将这个信息转换为二进制比特信息。

  <img src="https://image.sybblogs.fun/img-common/202402161914342.png" alt="OSI七层模型通信过程8" style="zoom:25%;" />

- 这些信息到了接收消息的主机$B$，由于同等层次用的是一样的协议，所以从下往上依次还原信息。

  <img src="https://image.sybblogs.fun/img-common/202402161917495.png" alt="OSI七层模型通信过程9" style="zoom: 25%;" />

### 5.2 OSI参考模型各层功能和对应重要协议

下面会依次介绍各个层对应的功能和协议。

- 应用层

  应用层是离主机层最近的一层。所以应用层定义是所有能和用户交互产生网络流量的程序，即只要连上网络才能使用的程序就是属于应用层。如：典型应用层服务：文件传输(协议是FTP)、电子邮件(协议是SMTP)、方维网(协议是HTTP)。

- 表示层

  主要用于处理在两个通信系统中交换信息的表示方式。通常是对语法和语义的处理。

  表示层功能如下：

  1. 数据格式变换

     不同主机的编码可能会不一致，所以为了使不同的主机能够进行数据交换，所以就需要表示层实现数据格式交换。类似于翻译官的角色。如：将二进制比特流信息转换为图片等。

  2. 对数据进行加密和解密

  3. 数据的压缩和恢复

     如：视频聊天，图像大小很大，可以先将每一帧的图片进行压缩再发送到信道上，接收主机的表示层会对压缩的图片进行恢复。

  这一层次在五层结构中会被纳入应用层和规划层中。主要协议有：JPEG、ASCII。

- 会话层

  表示层会使用到会话层的服务。向表示层实体$/$用户进程提供建立连接并在连接上有序地传输数据。这是会话，也是建立同步(SYN)。

  假如一个主机打开两个进程，对其中一个进程进行网络请求操作不会影响到另一个进程内的变化。这就是因为每个进程之间都有互相独立的会话。

  更详细功能是：

  1. 建立、管理、终止会话

  2. 使用校验点可使会话在通信失效时从校验点$/$​同步点继续恢复通信，实现数据同步。

     假如要传输一个很长的数据，可以将这个数据分段，每个分段之间可以插入校验点(同步点)。其作用是在通话失败时可以恢复到校验点继续通信。这样就不用再从头开始传送。所以适用于传输大文件。

  会话层主要协议：ADSP、ASP

- 传输层

  传输层是自下而上，第一个作为端到端通信的层次，同时也是上面三层资源子网和下面三层通信子网之间的接口。

  负责主机中两个进程的通信，即端到端(上面三层)的通信。传输单位是报文段或用户数据报。

  传输层四大功能：

  1. 可靠传输、不可靠传输

     有两台主机进行通信，中间有很多路由器构成一个网络

     <img src="https://image.sybblogs.fun/img-common/202402161957176.png" alt="可靠传输" style="zoom:33%;" />

     可靠传输指的是如果发送一个大的文件，这个文件会被切成报文段，一个一个放到链路上进行传输。传送到接收端后，每次接收端都会返回一个确认消息给发送端。只有发送端收到接收端上一个报文确认信息之后才会继续发送下一个报文段。如果接收端一直没有确认消息，发送端会再次发送当前报文段，直到接收端确认后才能发送下一个报文段。这就是可靠传输，一个基于确认机制的过程。

     不可靠传输就是不需要建立连接，发送方会直接给接收方发送消息，不用接收方确认就会继续发送下一段报文。

     通常在发送小数据的时候用不可靠传输。(如微信消息)。

  2. 差错控制

     如发送的报文段失序，丢包等，需要进行纠正。

  3. 流量控制

     如发送端给接收端发送很长一段数据，而接收端接受能力有限，不可能一次性接受完，所以会控制发送方速度。

  4. 复用分用

     复用：多个应用层进程可同时使用下面运输层的服务。(多个用户使用一个IO资源**发送消息**时，我们称之为"**复用**"。)

     分用：运输层把收到的信息分别交付给上面应用层中相应的进程。(多个用户使用一个IO资源**接收消息**时，我们称之为"**分用**" 。)
     
     复用和分用可以理解为，从一座城市的不同商家（进程）发出的快递（数据包）上了同一辆运输车（复用），到了驿站后根据取件码（端口号）让每个收货人（目标进程）取走对应的快递（分用）
  
  主要协议有：TCP、UDP。

- 网络层

  是七层中最重要的层次。主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。

  网络层传输单位是数据报。如果数据报过长就会对数据报进行切割，切割成一个一个分组，再放到链路上进行传递，这样可以使传输的过程更加灵活。

  网络层四大功能：

  1. 路由选择

     <img src="https://image.sybblogs.fun/img-common/202402171241568.png" alt="路由选择" style="zoom:33%;" />

     如上图所示，中间的路由器可以组成多个线路，具体要选择哪种路线要看当时的网络情况，通过相应的路由算法计算出最佳路径。这就是路由选择过程。

  2. 流量控制

     协调发送端和接收端的速度问题，主要是针对发送端速度。

  3. 差错控制

     通信两结点之间约定规则，如：奇偶校验，接收方会根据规则来检查受到的分组有没有错误，且有纠错的功能。

  4. 拥塞控制

     若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞。

  主要协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

- 数据链路层

  主要任务是把网络层传下来的数据报组装成帧。数据链路层$/$链路层的传输单位是帧。

  功能如下：

  1. 成帧(定义帧的开始和结束)

     也就是说数据包组装成帧之后会形成一个较长的比特流序列，对于这样的比特流序列要定义帧从哪开始，从哪结束。只有定义完帧的起始和结束位置，才能在接收端提取出帧的部分。

  2. 差错控制

     包括帧错和位错。可以检测错误也可以纠正帧错误。

  3. 流量控制

     对于发送方和接收方速度协调问题。

  4. 访问(接入)控制

     主要是对信道控制访问。

     <img src="https://image.sybblogs.fun/img-common/202402171337137.png" alt="访问控制" style="zoom:33%;" />

     上图四个主机，都会连接在一个传输介质上，如果在广播式网络中，数据链路层就要处理这种访问接入控制的问题。控制哪台主机可以占用信道。因为在广播式网络中，同一时间只能有一台主机发送信息，其他都处于监听状态。

  主要协议：SDLC、HDLC、PPP、STP。

- 物理层

  主要任务是在物理媒体上实现比特流的透明传输。即将数据转换为电信号形式放在信道上传输即可。物理层传输单位是比特。

  透明传输：指不管所传数据是什么样的比特组合，都应当能够在链路上传送。

  <img src="https://image.sybblogs.fun/img-common/202402171342171.png" alt="透明传输" style="zoom:33%;" />

  如上图将比特流转换为右边电信号。

  功能如下：

  1. 定义接口特性

     如：确定接口电缆插头有多少引脚等。

  2. 定义传输模式

     传输模式有三种：单工(通信只能单向)、半双工(两个主机都可以作为发送方和接收方，但同一时间只能有一个主机发送信息)、双工(支持双向通信，如：打电话)

  3. 定义传输速率

  4. 比特同步

     发送端发送一个$1$，接收端就可以准确无误接收到，需要保证双方数据同步。

  5. 比特编码

     如：用什么电压表示$0$，用什么电压表示$1$

  主要协议：Rj465(水晶头)、802.3

### 5.3 TCP/IP参考模型

TCP/IP参考模型有四层：

<img src="https://image.sybblogs.fun/img-common/202402171515513.png" alt="TCP与IP参考模型" style="zoom:33%;" />

与OSI参考模型相比，TCP/IP参考模型将应用层、表示层和会话层合并为应用层，数据链路层和物理层合并为网络接口层。各个层次介绍：

- 网络接口层表示的是物理与网络的接口。但是TCP/IP参考模型没有具体描述，只是指出主机必须通过某些协议与网络连接，才能够在网络上传递IP分组，传递网络层的数据单元。相当于一个接口并没有规定具体实现细节。

- 中间的网际层是TCP/IP模型中关键部分，同时功能与OSI参考模型中的网络层功能类似，可以将数据报拆分的分组发给任何网络，并且能进行路由选择。

- 传输层与OSI参考模型一致，都是会实现一些端到端或者进程与进程之间的通信。

- 最上边的应用层，是将OSI参考模型中的应用层、表示层和会话层功能综合在一起形成了应用层。

上图右边的是协议栈，先有协议栈才有的TCP/IP参考模型。自下而上是每一层所对应的协议。

OSI参考模型与TCP/IP参考模型相同点：

1. 都分层

2. 基于独立的协议栈的概念

3. 可以实现异构网络互联

   即能实现不同厂家生产的设备进行通信。

不同点：

1. OSI参考模型定义了三点主要内容：服务、协议、接口。这是与TCP/IP不同的一点。

2. OSI先出现，参考模型先于协议发明，不偏向特定协议。

3. TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次。

4. 在网络层和传输层这两个层次上，两个模型通信方式会有不同：

   <img src="https://image.sybblogs.fun/img-common/202402171612454.png" alt="TCP与IP参考模型对比OSI模型不同点" style="zoom:33%;" />

   面向连接分为三个阶段：第一是建立连接，在此阶段，发出一个建立连接的请求。只有在连接成功建立之后，才能开始数据传输，这是第二阶段。接着，当数据传输完毕，必须释放连接。

   而面向无连接没有这么多阶段，它直接进行数据传输。无连接有一个重要协议，即IP协议。

   TCP/IP在网络层很注重IP协议，故是无连接。

### 5.4 五层参考模型

五层参考模型综合了OSI和TCP/IP的优点。

<img src="https://image.sybblogs.fun/img-common/202402171618618.png" alt="五层参考模型" style="zoom:33%;" />

应用层可以支持各种网络应用，主要协议有：FTP、SMTP、HTTP。

传输层：进程与进程之间的数据传输。主要协议有：TCP、UDP。

网络层：源主机到目的主机的数据分组路由与转发。主要协议有：IP、ICMP、OSPF等。

数据链路层：把网络层传下来的数据报组装成帧。主要协议：Ethernet(以太网)、PPP等。

物理层：实现比特传输。

五层参考模型的数据封装与解封装：

<img src="https://image.sybblogs.fun/img-common/202402171645961.png" alt="五层参考模型封装与解封装过程" style="zoom:25%;" />

这两台主机进行通信，中间会有路由器、交换机等中间系统。这里省略。因为在这两种中间系统进行封装和解封装过程和主机过程一致。

- 首先应用层会加入一些控制信息，这个控制信息形成的传输单元就是报文。

- 接着将这个报文切分成段，放到传输层上进行传输，再加上传输层的控制协议，因此就形成一个个报文段。

  <img src="https://image.sybblogs.fun/img-common/202402171648899.png" alt="五层参考模型封装与解封装过程2" style="zoom:25%;" />

- 在网络层，就是将数据单元再加上网络层控制信息(H3)，就形成一个数据报

  <img src="https://image.sybblogs.fun/img-common/202402171649963.png" alt="五层参考模型封装与解封装过程3" style="zoom:25%;" />

  当然数据报过长也可以进行分组。

- 之后到链路层，数据报会组成帧，并且头部，尾部会加上链路层的控制信息。形成的传递单元是帧。

  <img src="https://image.sybblogs.fun/img-common/202402171651527.png" alt="五层参考模型封装与解封装过程4" style="zoom:25%;" />

- 对于帧，物理层不会追加信息，直接会转成比特流形式。传输单元是比特。

  <img src="https://image.sybblogs.fun/img-common/202402171652775.png" alt="五层参考模型封装与解封装过程5" style="zoom:25%;" />

- 接着将比特流放到链路上进行传输。传输到中间系统时，就要进行要给解封装过程。

- 到了接收方物理层，是比特序列。之后接收方数据链路层会还原成链路层帧，之后将链路层控制信息去掉就是网络层数据与控制信息。之后每一层去掉对应层的控制信息，知道应用层去掉对应控制信息之后就可以将原始数据返还给接收方。

  <img src="https://image.sybblogs.fun/img-common/202402171656384.png" alt="五层参考模型封装与解封装过程6" style="zoom:25%;" />

五层参考模型是学习的关键。

第一章总结：

<img src="https://image.sybblogs.fun/img-common/202402171722858.png" alt="第一章总结" style="zoom:33%;" />

# 二. 物理层

知识总览：

<img src="https://image.sybblogs.fun/img-common/202402171729703.png" alt="第二章知识总览" style="zoom: 25%;" />

物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

注意这里的传输媒体是指传输介质，包括导向型和非导向型。

物理层主要任务：确定与传输媒体接口有关的一些特性。即定义标准。如：路由器后面的插口(接口)是一样的，网线的水晶头也是一样的。

物理层特性：

1. 机械特性

   定义物理连接的特性，规定物理连接时所采用的规格、接口形状、**引线数目、引脚数量**和排列情况。

2. 电气特性

   规定传输二进制位时，线路上信号的**电压范围**、阻抗匹配、**传输速率**和**距离**限制等。

   如：某网络在物理层规定，信号的电平用$+10$V$\sim+15$V表示二进制$0$，用$-10$V$\sim-15$V表示二进制$1$，电线长度限于$15$m以内。

3. 功能特性

   指明某条线上出现的**某一电平表示何种意义**，接口部件的信号线的用途。

   如：描述一个物理层接口引脚处于高电平时的含义

4. 规程特性(过程特性)

   定义各条物理线路的工作**规程和时序**关系。

## 1. 数据通信

需要对数据通信有一个大致理解。下图是一个典型的数据通信模型：

<img src="https://image.sybblogs.fun/img-common/202402171743349.png" alt="典型数据通信模型" style="zoom: 25%;" />

1. 假如发送端要发送一个消息，且通过拨号上网方式(用公用电话网，是广域网)。消息是人可以理解的文字，但在传输过程中需要将消息转换为数据，即一些列$0/1$的组合。发送端网卡所发出数据在电信号上的表现就是上图的数字信号。
2. 接下来会经过一个调制解调器将数字信号调制成模拟信号。因为数据要经过公用电话网，是一个广域网，广域网中有很多模拟信道(能传递模拟信号，但是不能传递数字信号)。所以需要将数字信号转换为模拟信号。
3. 之后到了右边的调制解调器，将模拟信号再转化为原来的数字信号。即形成一个计算机可以理解的数据形式(比特流形式)。

接着接收端内部操作再将比特流数据转换为原始消息。这个转换过程就是物理层以上几层所要做的事情。

以上每一部分都有对应的专业名词：

<img src="https://image.sybblogs.fun/img-common/202402171752912.png" alt="典型数据通信模型名词对应" style="zoom: 25%;" />

输入端可以叫做信源。调制解调器是发送器。而接收端的调制解调器叫做接收器。中间的公用电话网是传输系统。

同时还可以再进一步统一这些专业名词：

<img src="https://image.sybblogs.fun/img-common/202402171754346.png" alt="典型数据通信模型名词对应2" style="zoom: 25%;" />

### 1.1数据通信专业名词介绍

- 数据data

  传送信息的实体，通常是有意义的符号序列。上面的例子就是$0/1$的比特流序列。所以数据通信指在不同计算机之间传输表示信息的二进制数$0/1$序列的过程。

- 信号

  数据的电气$/$电磁的表现，是数据在传输过程中的存在形式。有两种形式：数字信号和模拟信号：

  1. 数字信号$/$离散信号：代表消息的参数的取值是离散的。

  2. 模拟信号$/$连续信号：代表消息的参数的取值是连续的。

  <img src="https://image.sybblogs.fun/img-common/202402171758463.png" alt="数字信号和模拟信号" style="zoom:33%;" />

- 信源

  产生和发送数据的源头。

- 信宿

  接收数据的终点。

- 信道

  信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。所以信道有方向性。

  信道可以分为两种：

  1. 按照传输信号分可以分为：模拟信道(传送模拟信道)和数字信道(传送数字信道)
  2. 按照传输介质可以分为：无线信道和有线信道

所以通信的目的是**传送消息**。消息包括：语音、文字、图像、视频等。

- 码元

  码元是指用一个固定时长的信号波形(数字脉冲)，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为$k$进制码元，而该时长称为码元宽度。当码元的离散状态有$M$个时($M$大于$2$)，此时码元为M进制码元。

  $1$码元可以携带多个比特的信息量，所以不同进制的码元的区别就是携带的信息量不同。例如，在使用二进制编码时，只有两种不同的码元，一种代表$0$状态，另一种代表$1$状态，所以一个码元携带一个比特信息量。如果是四进制的码元，则码元离散状态有四种，四种高低不同的信号波形，可以用两位二进制表示，即$00,01,10,11$。所以四进制码元一个码元携带两个比特信息量。

  假如主机要发送二进制数据给另一台主机，如果这些数据要放到链路上传输就要转换为电信号形式。主机$A$会将这心电信号信息一个一个放到链路上发送给主机$B$，主机$B$会一个个接收

  <img src="https://image.sybblogs.fun/img-common/202402171921366.png" alt="码元" style="zoom:33%;" />

  如上图，比特$1$对应下面的高电平信号，比特$0$对应下面低电平信号。而这一段一段的低电平信号和高电平信号就是码元。上图中码元只有一低一高两种，所以是二进制码元。

- 速率

  速率也叫数据率，是指数据的传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示。

  1. 码元传输速率：别名码元速率、波形速率、调制速率、符号速率等，它表示单位时间内数字通信系统所传输的码元个数(也可称为脉冲个数或信号变化的次数)，单位是波特(Baud) 。$1$波特表示数字通信系统每秒传输一个码元。即$1$s传输多少个码元。

     例：若$2$秒内传$4800$个码元，$1$码元传输速率是多少?

     > $\frac{4800}{2}=2400$B

     数字信号有多进制和二进制之分，但码元速率与进制数无关，只与码元长度(宽度)$T$有关。速率与码元长度关系如下：
     $$
     R_B=\frac{1}{T}(B)
     $$

  2. 信息传输速率：别名信息速率、比特率等，表示单位时间内数字通信系统传输的二进制码元个数(即比特数)，单位是比特$/$秒(b$/$s)

     即$1$s传输多少个比特。

  码元传输速率和信息传输速率关系：若一个码元携带$n$位bit的信息量，则$M$Baud的码元传输速率所对应的信息传输速率为$M\times n$ bit$/$s。故码元是一个或多个比特组成的整体。

  例1：某一数字通信系统传输的是四进制码元，$4$s传输了$8000$个码元，求系统的码元传输速率是多少?信息传输速率是多少?若另一通信系统传输的是十六进制码元，$6$s传输了$7200$个码元，求他的码元传输速率是多少?信息传输速率是多少?并指出哪个系统传输速率快?

  > 四进制码元系统：
  >
  > 码元传输速率就是$8000/4=2000$Baud，信息传输速率就是$2000*log_24=4000$b/s
  >
  > 十六进制码元系统：
  >
  > 码元传输速率就是$7200/6=1200$Baud，信息传输速率就是$1200*log_216=4800$b/s
  >
  > 系统传输的是比特流，通常比较的是信息传输速率，所以传输十六进制码元的通信系统传输速率较快。

  例2：已知八进制数字信号的传输速率为$1600$B。试问变换成二进制数字信号时的传输速率是多少?

  > 八进制位数有$3$位比特长度，所以$1$B可以传送$3$b/s。且二进制只有$1$位比特长度，所以$1600$B可以传送$1600*3$位二进制bit/s。
  >
  > 即$1600\times\log_28=4800$bit/s

  例3：已知二进制数字信号的传输速率为$2400$b/s。试问变换成四进制数字信号时，传输速率为多少波特?

  > 二进制只有$1$位比特长度，所以$1$B码元可以传输$1$位比特长度信息，而变换为四进制则需要两位比特长度，故$\frac{2400}{2}=1200$B

- 带宽

  1. 在模拟信号系统中：当输入的信号频率高或低到一定程度，使得系统的输出功率成为输入功率的一半时(即-3dB)，**最高频率和最低频率间的差值**就代表了系统的通频带宽，其单位为赫兹(Hz)。

  2. 在数字设备中：表示在单位时间内从网络中的某一点到另一点所能通过的"最高数据率"/单位时间内通过链路的数量，常用来表示网络的通信线路所能传输数据的能力。单位是比特每秒(bps)。

     描述的是信道的最优性能。拥有更宽的带宽，也就是有更大的信息运送能力，一秒钟能送到信道上的比特数就越多。

### 1.2 设计数据通信三个问题

设计数据通信系统要考虑的$3$个问题：

1. 采用单工通信$/$半双工$/$全双工通信方式?
2. 采用串行通信$/$并行通信方式?
3. 采用同步通信$/$异步通信方式?

#### 三种数据通信方式

从通信双方信息的交互方式看，可以有三种基本方式：

1. 单工通信

   只有一个方向的通信而没有反方向的交互，仅需要一条信道。使用场景：广播，一个人讲其他人听。

2. 半双工通信$/$双向交替通信

   通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，需要两条信道。使用场景：两个人使用对讲机说话。

3. 全双工通信$/$双向同时通信

   通信双方可以同时发送和接受信息，也需要两条信道。使用场景：两个人打电话。

#### 串行传输与并行传输

串行传输：将表示一个字符的$8$位二进制数按由低位到高位的顺序依次发送。

<img src="https://image.sybblogs.fun/img-common/202402171819673.png" alt="串行传输" style="zoom:33%;" />

串行传输特点：速度慢，费用低，适合远距离。

并行传输：将表示一个字符的$8$位二进制数同时通过$8$条信道发送。

<img src="https://image.sybblogs.fun/img-common/202402171820508.png" alt="并行发送" style="zoom: 33%;" />

并行传输特点：速度快，费用高，适合近距离。

在计算机内部的数据传输就是并行传输。

#### 同步传输与异步传输

计算机实现数据接收同步方式有两种：

同步传输：在同步传输的模式下，数据的传送是以一个数据区块为单位，因此同步传输又称为区块传输。在传送数据时，需先送出$1$个或多个同步字符，再送出整批的数据。

<img src="https://image.sybblogs.fun/img-common/202402171823746.png" alt="同步传输" style="zoom:33%;" />

如上图接收方在收到发送方两个同步字符后，就会准备开始接收数据字符了。也就是实现了发送方和接收方的时钟同步。

异步传输：异步传输将比特分成小组进行传送，小组可以是$8$位的$1$个字符或更长。发送方可以在任何时刻发送这些比特组，而接收方不知道它们会在什么时候到达，传送数据时，需要添加一个字符起始位和一个字符终止位。

<img src="https://image.sybblogs.fun/img-common/202402171829142.png" alt="异步传输" style="zoom:33%;" />

假如一台主机发送以上几个字节的数据，与同步传输区别在于，在发送端并不是连续发送这几个字节，而是断断续续的。如上图的字节$3$其有$8$位，每一位如下：

<img src="https://image.sybblogs.fun/img-common/202402171831402.png" alt="异步传输2" style="zoom:33%;" />

发送端发送这$8$位数据的时候会加上一个终止位和起始位。

<img src="https://image.sybblogs.fun/img-common/202402171832736.png" alt="异步传输3" style="zoom:33%;" />

起始位和终止位通常默认为$0/1$，每次异步传输都会以起始位开头，起始位到达接收端的时候，接收端就准备接收数据。在接收完这八个比特位后，会收到一个终止位，接收端就会停止接收数据，直至接收到下一个起始位。

异步传输常见例子就是：键盘输入信息。计算机对输入信息处理就是异步传输。

同步和异步区别：同步传输种发送方和接收方时钟是统一的，字符与字符间的接收与发送是同步的没有间隔的，是以一个区块形式传输的。异步传输则不要求接收方和发送方时钟完全一样，字符与字符间的接收和发送是异步的。

> 同步传输与异步传输与串行传输与并行传输关系：
>
> 如吃面包时候，面包师可以一直做，顾客则需要一直吃(同步传输)，顾客可以有一个(串行传输)也可以有多个(并行传输)。
>
> 若面包师根据心情断断续续做面包，则顾客也是断断续续吃面包(异步传输)，顾客可以有一个(串行传输)也可以有多个(并行传输)。

数据通信基础知识总结：

<img src="https://image.sybblogs.fun/img-common/202402171842333.png" alt="数据通信基础知识总结" style="zoom:33%;" />

### ==1.3 奈氏准则与香农定理==

先来介绍失真概念：在计算机网络中就是信号在传递时发生扭曲变化。

<img src="https://image.sybblogs.fun/img-common/202402172057154.png" alt="失真" style="zoom:33%;" />

上满信号波形即使在信道中受到干扰，还是可以根据接收信号波形来识别出数据。但下面这种情况就很难识别：

<img src="https://image.sybblogs.fun/img-common/202402172058173.png" alt="失真2" style="zoom:33%;" />

影响失真程度的因素：码元传输速率(越快失真程度就越严重)、信号传输距离、噪声干扰、传输媒体质量(质量越差失真越严重)。

失真一种情况：码间串扰

假如在传输数据时候是通过电话路网(模拟信道)上传输，此时可以将数字信号调制为多种模拟信号

<img src="https://image.sybblogs.fun/img-common/202402172102502.png" alt="码间串扰" style="zoom:33%;" />

在实际传输中信道上布满了各种各样频率的信号。上图左边数字是信号带宽，可以看到并不是所有带宽都快有通过信道的，$300$HZ和$3300$HZ都能通过，所以信道带宽是信道能通过的最高频率和最低频率之差。即$3300-300=3000$HZ。

$200$HZ带宽不能通过是因为在复杂的电话路网上传播，很容易受到衰减，可能最后会消失，所以不能传播。

而$4000$HZ就是码间串扰问题，因为带宽震动频率太快，导致接收端在接收后区分不出来波形之间的差异，所以就会导致码间串扰现象。

故码间串扰：**接收端收到的信号波形失去了码元之间清晰界限的现象**。

为了解决这个问题就提出了奈氏准则。

#### 奈氏准则(奈奎斯特定理)

奈氏准则：在理想低通(无噪声，带宽受限)条件下，为了避免码间串扰，极限**码元**传输速率为$2$W Baud，W是信道带宽，单位是Hz。

注意：只有在奈氏准则和香农定理中带宽单位才是Hz。
$$
理想低通信道下的极限(最大)数据传输率=2W\log_2V(b/s)
$$
这里的$V$指的是有几种码元或者说是码元的离散电平数目。根据这个准则可以得出以下四条结论：

1. 在任何信道中，码元传输的速率是有上限的。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。

2. 信道的频带越宽(即能通过的信号高频分量越多)，就可以用更高的速率进行码元的有效传输。
3. 奈氏准则给出了码元传输速率的限制，但并没有对信息传输速率给出限制。
4. 由于码元的传输速率受奈氏准则的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法。

例：在无噪声的情况下，若某通信链路的带宽为$3$kHz，采用$4$个相位，每个相位具有$4$种振幅的QAM调制技术，则该通信链路的最大数据传输率是多少?

> 由于有$4$个相位，每个相位有$4$种振幅，所以总共$4\times4=16$种信号形式。(在下一节编码与调试中会具体讲到)
>
> 所以最大数据传输率$=2·3k·\log_216=24$kb/s

#### 香农定理

上面的奈氏准则只是规定了最高的极限码元传输速率，但是并没有规定比特的传输最高速率。所以香浓定理可以解决这个问题。

香农定理和奈氏准则相比，不仅定义了在信道种传输的比特极限传输速率，同时还考虑到了信道当中会经常存在的电磁干扰，即噪声的影响。噪声存在于所有的电子设备和通信信道中。由于噪声随机产生，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误。但是噪声的影响是相对的，**若信号较强，那么噪声影响相对较小**。因此，**信噪比**(通常题中会给出)就很重要。

信噪比$=$信号的平均功率$/$噪声的平均功率，常记为S$/$N， 并用分贝(dB) 作为度量单位，题中常常给出$dB$，所以要换算出$S/N$。即：
$$
信噪比(dB)=10\log_{10}(S/N)
$$
香农定理：在带宽受限且有噪声的信道中，为了不产生误差(接收端可以清晰地分辨码元)，信息的数据传输速率有上限值。
$$
信道的极限数据传输速率=W\log_2(1+S/N)(b/s)
$$
上面的$S/N$是信噪比，其中$S$是信道所传信号的平均功率，$N$是信道内的高斯噪声功率。

根据这个准则可以得出以下四条结论：

1. 信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。
2. 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。
3. 只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输。
4. 香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少。
5. 从香农定理可以看出，若信道带宽$W$或信噪比$S/N$没有上限(不可能情况，所以不做探讨)，那么信道的极限信息传输速率也就没有上限。

例：电话系统的典型参数是信道带宽为$3000$Hz，信噪比为$30$dB，则该系统最大数据传输速率是多少?

> $30$dB$=10\log_{10}(S/N)$，则$S/N=1000$
>
> 故信道的极限数据传输速率$=W\log_2(1+S/N)=3000\times \log_2(1+1000)\approx 30$kb/s

#### 奈氏准则和香农定理区别

- 奈氏准则

  是在带宽受限无噪音条件下，为了避免码间串扰，推导出码元传输极限值是$2$W波特。侧重码元传输速率。

  公式：
  $$
  理想低通信道下的极限(最大)数据传输率=2W\log_2V(b/s)
  $$
  要想提高数据率，就要提高带宽$/$采用更好的编码技术(提高V，使得每个码元承载的比特数更高)。

- 香农定理

  是带宽受限有噪声条件下的信息传输速率。侧重比特传输速率。

  公式：
  $$
  信道的极限数据传输速率=W\log_2(1+S/N)(b/s)
  $$
  要想提高数据率，就要提高带宽/信噪比。

公式选择：如果给出噪声条件就用香农定理，如果么有给出就用奈氏准则。如果题中给出信噪比同时还给出一个码元对应多少比特(V)，此时就要两个公式都算出结果，取其最小值。

例子：二进制信号在信噪比为$127:1$的$4$kHz信道上传输，最大的数据速率可达到多少?

> 题中即给出信噪比，同时还给出二进制，即一个码元对应一个比特。所以两个公式都要用取其最小值。
>
> 奈氏准则：$2\times 4000\times\log_22=8000$b/s
>
> 香浓定理：$400\times\log_2(1+127)=28000$b/s
>
> 所以最大的数据速率可达到$8000$b/s

## 2. 编码与调制

先来看基带信号与宽带信号概念：这两个其实是信道上传送信号的两种形式。之前学过信道上的按传输信号可以分为数字信号和模拟信号，引入基带信号与宽带信号这两个概念后，信道上的按传输信号还可以分为**基带信号与宽带信号**。

- 基带信号

  基带信号将数字信号$1$和$0$直接用两种不同的电压表示，再送到**数字信道**上去传输(基带传输)。

  来自信源的信号，像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传输的信息的信号，比如我们说话的声波就是基带信号，并且是模拟信号。

  基带传输中会规定$1$用什么样的波形表示，$0$用什么样的波形表示。这就是基带传输编码过程。

- 宽带信号

  将基带信号进行调制后形成的频分复用模拟信号，再传送到**模拟信道**上去传输(宽带传输)。

  宽带信号是把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输(即仅在一段频率范围内能够通过信道)。

即如果放到数字信道上传输就是基带传输，放到模拟信道上传输就是宽带传输。且在传输距离较近时，计算机网络采用**基带传输**方式(近距离衰减小，从而信号内容不易发生变化)。在传输距离较远时，计算机网络采用**宽带传输方式**(远距离衰减大，即使信号变化大也能最后过滤出来基带信号)。

### 2.1 编码与调制概念

上面是预备知识下面介绍编码与调制：

数据可以是数字的也可以是模拟的，如计算机语言就是二进制的$0/1$，所以计算机发送的数据也是数字数据，即离散的波形。而人在说话的时候发出的声波是模拟数据，是连续不断的波形。而对于数据来说无论是数字数据还是模拟数据，为了能让数据传输道接收端，就需要首先把数据转成信号的形式，之后才能把信号放到链路上进行传输。所以把**数据转成信号就是编码与调制**要做的工作。

具体就是数字数据$\xrightarrow{通过数字发送器转化为}$数字信号是编码手段。数字数据$\xrightarrow{通过调制器转换为}$模拟信号是调制手段。

而对于模拟数据$\xrightarrow{通过PCM编码器转换为}$数字信号是编码手段。模拟数据$\xrightarrow{通过放大器调制器转换为}$模拟信号是调制手段。

### 2.2 四种编码与调制方法

四种方法是：数字数据编码为数字信号、数字数据调制为模拟信号、模拟数据编码为数字信号、模拟数据调制为模拟信号。

#### ==数字数据编码为数字信号==

计算机所发送的数据是$0/1$的数字数据，为了使数据能够在信道上进行传播，就要把数据编码为数字信号的方式。数字数据的编码用于基带传输当中，即基本不改变数字信号的频率，而是直接传输数字信号。

这种编码方式有很多种，本质其实就是规定$0/1$对应的数字信号波形。常用编码有三种：非归零编码(NRZ)、曼彻斯特编码、差分曼彻斯特编码、归零编码(RZ)、反向不归零编码(NRZI)、4B$/$5B编码。

这里重点介绍前三种编码：

<img src="https://image.sybblogs.fun/img-common/202402181554509.png" alt="数字数据编码为数字信号" style="zoom: 25%;" />

- 非归零编码

  高$1$低$0$。

  特点是：编码容易实现，但没有检错功能，且无法判断一个码元的开始和结束，以至于收发双方难以保持同步。

  假如要发送的是一长条连续的$1$，对应的编码就是一个很长的横线，接收端就分不清有多少个$1$。所以需要接收端和发送端再专门建立一个信道用于传输时钟周期，即接收端告诉发送端多久发一个比特，两者要建立一个同步过程。

- 归零编码

  信号电平在一个码元之内都要恢复到零的这种编码成编码方式。

  如二进制$1$对应的信号是先跳变为高电平，再归为低电平。而二进制$0$会一直处于低电平。

  <img src="https://image.sybblogs.fun/img-common/202402181609079.png" alt="归零编码" style="zoom: 25%;" />

  对于归零编码，在整个传输过程中，处于低电平情况很多，而且低电平时间久。信道利用率低。

- 反向不归零编码

  信号电平翻转表示$0$，信号电平不变表示$1$。

  <img src="https://image.sybblogs.fun/img-common/202402181610056.png" alt="反向不归零编码" style="zoom:25%;" />

  与归零编码区别是在一个码元内不会发生跳变。

  可以看到如果发送端是全$0$，电信号会一直翻转，接收端很容易接收。而如果是全$1$，则发送端就分辨不出。

  所以综合上面三个编码优点就形成了曼彻斯特编码。

- 曼彻斯特编码

  将一个码元分成两个相等的间隔，前一个间隔为低电平后一个间隔为高电平表示码元$1$(前低后高表示$1$)。码元$0$则正好相反(前高后低表示$0$)。也可以采用相反的规定。该编码的特点是在每一个码元的中间出现电平跳变，位中间的跳变既作时钟信号(可用于同步)，又作数据信号，但它所占的频带宽度是原始的基带宽度的两倍。

  可以看到每一个码元都会发生跳变。跳变可以作为时钟信号用于发送方和接收方同步，接收方每次都能检测出码元跳变，就可以知道接收方发送了几个比特。

  另外每一个码元都被调成两个电平，所以数据传输速率只有调制速率的$1/2$。

  <img src="https://image.sybblogs.fun/img-common/202402181619148.png" alt="曼彻斯特编码" style="zoom:33%;" />

  即一个时钟周期内有两个码元，但是只有一个比特。

- 差分曼彻斯特编码

  同$1$异$0$。常用于局域网传输，其规则是：若码元为$1$，则前半个码元的电平与上一个码元的后半个码元的电平相同，若为$0$，则相反。该编码的特点是，在每个码元的中间，都有一次电平的跳转，可以实现自同步，且抗干扰性强于曼彻斯特编码。

  <img src="https://image.sybblogs.fun/img-common/202402181626008.png" alt="差分曼彻斯特编码" style="zoom:33%;" />

  可以看到，只有下一个编码是$0$，会出现电平跳变，如上图红色部分。而$1$则不会产生跳变，如上图蓝色部分。


- 4B$/$5B编码

  比特流中插入额外的比特以打破一连串的$0$或$1$，就是用$5$个比特来编码$4$个比特的数据，之后再传给接收方，因此称为4B$/$5B。编码效
  率为$80\%$。

  <img src="https://image.sybblogs.fun/img-common/202402181631831.png" alt="4B5B编码" style="zoom: 33%;" />

  对于4B$/$5B编码，实际上就是把每$4$个数据分为一组，总共有$16$组。这$16$组分别会对应一组$5$比特的编码方式，而$5$比特可以表示$32$种情况。所以$5$比特中就可以拿出$16$种给$4$​比特数据做编号。而其他的$16$种作为控制码(帧的开始和结束，线路的状态信息等)或保留。

#### 数字数据调制为模拟信号

计算机所发出的是数字信号，所以要放到模拟信道上传输就要先经过调制解调器调制为模拟信号，然后才能在信道上传输。到了接收端再由接收端调制解调器实现解调过程，将模拟信号转成数字信号，进而交给信宿，由信宿将数字信号解释为$0/1$数据，再将$0/1$转成人们可以识别的图像等。

所以数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制和解调过程。

调制可以分为：ASK、FSK、PSK、QAM

<img src="https://image.sybblogs.fun/img-common/202402181642283.png" alt="数字数据调制为模拟信号" style="zoom: 25%;" />

- ASK

  调幅，$0$对应没有幅度，$1$有幅度。

- FSK

  调频，$0$是低频、$1$是高频。波形低频是稀疏，高频是密集。

- PSK

  调相，$0$和$1$对应的波形不一样。即对应正弦波和余弦波。

- 调幅$+$调相(QAM)

  调幅基础上，对于幅度进一步细分，调成几个相位。或者是在调相的基础上，对于每种相位，再细分调成不同的幅度。

  例：某通信链路的波特率是$1200$Baud，采用$4$个相位，每个相位有$4$种振幅的QAM调制技术，则该链路的信息传输速率是多少?

  > 即对于每一种相位，都会有四种振幅形式。整个信号就会有$4\times4=16$种波形。即对应$16$种码元。
  >
  > $16$种码元需要$\log_216=4$比特位表示。且题中给出一秒传输$1200$个码元，一个码元表示$4$比特位。
  >
  > 则信息传输速率位：$1200\times4=4800$b/s。

#### 模拟数据编码为数字信号

计算机内部处理的是二进制数据，处理的都是数字音频，所以需要将模拟音频通过采样、量化转换成有限个数字表示的离散序列(即实现音频数字化)。

最典型的例子就是对音频信号进行编码的脉码调制(PCM)，在计算机应用中，能够达到最高保真水平的就是PCM编码，被广泛用于素材保存及音乐欣赏，CD、DVD以及我们常见的WAV文件中均有应用。它主要包括三步：抽样、量化、编码。

1. 抽样

   对模拟信号周期性扫描，把时间上连续的信号变成时间上离散的信号。

   为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行采样：==$f_{采样频率}\ge 2f_{信号最高频率}$==

2. 量化

   把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值，并取整数，这就把连续的电平幅值转换为离散的数字量。

   之前的抽样会得到一些离散的点，但是点所对应的纵坐标或者所对应的电平值差异很大，有小数的也有整数的幅值。所以需要把这些小数的幅值和整数幅值统一为整数，并且按照一定的分级标准分段。如：$256$种分级 , 对应着每个采样需要使用$\log_2256=8$比特位表示，即对应着$8$位的音频采样。 

3. 编码

   把量化的结果转换为与之对应的二进制编码。

   量化之后会得到一系列的整数电平幅值。可以把这些整数电平幅值看作几种信号状态。每种信号状态就对应着一种码元。因此，假如有四种状态，就可以用两个比特为表示。同理$16$种状态可以用$4$个比特位表示。

<img src="https://image.sybblogs.fun/img-common/202402181706400.png" alt="数字数据调制为模拟信号过程" style="zoom:33%;" />

结合上图再总结模拟数据编码为数字信号过程：

首先对于上图不规则的模拟信号，要先对其进行周期性扫描抽样。具体可以是每一个相等的周期就对信号采样一次。采样就是对信号取样，看在这个时候对应的电压是多少。

接着量化就是将抽样后的点的电压会有小数和整数幅值，此时全部都统一为整数，并且按照一定的分级标准转换为对应的数字值。

最后编码，如上图左侧比特位有四位，即所对应的就是$16$种信号状态，所以这就是编码的结果。

上面提到过**采样定理**：为了使所有的离散信号 , 能够不失真地代表被抽样的模拟数据，需要使用采样定理 :
$$
f_{采样频率}\ge 2f_{信号最高频率}
$$
模拟信号都是正弦波 构成的，每个模拟信号都可以过滤出一个正弦波。假如现在有两个正弦波：

<img src="https://image.sybblogs.fun/img-common/202402181759434.png" alt="数字数据调制为模拟信号过程2" style="zoom: 33%;" />

正弦波A，$1$秒有$2$个完整的波形，即$2$个波峰，$2$个波谷，其周期是$0.5$秒，频率是$2$Hz。

正弦波B，$1$秒有$1$个完整的波形，即$1$个波峰，$1$个波谷，其周期是$1$秒，频率是$1$Hz。

正弦波A和正弦波B都可以求信号频率，信号频率也就是带宽，即$1$秒钟震荡的次数。A信号波形$1$s可以震荡两次，频率是$2$Hz，B信号波形$1$s可以震荡一次，频率是$1$Hz。

针对B波形，确定采样频率方式如下：

对于一个正弦波，公式：$y=A\sin(\omega x+\varphi)$。这里的$\omega$是频率，即上面的$1$Hz。因此未知数只有$A$和$\varphi$。

未知参数$A$和$\varphi$求值条件：只要代入两组数据，就可以将该正弦函数的公式求出，因此采样时 , 采两组数据$(x,y)$，就能完全还原该正弦函数。进而求出正弦波的波形。采样的数据越多波形越准确，越不容易失真。

结论：

在一个 正弦波周期内，采样$2$次，就可以还原该正弦波。

如果$1$秒钟有$1$个完整的正弦波，即频率是$1$Hz，那么采样$2$次即可。而如果$1$秒钟有$2$个完整的正弦波，即频率是$2$Hz，那么采样$2\times 2=4$次即可。

**因此采样定理中规定，采样频率必须大于等于$2$倍信号最高频率**。

人耳能听到的声音是$20$Hz$\sim20000$Hz，如果让人耳能够听不出来区别，必须在$20000\times2=40000$Hz以上的采样率才能达到最基本高保真要求。而高频失真 , 就是高频的波形没有完整的还原出来，采样率不足导致的。

#### 模拟数据调制为模拟信号

信号在传输过程中，可能信道会很长，而且可能环境很恶劣，会导致传输的模拟信号受到一定的衰减，所以要把模拟信号调制成新的模拟信号以应对突发情况。

即为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源。在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式。模拟的声音数据是加载到模拟的载波信号中传输的。

假如两个打电话，需要经过信号发射塔传送给接收方。通过话筒传出来的声音(声波)，频率很低。这种声波很难以应对信道上的突发影响。因此需要将这个声波信号调制成高频的模拟信号，这个高频信号在信道上即使受到影响接收方也可以清楚恢复出原来的信号。这个模拟信号在信道上传输到接收方时，接收端通过解调器将这个信号解调成原来的基带信号。

编码与调制总结：

<img src="https://image.sybblogs.fun/img-common/202402181843316.png" alt="编码与调制总结" style="zoom:33%;" />

## 3. 数据的交换方式

在之前讲过如果两台计算机要进行通信，之间要有链路连接。假如现在有六台计算机，之间都是使用有线的链路进行连接：

<img src="https://image.sybblogs.fun/img-common/202402181845985.png" alt="数据交换原因" style="zoom: 33%;" />

如果要实现两两互连，则需要$C_n^2$条链路。如果计算机数目增多，再使用这种两两连接方式就显得十分低效。因此就产生了如下方式：

<img src="https://image.sybblogs.fun/img-common/202402181847043.png" alt="交换设备" style="zoom:33%;" />

中间的交换设备可以是交换机(局域网)、路由器(广域网)等。通过这个交换设备链路就变成$n$条。

这里的交换是通过某些交换中心将数据进行集中和传送。进而传输线路为各个用户共用，从而大大节省通信线路，降低系统费用。

当交换设备更多的时候可以形成要给交换网络：

<img src="https://image.sybblogs.fun/img-common/202402181849579.png" alt="交换网络" style="zoom: 25%;" />

所以本小节介绍的数据交换方式有四种：电路交换、报文交换、分组交换。其中报文交换和分组交换都属于存储转发交换方式。分组交换又可以分为数据报方式和虚电路方式。

### 3.1 电路交换

如下图所示有两台主机进行连接：

<img src="https://image.sybblogs.fun/img-common/202402181852564.png" alt="电路交换" style="zoom:33%;" />

假定$A$主机发送信息，$B$主机接收信息。中间的都是交换设备。

先看一下电路交换原理：在数据传输期间，源结点与目的结点之间有一条由中间结点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持。

具体要结合电路交换的阶段：建立连接(呼叫$/$电路建立)、通信(数据传输)、释放连接(拆除电路)。

- 建立连接(呼叫$/$电路建立)

  发送端会首先向最近的离它最近的交换设备$A$发送呼叫请求。呼叫请求中包含所需要建立连接的主机$A$和主机$B$的地址(即IP地址)。

  接着交换设备$A$就要执行一个路由选择算法，即选择下一个要发送的设备。这里路由交换算法选择了交换设备$B$，之后设备$A$会转发呼叫请求给设备$B$。之后循环直到转发呼叫请求给设备$D$。最后交换设备$D$直接交付给主机$B$。

  如果主机$B$可以接收$A$的连接请求，就会原路返回给主机$A$一个呼叫应答(下图红色线路)。

  <img src="https://image.sybblogs.fun/img-common/202402181900118.png" alt="电路交换原理" style="zoom:33%;" />

  至此主机$A$和$B$两台主机之间的线路连接成功。之后进入第二个阶段。

- 通信(数据传输)

  再通信过程中，两台主机都可以发送数据，即全双工通信方式。

  在两台主机发送完数据后就进入第三阶段。

- 释放连接(拆除电路)

  假如主机$A$要请求断开连接。主机$A$会发送一个释放请求，释放请求会通过之前选好的路径进行转发，直到发送给主机$B$。

  主机$B$受到释放请求后，就会原路返回一个释放应答(下图紫色线路)。

  <img src="https://image.sybblogs.fun/img-common/202402181904745.png" alt="电路交换原理2" style="zoom:33%;" />

  这个释放应答过程中设备会依次断开连接。

电路交换特点：独占资源，用户始终占用端到端的固定传输带宽(通信过程中选择的线路不能被其他主机占用)。适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况。

**电路交换优缺点**：

<img src="https://image.sybblogs.fun/img-common/202402181907950.png" alt="电路交换优缺点" style="zoom: 33%;" />

### 3.2 报文交换

报文：报文(message)是网络中交换与传输的数据单元，即站点一次性要发送的数据块。报文包含了将要发送的完整的数据信息，其长短很不一致，长度不限且可变。通俗讲就是指单次要发送的数据块，长度不确定。

报文交换原理(可以用存储转发概括)：无需在两个站点之间建立一条专用通路，其数据传输的单位是报文，传送过程采用**存储转发**方式。

<img src="https://image.sybblogs.fun/img-common/202402181911830.png" alt="报文交换原理" style="zoom:33%;" />

如上图，发送端要发送一个数据块，数据块可以称为信息，这个信息加上报头就形成报文。报文中包含源主机地址和目的主机地址，还有一些相关的控制信息。

<img src="https://image.sybblogs.fun/img-common/202402181914275.png" alt="报文交换原理2" style="zoom: 33%;" />

1. 首先报文会发送到交换设备$A$。由于采用存储转发方式，交换设备$A$会先收下整个报文，暂存报文后检查有无错误。当检查完这个报文并无差错，就需要等待输出电路空闲时利用路由信息找到下一个结点地址，并传送给下一个结点。

   这里的路由信息是指每个交换设备都会维护一张较大的路由表，根据这个路由表就可以判断接下来可以走哪几个路由器(如何到目的主机最短)。

   <img src="https://image.sybblogs.fun/img-common/202402181919304.png" alt="报文交换原理3" style="zoom:33%;" />

2. 根据路由信息可以看到交换设备$B$是到目的主机最快的路径，所以交换设备$A$会将报文传送给交换设备$B$。在传输给设备$B$报文时，其他线路段，甚至是设备$A$和设备$B$之间的线路段都可以传输其他用户的报文，也就是说每两个结点之间的链路并不是被独占的，是所有人都可以共享的。但是链路会有限制的宽度，即带宽，当一段链路中要传输的报文过多时，线路就很繁忙，所以需要靠交换设备暂存报文，等线路空闲时再将报文发送出去。这样一个过程就是存储转发。

   <img src="https://image.sybblogs.fun/img-common/202402181925294.png" alt="报文交换原理4" style="zoom: 25%;" />

3. 之后设备$B$等到等到线路空闲时就会将报文发送给目的主机。

报文交换原理优缺点：

<img src="https://image.sybblogs.fun/img-common/202402181925242.png" alt="报文交换原理优缺点" style="zoom: 33%;" />

### 3.3 分组交换

是现在网络中最常使用的交换方式。

分组：大多数计算机网络都不能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作分组(packet)。

分组交换的原理：分组交换与报文交换的工作方式基本相同，都采用存储转发方式，形式上的主要差别在于，分组交换网中要限制所传输的数据单位的长度，一般选$128$B。发送结点首先对从终端设备送来的数据报文进行接收、存储，而后将报文划分成一定长度的分组，并以分组为单位进行传输和交换。接收结点将收到的分组组装成信息或报文。

<img src="https://image.sybblogs.fun/img-common/202402181934058.png" alt="分组交换" style="zoom:33%;" />

如上图，发送源需要发送一个大数据块。这里如果不对大数据库进行切割就是报文交换方式。采用分组交换这里会对大数据块进行切割。将大数据库切割成一个个小数据块。接下来在每个小数据块上都加上控制信息就形成一个个小分组。

<img src="https://image.sybblogs.fun/img-common/202402181936346.png" alt="分组交换原理" style="zoom:33%;" />

控制信息包括源地址和目的地址及分组编号。有编号是因为在传输过程中交换设备会根据网络状况选择不同路线发送这些小数据块，所以在目的主机需要根据这个编号进行按序重组。还原出原来的正确报文。

首先第一个分组发送给交换设备，交换设备在受到这个分组后仍和报文交换一样会进行差错检测及路由选择。如果分组路由选择如下所示：

<img src="https://image.sybblogs.fun/img-common/202402181940537.png" alt="分组交换原理2" style="zoom:33%;" />

交换会根据网络进行路由选择。各个分组在传输过程中变得无序。最后全部发送给目的主机后，目的主机根据分组编号将这些分组重组成合适的报文，再交付给上层。

分组交换优缺点：

<img src="https://image.sybblogs.fun/img-common/202402181942723.png" alt="分组交换优缺点" style="zoom:33%;" />

上面是分组交换的基本原理，在分组交换下会有两种方式：数据报方式和虚电路方式。

#### 数据报方式

下图两个主机进行数据报传输：

<img src="https://image.sybblogs.fun/img-common/202402181950240.png" alt="数据报方式" style="zoom:33%;" />

主机$A$传送给主机$B$经历的步骤：

1. 源主机(A)将报文分成多个分组，依次发送到直接相连的结点(A)。
2. 结点A收到分组后，对每个分组差错检测和路由选择，不同分组的下一跳结点可能不同。
3. 结点C收到分组P1后，对分组P1进行差错检测，若正确则向A发送确认信息，A收到C确认后则丢弃分组P1副本。
4. 重复上面三部直到所有分组发送到主机$B$。但是P1和P2可能并不是按原来的顺序到达的，这个时候需要根据分组编号进行重组。

这就是数据报交换方式。其实也就是上面讲的分组方式。

数据报方式特点：

1. 数据报方式为网络层提供无连接服务。发送方可随时发送分组，网络中的结点可随时接收分组。

   无连接服务指的是不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组传输路径可能不同。

2. 同一报文的不同分组达到目的结点时可能发生乱序、重复与丢失。

3. 每个分组在传输过程中都必须携带源地址和目的地址，以及分组号。

4. 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。

   在无连接的情况下如果丢弃部分分组，会有一定的机制将丢弃的分组再重新发送。所以分组只是早到还是晚到问题。

5. 网络具有冗余路径，当某一交换结点或一段链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强，适用于突发性通信，不适于长报文、会话式通信(通常采用电路交换方式)。

#### 虚电路方式

虚电路将数据报方式和电路交换方式结合，以发挥两者优点。

<img src="https://image.sybblogs.fun/img-common/202402181959271.png" alt="虚电路方式" style="zoom:33%;" />

虚电路是指一条源主机到目的主机类似于电路的路径( 逻辑连接)，路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表， 每一项记录了一个打开的虚电路的信息。

虚电路方式结合电路交换方式，所以采用电路交换方式三个阶段：建立连接(呼叫$/$电路建立)、通信(数据传输)、释放连接(拆除电路)。

也就是在虚电路方式中和电路交换方式一样，在两台主机之间好像建立了一个连接。数据发送过程如下：

1. 建立连接

   主机会发送一个呼叫请求，交给结点$A$后，结点$A$会通过合适的路由算法选择合适的下一条。之后结点也会进行路由选择直到发送给主机$B$。

   如果主机$B$可以应答会返回一个呼叫应答的分组(下图橙色路线)。

   <img src="https://image.sybblogs.fun/img-common/202402182004461.png" alt="虚电路方式原理" style="zoom:33%;" />

   要注意的是在建立连接阶段，呼叫请求和呼叫应答都是以分组形式存在的。而分组包含源主机地址和目的主机地址。当源主机发送"呼叫请求"分组并收到"呼叫应答"分组后才算建立连接。

2. 数据传输

   在数据传输过程中，传输的是分组，每个分组携带虚电路号，分组号，检验和等控制信息。而不需要携带物理地址。因为在连接建立好后分组路径就唯一确定。但是要携带虚电路号，这个虚电路号就是唯一标识，它的意义在于如果主机$B$受到大量分组，这个大量分组中有其他主机发送的分组，此时这个主机$B$需要根据虚电路号把这些分组进行一个分类。再进行下一步还原并交给进程。

3. 释放连接

   源主机发送"释放请求"分组以拆除虚电路。

   与电路交换流程一致。

虚电路方式特点：

1. 虚电路方式为网络层提供连接服务。源结点与目的结点之间建立一条逻辑连接，而非实际物理连接。

   连接服务：首先为分组的传输确定传输路径(建立连接的过程)，然后沿该路径(连接)传输系列分组，系列分组传输路径相同，传输结束后拆除连接。

   所以这里的连接服务和无连接服务是要不要在传输数据之前先事先建立好一个连接，如果需要建立好这样一条连接就叫连接服务。如果不需要建立连接就是无连接服务。

2. 一次通信的所有分组都通过虚电路顺序传送，分组不需携带源地址、目的地址等信息，包含虚电路号，相对数据报方式开销小，同一报文的不同分组到达目的结点时不会乱序、重复或丢失。

3. 分组通过虚电路上的每个结点时，结点只进行差错检测，不需进行路由选择。

4. 每个结点可能与多个结点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同的进程服务。

5. 致命弱点：当网络中的某个结点或某条链路出故障而彻底失效时，则所有经过该结点或该链路的虚电路将遭到破坏，需要重新建立连接。

数据报与虚电路对比：

<img src="https://image.sybblogs.fun/img-common/202402182020023.png" alt="数据报与虚电路对比" style="zoom:33%;" />

### 3.4 三种数据交换方式选择

交换方式选择条件：

1. 传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换传输时延最小。

2. 当端到端的通路有很多段的链路组成时，采用分组交换传送数据较为合适。
3. 从信道利用率上看，报文交换和分组交换优于电路交换，其中分组交换比报文交换的时延小，尤其适合于计算机之间的突发式的数据通信。

<img src="https://image.sybblogs.fun/img-common/202402181948603.png" alt="三种交换方式选择" style="zoom: 25%;" />

## 4. 物理层传输介质

传输介质也称传输媒体$/$传输媒介，它就是数据传输系统中在发送设备和接收设备之间的物理通路。

传输媒体并不是物理层。传输媒体在物理层的下面，因为物理层是体系结构的第一层，因此有时称传输媒体为$0$层。在传输媒体中传输的是信号，但传输媒体并不知道所传输的信号代表什么意思。但物理层规定了电气特性，因此能够识别所传送的比特流。

传输介质可以分为导向性传输介质(电磁波被导向沿着固体媒介(铜线$/$光纤)传播)和非导向性传输介质(自由空间中进行传播，介质可以是空气、真空、海水等)。

### 4.1 导向性传输介质

导向性传输介质有：双绞线、同轴电缆、光纤

- 双绞线

  双绞线是古老、又最常用的传输介质，它由两根采用一定规则并排绞合的、相互绝缘的铜导线组成。绞合可以减少对相邻导线的电磁干扰。

  为了进一步提高抗电磁干扰能力，可在双绞线的外面再加上一个由金属丝编织成的屏蔽层，这就是屏蔽双绞线(STP)，无屏蔽层的双绞线就称为非屏蔽双绞线(UTP)。

  <img src="https://image.sybblogs.fun/img-common/202402182037691.png" alt="双绞线" style="zoom:33%;" />

  生活中常见的双绞线：

  <img src="https://image.sybblogs.fun/img-common/202402182038308.png" alt="双绞线2" style="zoom:33%;" />

  双绞线特点：双绞线价格便宜，是最常用的传输介质之一，在局域网和传统电话网中普遍使用。模拟传输和数字传输都可以使用双绞线，其通信距离一般为几公里到数十公里。距离太远时，对于模拟传输，要用放大器放大衰减的信号。对于数字传输，要用中继器将失真的信号整形。

- 同轴电缆

  同轴电缆由导体铜质芯线、绝缘层、网状编织屏蔽层和塑料外层构成。按特性阻抗数值的不同，通常将同轴电缆分为两类：$50\Omega$同轴电缆和$75\Omega$同轴电缆。其中，$50\Omega$同轴电缆主要用于传送基带数字信号，又称为基带同轴电缆，它在局域网中得到广泛应用。$75\Omega$同轴电缆主要用于传送宽带信号，又称为宽带同轴电缆，它主要用于有线电视系统。

  <img src="https://image.sybblogs.fun/img-common/202402182042287.png" alt="同轴电缆" style="zoom:33%;" />

  生活中常见的同轴电缆：

  <img src="https://image.sybblogs.fun/img-common/202402182043392.png" alt="同轴电缆2" style="zoom:33%;" />

同轴电缆与双绞线对比：由于外导体屏蔽层的作用，同轴电缆抗干扰特性比双绞线好，被广泛用于传输较高速率的数据，其传输距离更远，但价格较双绞线贵。

- 光纤

  光纤通信就是利用光导纤维(简称光纤)传递光脉冲来进行通信。有光脉冲表示$1$，无光脉冲表示$0$。而可见光的频率大约是$10^8$MHz，因此光纤通信系统的带宽远远大于目前其他各种传输媒体的带宽。

  光纤在发送端有光源，可以采用发光二极管或半导体激光器，它们在电脉冲作用下能产生出光脉冲。在接收端用光电二极管做成光检测器，在检测到光脉冲时可还原出电脉冲。

  光纤主要由纤芯(实心的)和包层构成，光波通过纤芯进行传导，包层较纤芯有较低的折射率。当光线从高折射率的介质射向低折射率的介质时，其折射角将大于入射角。因此，如果入射角足够大，就会出现**全反射**，即光线碰到包层时候就会折射回纤芯、这个过程不断重复，光也就沿着光纤传输下去。

  <img src="https://image.sybblogs.fun/img-common/202402182048128.png" alt="光纤" style="zoom:33%;" />

  所以光纤具有超低损耗，传送超远距离特点。实际上可以射入多条光线。如果射入多条光线就有了多模光纤和单模光纤。

  多模光纤：

  <img src="https://image.sybblogs.fun/img-common/202402182050363.png" alt="多模光纤" style="zoom:33%;" />

  多模光纤可以在发送端发射多条光线。但是反射过程中损耗明显，所以适合近距离传输。

  单模光纤：

  <img src="https://image.sybblogs.fun/img-common/202402182051477.png" alt="单模光纤" style="zoom:33%;" />

  将光纤的直径减小到只有一个光的波长，所以光纤就沿着直线传播，基本上没有发生反射。适合远距离传输。

  两种光纤对比：

  <img src="https://image.sybblogs.fun/img-common/202402182054288.png" alt="两种光纤对比" style="zoom: 25%;" />

  生活中常见的光纤：

  <img src="https://image.sybblogs.fun/img-common/202402182054734.png" alt="光纤2" style="zoom:25%;" />

  而将多根光纤放在一起就是光缆，一根光缆少则只有一根光纤，多则包括十至数百根光纤：

  <img src="https://image.sybblogs.fun/img-common/202402182057183.png" alt="光纤3" style="zoom:25%;" />

  光线特点：

  1. 传输损耗小，中继距离长，对远距离传输特别经济。
  2. 抗雷电和电磁干扰性能好。
  3. 无串音干扰，保密性好，也不易被窃听或截取数据。
  4. 体积小，重量轻。

### 4.2 非导向性传输介质

非导向性传输介质常见的有三类：无线电波(信号向所有方向传播)、微波(信号固定方向传播)、红外线和激光(信号固定方向传播)。

- 无线电波

  有较强穿透能力，可传远距离，广泛用于通信领域(如手机通信)。

- 微波

  微波通信频率较高、频段范围宽，因此数据率很高。

  应用：地面微波接力通信(微波像接力一样在地表被各个中继站传输到其他中继站)、卫星通信(将中继站放到真空环境下，只需要三个中继卫星就可以实现全球通信)。

  卫星通信优点：通信容量大、距离远、覆盖广、可以实现广播通信和多址通信。

  卫星通信缺点：传播时延长($250\sim270$ms)、受气候影响大(如：强风、太阳黑子爆发、日凌等)、误码率较高、成本高。

- 红外线与激光

  把要传输的信号分别**转换为各自的信号格式**，即红外光信号和激光信号，再在空间中传播。

传输介质总结：

<img src="https://image.sybblogs.fun/img-common/202402182110647.png" alt="传输介质总结" style="zoom:33%;" />

## 5. 中间设备

诞生原因：由于存在损耗，在线路上传输的信号功率会逐渐衰减，衰减到一定程度时将造成信号失真，因此会导致接收错误。

### 5.1 中继器

中继器的功能：对信号进行再生和还原，对衰减的信号进行放大，保持与原数据相同，以增加信号传输的距离，延长网络的长度。

<img src="https://image.sybblogs.fun/img-common/202402191246473.png" alt="中继器" style="zoom:33%;" />

上图是中继器，其功能可以概况为：再生数字信号。对于模拟信号处理是放大器，这里不做考察。

中继器的两端：两端的网络部分是网段，而不是子网，适用于完全相同的两类网络的互连，且两个网段速率要相同。中继器只将任何电缆段上的数据发送到另一段电缆上，它仅作用于信号的电气部分，并不管数据中是否有错误数据或不适于网段的数据。

且中继器两端可连相同媒体，也可连不同媒体。中继器两端的网段一定要是同一个协议(中继器不会存储转发)。

5-4-3规则：网络标准中都对信号的延迟范围作了具体的规定，因而中继器只能在规定的范围内进行，否则会网络故障。这个规则规定了一个网段内只能有五个网段、在这五个网段内只能有四个物理层网络设备(中继器)、并且只有三个段可以挂接计算机。

<img src="https://image.sybblogs.fun/img-common/202402191254070.png" alt="543规则" style="zoom:33%;" />

### 5.2 集线器(多口中继器)

功能与中继器一样，都是将信号再生，放大的设备。

集线器的功能：对信号进行再生放大转发，对衰减的信号进行放大，接着转发到其他所有(除输入端口外)处于工作状态的端口上，以增加信号传输的距离，延长网络的长度。不具备信号的定向传送能力，是一个共享式设备。

<img src="https://image.sybblogs.fun/img-common/202402191258622.png" alt="集线器" style="zoom:33%;" />

上面一个集线器连接五台计算机。集线器通常的拓扑结构就是星形拓扑。集线器可以增加信号传输距离。不具备信号定向传送能力指的是假如上面两台计算机进行通信，发送方将信号给了集线器后，集线器会对信号进行放大。发大好后会从所有端口转发出去。这就是剩下四台计算机都能接收到信号。四个接收方在接收到数据后会判断数据地址是否给自己，如果不是就会丢弃掉。这种方式也即广播方式。

正因为有这种广播形式就会产生冲突。假如两台主机通信，同时第三台也要通信，此时就会产生冲突碰撞。集线器解决方法是停止传输过段时间再传输数据。所以集线器是一个**大冲突域**。是不能分割冲突域的。

因为集线器在一个时钟周期内只能实现一组通信。所以一台集线器连接数目较多，而且其他主机都要同时进行通信这样就会导致产生信息碰撞，降低集线器传输数据效率。故**连在集线器上的工作主机平分带宽**。

# 三. 数据链路层

知识点预览：

<img src="https://image.sybblogs.fun/img-common/202402191315479.png" alt="数据链路层知识预览" style="zoom: 25%;" />

数据链路层研究思想如下：

<img src="https://image.sybblogs.fun/img-common/202402191321283.png" alt="数据链路层" style="zoom: 25%;" />

可以看到数据是自上而下，先封装再解封装、再封装、最后解封装的过程。然而在研究数据链路层的时候，很多情况下只是关心协议栈中水平方向的各个数据链路层。所以当$A$主机给$B$主机发送数据时，就可以想象数据是从链路层自左向右水平发送的。

数据链路层术语：

1. 结点：指的是主机、路由器

2. 链路：网络中两个结点之间的**物理通道**，链路的传输介质主要有双绞线、光纤和微波。分为有线链路、无线链路。

   <img src="https://image.sybblogs.fun/img-common/202402191326593.png" alt="链路术语解释" style="zoom: 33%;" />

   可以看到任何两个结点之间的连线都叫做一条链路。这个链路强调的是物理层面上的物理通道。介质传输就有两种：有线的和无线的。

3. 数据链路：网络中两个结点之间的逻辑通道，把实现控制数据传输协议的硬件和软件加到链路上就构成数据链路。

4. 帧：链路层的协议数据单元，封装网络层数据报。

   所以数据链路层是负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送数据报。即将上层网络层传输的数据报安全无差错传给相邻结点。

数据链路层功能概述：数据链路层在物理层提供服务的基础上向网络层提供服务，其最基本的服务是将源自网络层来的数据**可靠**地传输到相邻结点的目标机网络层。其主要作用是**加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路。

数据链路层功能：

1. 为网络层提供服务。服务有三种：无确认无连接服务、有确认无连接服务、有确认面向连接服务。

   无确认无连接服务常常用于实时通信，或者误码率较低通信信道。即源主机在发送数据的时候不用事先跟目的主机建立好链路的连接，而且目的主机收到数据帧时候也不需要返回确认，如果帧丢失了数据链路层也不负责重发，而直接交给上一层处理。

   有确认无连接服务也是事先不需要建立连接，但是目的主机在收到数据的时候必须要发回一个确认。如果源主机发现在规定时间内没有收到目的主机确认信息，就会将刚刚没有收到确认的帧重新传输一次。可以提高链路层可靠性。适用于误码率较高的通信信道(无线通信)。

   有确认面向连接服务是最安全最可靠的。事先建立好连接，同时接收端收到一个帧之后就要返回一个确认帧。发送端收到这个确认帧才会继续发送下一个。

2. 链路管理，即管理连接的建立、维持、释放(用于面向连接的服务)过程。
3. 组帧
4. 流量控制
5. 差错控制，差错有帧错和位错两种。

## 1. 封装成帧和透明传输

封装成帧过程其实就是将网络层IP数据报加头加尾形成链路层的数据传送单元，即帧。

<img src="https://image.sybblogs.fun/img-common/202402191444218.png" alt="封装成帧" style="zoom:33%;" />

封装成帧定义：是在一段数据的前后部分添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。

上图的帧首部和帧尾部就叫帧定界符，其中包含很多控制信息。根据帧定界符接收端就可以确定帧的起始位置和结束位置。

根据帧定界符可以实现帧同步：接收方应当能从接收到的二进制比特流中区分出帧的起始和终止。

另外帧的首部到帧尾部长度叫做数据链路层的帧长。

<img src="https://image.sybblogs.fun/img-common/202402191525738.png" alt="帧长" style="zoom: 25%;" />

显然为了提高帧的传输效率，都应该使帧的数据部分尽可能大于首部和尾部，也就是说帧的数据部分会比较大。链路层协议规定规定索要传送帧的最大数据部分上限，也就是说帧的数据部分会有一个极限值。这个极限值叫做最大传送单元(MTU)。不同协议MTU长度也不同。所以在传送数据的时候，数据部分一定要$\le$最大传送单元(MTU)。

<img src="https://image.sybblogs.fun/img-common/202402191530665.png" alt="数据链路层帧长" style="zoom:25%;" />

对于发送端的组帧过程有四种常见的方法：字符计数法、字符(节)填充法、零比特填充法、违规编码法。

在具体讲述四种方法之前先了解一下透明传输概念：指不管所传数据是什么样的比特组合，都应当能够在链路上传送。因此，链路层就"看不见"有什么妨碍数据传输东西。当所传数据中的比特组合恰巧与某一个控制信息完全一样时， 就必须采取适当的措施，使收方不会将这样的数据误认为是某种控制信息。这样才能保证数据链路层的传输是透明的。

- 字符计数法

  帧首部使用一个计数字段(即第一个字节，八位)来标明帧内字符数。

  <img src="https://image.sybblogs.fun/img-common/202402191539197.png" alt="字符计数法" style="zoom:33%;" />

  对于每一个帧来说第一个字节都是规定了帧内有多少个字符数。因此就可以区分出每一个帧。

  缺点是如果第一个帧的帧首部出现错误，就会导致接收错误。接收方就会出现同步错误。

- 字符填充法

  字符填充法的帧有三个部分：SOH、装在帧中的数据部分、EOT

  <img src="https://image.sybblogs.fun/img-common/202402191546151.png" alt="字符填充法" style="zoom:33%;" />

  SOH(Start of header)：帧首部的开始字节。

  EOT(End of transmission)：帧尾部的结束字节。

  接收端根据SOH知道这是帧的开始，根据EOT知道这是帧的结束。

  适用情况：

  1. 当传送的帧是由文本文件组成时，因为文本文件的字符都是从键盘上输入的，都是ASCII码不会与SOH和EOT发送冲突。所以不管从键盘上输入什么字符都可以放在帧里传过去，即透明传输。这是一种较为理想的情况。

  2. 当传送的帧是由非ASCI码的文本文件组成时(二进制代码的程序或图像等)，帧的数据部分会与SOH和EOT发送冲突，但依然采用字符填充方法实现透明传输。

     <img src="https://image.sybblogs.fun/img-common/202402191553405.png" alt="字符填充法2" style="zoom: 25%;" />

  字符填充法具体实现如下：

  假如原始数据的数据部分出现了很多控制字符，如EOF、SOH。即发生字符与界限符冲突。此时就要对这样的原始数据进行字符填充。其实就是在控制字符前面加上转义字符。这个转义字符也是一个八位的比特组合。

  <img src="https://image.sybblogs.fun/img-common/202402191556352.png" alt="字符填充法3" style="zoom:25%;" />

  此时接收端就会将转义字符后的界限符当作数据。如果发生的界限符冲突的是转义字符，同样在前面加一个转义字符即可。这样将原始数据进行字符填充就可以放到链路上传输了。

  综上所述字符填充法就是在发送端填充转义字符，在接收端将所有转义字符全部删除，最后剩下来的就是原始数据。

- 零比特填充法

  这种方法允许数据帧中包含任意个数的比特。

  <img src="https://image.sybblogs.fun/img-common/202402191608353.png" alt="零比特填充法" style="zoom:33%;" />

  其界限符是一样的。如上图所示如果数据部分也出现一个界限符就会产生界限冲突。零比特填充法就是要解决这个问题。

  具体操作是：

  1. 在发送端，扫描整个信息字段，只要连续$5$个$1$，就立即填入$1$个$0$。

     原始数据：$0110111111110111110010\xrightarrow{5个1填入0}$$011011111\quad0\quad11101111\quad0\quad0010$

  2. 在接收端收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。发现连续$5$个$1$时，就把后面的$0$删除。

  综上所述就是在发送端填充$0$，在接收端删除$0$。

  保证了透明传输：在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误。

- 违规编码法

  是在物理层比特编码的时候来实现透明传输的方法。

  <img src="https://image.sybblogs.fun/img-common/202402191617182.png" alt="违规编码法" style="zoom: 25%;" />

  在曼彻斯特编码中每一个码元对应的电平只有：高$-$低、低$-$高两种情况。不会出现高$-$高、低$-$低这种情况。因此高$-$高、低$-$低这两种情况就是违规编码，可以将这两种违规编码作为定界帧的起始和终止。

  这种方法实现简单，局域网的IEEE802标准就采用这种方法。

四种方法对比：由于字节计数法中Count字段的脆弱性(其值若有差错将导致灾难性后果)及字符填充实现上的复杂性和不兼容性，目前较普遍使用的帧同步法是比特填充和违规编码法。

## 2. 差错控制

概括来说，传输中的差错都是由于噪声引起的。噪声分为全局性噪音和局部性噪音。

- 全局性

  由于线路本身电气特性所产生的随机噪声(热噪声)，是信道固有的，随机存在的。

  解决办法：提高信噪比来减少或避免干扰。(对传感器下手)

- 局部性

  外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因。

  解决办法：通常利用编码技术来解决。是这里重点探讨的。

这些差错来源会导致两种差错：位错(比特位出错，$1$变成$0$，$0$变成$1$)。帧错(帧丢失、帧重复、帧失序)。

对于帧错解决是如果当前对于通信质量好、有线传输链路采用无确认无连接服务。对于通信质量差的无线传输链路采用有确认无连接服务和有确认面向连接服务。

所以对于不同的链路可以采用不同的可靠传输机制。这里重点介绍位错检测和纠正问题。

首先要明确一点对于链路层的差错控制，在任何一个结点的链路层都是可以实现的。只要两个结点建立了连接关系，那么结点就需要对发送方传送来的数据进行差错检验和纠正。

检测错误采用检错编码，纠正错误采用纠错编码。其中检错编码有两种：奇偶校验码和循环冗余码CRC(普遍采用的方式)。纠错编码主要学习海明码。

链路层编码和之前的物理层编码是两个概念：数据链路层编码和物理层的数据编码与调制不同。物理层编码针对的是单个比特，解决传输过程中比特的同步等问题，如曼彻斯特编码。而数据链路层的编码针对的是一组比特，它通过冗余码的技术实现一组二进制比特串在传输过程是否出现了差错。

上面提到的冗余编码指的是在数据发送之前，先按某种关系附加上一定的冗余位，构成一个符合某一规则的码字后再发送。当要发送的有效数据变化时，相应的冗余位也随之变化，使码字遵从不变的规则。接收端根据收到码字是否仍符合原规则，从而判断是否出错。即发送方会将数据添加几位比特的冗余码，作用是冗余码和原来的数据可以构成某种规则，把这个组合发出去后，接收方就按照和发送方共同的规则来检查数据是否有问题。如果符合规则则数据没有问题，反之数据有问题。

### 2.1 检错编码

主要有奇偶校验码和循环冗余码CRC(普遍采用的方式)

#### 奇偶校验码

首先有$n-1$位信息元(即发送的数据)，以及$1$位校验元(冗余码)。

奇校验码：整个校验码(有效信息位和校验位)中$1$的个数为奇数。

偶校验码：整个校验码(有效信息位和校验位)中$1$的个数为偶数。

<img src="https://image.sybblogs.fun/img-common/202402191652875.png" alt="奇偶校验码" style="zoom:33%;" />

例子：如果一个字符S的ASCII编码从低到高依次为$1100101$，采用奇校验，在下述收到的传输后字符中，哪种错误不能检测?

> 答案：$11010011$。
>
> 因为原字符的编码采用奇校验，所以$1$的个数是奇数，然而当同时发生两位跳变时$1$的个数仍为奇数，所以$11010011$不能被检测。

奇偶校验码特点：只能检查出奇数个比特错误，检错能力为$50\%$。

#### CRC循环冗余码

是一种常见的检测方式。

原理：

1. 首先准备待传有效数据

   发送方要发送的消息是一长串的比特流，那么采用CRC时候就要在发送端将待发送的数据切割成一段又一段的小的比特组合。每段比特组合都是等长的，假设是$d$位，每一段都叫做一个组。

   <img src="https://image.sybblogs.fun/img-common/202402191703683.png" alt="CRC原理1" style="zoom:33%;" />

2. 对于每一个组都加上冗余码构成帧。

   <img src="https://image.sybblogs.fun/img-common/202402191703269.png" alt="CRC原理2" style="zoom:33%;" />

   上面$r$位帧检验序列(冗余码)确认方式：首先要引入生成多项式(双方规定的除数)，位数是$r位数+1$位。这里的$r$是多项式阶数。

   基本上题中给出的形式是$1101$这种比特形式。当然有时候也会直接给出多项式形式。如：$x^3+x^2+1$

   此时就需要将面的多项式转换为比特形式。方法是在多项式前面加上系数，再将$x$补齐：
   $$
   1·x^3+1·x^2+0·x^1+1·x^0
   $$
   这两个多项式相等，所以将前面的系数提出来，即$1101$。这个系数组成的二进制就是生成多项式。

   有时候多项式会提到阶，这个阶就是多项式最高位的$x$幂数。如上$x^3+x^2+1$最高阶是$3$。这个生成多项式是题中一定会给出的。

   此时有了这个生成多项式，也有了$d$位数据，$r$位FCS计算方式如下：

   > 在要发送数据$d$后面加上$r$位$0$。这里的$r$取决于生成多项式位数$-1$。之后再除以生成多项式。这里的除法是二进制除法(异或，同$0$异$1$)。这里会得到一个商和余数，重点是余数，这个余数就是$r$位FCS。这个$r$位FCS替换$r$位$0$即可。

   <img src="https://image.sybblogs.fun/img-common/202402191717676.png" alt="FCS帧检测序列计算方式" style="zoom: 25%;" />

3. 之后接收方收到$d+r$位数据，检验方式如下：
   $$
   d+r位数据÷生成多项式
   $$
   如果余数为$0$则认为正确接收。余数不为$0$则丢弃。

十进制解释CRC原理：

<img src="https://image.sybblogs.fun/img-common/202402191727649.png" alt="十进制解释CRC原理" style="zoom: 25%;" />

计算冗余码步骤：

1. 加$0$。假设生成多项式$G(x)$的阶为$r$，则加$r$个$0$。

   多项式$N$位，则阶就是$N-1$位。

2. 模$2$除法。数据加$0$后除以多项式，余数为冗余码FCS。

接收端检错过程：把收到的每一个帧都除以同样的除数，然后检查得到的余数$R$。若余数为$0$，判定这个帧没有差错，接受。若余数为不为$0$，判定这个帧有差错(无法确定到位)，丢弃。

例：要发送的数据是$1101011011$，采用CRC校验，生成多项式是$10011$，那么最终发送的数据应该是?

首先生成多项式$5$位，所以阶数$r=4$。故在要发送数据后面添加四个$0$：$1101011011\quad0000$

之后要发送的数据$÷$生成多项式：

<img src="https://image.sybblogs.fun/img-common/202402191731903.png" alt="生成多项式" style="zoom: 33%;" />

最后的余数就是FCS$=1110$。故最后发送的数据就是$1101011011\quad1110$。

FCS的生成以及接收端CRC检验都是由硬件实现，处理很迅速，因此不会延误数据的传输。

在数据链路层仅仅使用循环冗余检验CRC差错检测技术，只能做到对帧的无差错接收，即"凡是接收端数据链路层接受的帧，我们都能以非常接近于$1$的概率认为这些帧在传输过程中没有产生差错"。接收端丢弃的帧虽然曾收到了，但是最终还是因为有差错被丢弃。

所以在现在的传输中可以认为凡是接收端数据链路层接收的帧均无差错。

但是这种方式不是可靠传输，可靠传输是指数据链路层发送端发送什么，接收端就收到什么。而链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输，因为有些帧因为差错会被丢弃，并不会对丢弃帧做处理。

### 2.2 纠错编码

这里要学习的纠错编码是海明码。

海明码不仅可以发现错位，并找到错误位置，同时还能纠正错误。与之前学习的编码性质相同，海明码也需要加上冗余码。并且奇偶校验码和CRC循环冗余码都是在低位加上冗余位，但是海明码要根据一定规则在数据位中安插校验码。

流程：

1. 确定校验码位数$r$
2. 确定校验码和数据的位置
3. 求出校验码的值
4. 检错并纠错

这里先将一下海明距离概念：两个合法编码(码字)的对应比特取值不同的比特数称为这两个码字的海明距离(码距)。一个有效编码集中，任意两个合法编码(码字)的海明距离的最小值称为该编码集的海明距离(码距)。如：$000$和$001$之间只有一位不同，所以码距是$1$。

根据海明距离可以得到一个结论：如果要检验的跳变位数(出错)是$N$，则码距就要是$N+1$。如：码距是$2$的编码集中能检测出$1$位的比特错误，但是错误位不能被纠正。如果要纠正跳变位数是$d$，则码距为$2d+1$。如：码距是$3$的编码集中可以检测出$1$位和$2$位比特跳变出现的错误，同时能纠正$1$位跳变错误，但是不能纠正$2$位跳变错误。

具体海明码流程如下：

- 确定校验码位数$r$

  数据有$m$位，则冗余码$/$校验码有$r$位。如果有$r$位校验码，则校验码有$2^r$种取值。校验码的组合可以代表不同的位置发生错误。除了发生错误还有一种没有错误的情况，所以这里校验码表示可能性要大于或等于出错情况和没出错总和(海明不等式)。而出错情况可能是数据$m$位发生错误，也可能是校验码$r$位，故$m+r$。即：
  $$
  2^r\ge m+r+1
  $$
  例子：如果要发送的数据是$1100$。

  > 数据的位数$m=4$，将$4$带入不等式用穷举法可以得到满足不等式的最小$r=3$
  >
  > 也就是$D=1100$的海明码应该有$4+3=7$位，其中原数据$4$位，校验码$3$位。所以其中原数据$4$位，校验码$3$位。

- 确定校验码和数据的位置

  规定校验码放在序号为$2^n$的位置，数据按序填上。

  如：要发送的数据是$1100$，上一步求出的校验码是$3$位。

  > 则需要在由低位到高位的，$2^0=1,2^1=2,2^2=4$的位置依次填入校验码。填入之后，数据依次填入。

  <img src="https://image.sybblogs.fun/img-common/202402191815650.png" alt="海明校验码" style="zoom:33%;" />

- 求出校验码的值

  这一步有一个关键思想：分组。

  例子：如果要发送的数据是$1100$。上一步求出的校验码是$3$位，对应的结构如下(上面的二进制是序号)：

  <img src="https://image.sybblogs.fun/img-common/202402191822472.png" alt="海明校验码2" style="zoom:33%;" />

  $3$位的检验码可以判断出$1$开头的错误(`1**`)和$1$在中间的错误(`*1*`)、以及$1$在末尾的错误(`**1`)。对应如下：

  <img src="https://image.sybblogs.fun/img-common/202402191825094.png" alt="海明校验码3" style="zoom:33%;" />

  可以看到：

  $4$号校验码负责$4,5,6,7$位的校验。$2$号校验码负责$2,3,6,7$位的校验。$1$号校验码负责$1,3,5,7$位的校验。

  所以相当于根据校验位实现对所有数据进行分组。分组后求出校验码可以采用奇偶校验方式求出(通常采用偶校验)。

  采用偶校验让$4$号校验码负责$4,5,6,7$，这四位出现偶数个$1$。可以看到$4,5,6,7$位置对应的值是$x_4011$，故$x_4=0$。

  同理可以得到$2,3,6,7$位对应的值是$x_2011$，即$x_2=0$。同理可得$x_1=1$。

  故完整海明码如下：

  <img src="https://image.sybblogs.fun/img-common/202402191831321.png" alt="完整海明码" style="zoom:33%;" />

- 检错并纠错

  若接收方收到的数据为$1110001$，检错类似奇偶校验

  按照校验码负责校验位将数据写出来：

  $4$号校验码负责$4,5,6,7$位的校验：$0,1,1,1$

  $2$号校验码负责$2,3,6,7$位的校验：$0,0,1,1$

  $1$号校验码负责$1,3,5,7$位的校验：$1,0,1,1$

  由于是偶校验，可以看到$2$号和$1$号发生错误。

  纠错方法一：找到不满足奇$/$偶校验的分组取交集，并与符合校验的分组取差集。可以看到$4,5,6,7$和$1,3,5,7$中并集是$5,7$所以出错的位置可能是$5,7$，但是$2$号负责的校验位没错其中包括$7$，所以排除$7$，错误的位置就是$5$。

  纠错方法二：

  先将上面的校验位写出来：
  $$
  \left|
  \begin{array}{1}
  x_4&0&1&1&1\\
  x_2&0&0&1&1\\
  x_1&1&0&1&1
  \end{array}
  \right|
  $$
  如果上面矩阵每一行都满足偶校验，则$x_4=1,x_2=0,x_1=1$。可以采用每一行异或得出$x_4,x_2,x_1$。

  将上面结果从高位到低位排列成二进制数：$101$，转换为十进制就是$5$，所以错误的位置就是$5$。

差错控制总结：

<img src="C:\Users\Acid\OneDrive\图片\本机照片\408\计算机网络\差错控制总结.png" alt="差错控制总结" style="zoom: 25%;" />

## 3. 流量控制与可靠传输机制

**较高的发送速度**和**较低的接收能力**的不匹配，会造成传输出错，因此流量控制也是数据链路层的一项重要工作。

链路层和网络层都有流量控制，区别是：

1. 数据链路层的流量控制是点对点的，而传输层的流量控制是端到端的。即链路层流量控制是两个结点之间的(因为中间会有交换系统)。
2. 数据链路层流量控制手段：接收方收不下就不回复确认。而传输层流量控制手段：接收端给发送端一个窗口公告。

流量控制方法有两种：滑动窗口协议、停止等待协议(一种特殊的滑动窗口协议)。其中滑动窗口协议又包括两种：后退$N$帧协议(GBN)和选择重传协议(SR)。

- 停止等待协议

  每发送完一个帧就停止发送，等待对方的确认，在收到确认后再发送下一个帧。

  <img src="https://image.sybblogs.fun/img-common/202402191944876.png" alt="流量控制方法" style="zoom: 25%;" />

  可以看到这种方式传输效率很低。

- 滑动窗口协议

  假如发送端的发送窗口有$6$个，而接收端的接收窗口有$1$个

  <img src="https://image.sybblogs.fun/img-common/202402191948637.png" alt="滑动窗口" style="zoom:25%;" />

  当前发送方发送$0$号帧给接收方，接收端收到了$0$号帧之后就可以返回给发送端一个确认帧，同时自己的窗口可以向前移动一位。

  <img src="https://image.sybblogs.fun/img-common/202402191949148.png" alt="滑动窗口2" style="zoom: 25%;" />

  当发送窗口收到由接收端发送的$0$号确认帧之后，就可以继续往后移动，发送$1$号帧。

  <img src="https://image.sybblogs.fun/img-common/202402191950710.png" alt="滑动窗口3" style="zoom:25%;" />

  当然也有可能发送$1$号帧之后，接收窗口没有回复，发送窗口就会接着发送后面的$2,3,4\cdots$。可以将发送窗口的所有帧都发送出去，直到接收到一个确认帧才可以往前移动一格。

三种协议窗口大小：

停止等待协议：发送窗口大小$=1$，接收窗口大小$=1$。

后退N帧协议(GBN)：发送窗口大小$>1$，接收窗口大小$=1$。

选择重传协议(SR)：发送窗口大小$>$1，接收窗口大小$>$1。

链路层的滑动窗口大小是固定的。

可靠传输、滑动窗口、流量控制区别：

- 可靠传输：发送端发啥，接收端收啥。

- 流量控制：控制发送速率，使接收方有足够的缓冲空间来接收每一个帧。
- 滑动窗口解决两个问题：流量控制和可靠传输。

流量控制滑动窗口可靠传输总览：

<img src="https://image.sybblogs.fun/img-common/202402192000637.png" alt="流量控制滑动窗口可靠传输总览" style="zoom:33%;" />

### 3.1 停止-等待协议

在链路上除了比特(每一帧)会发生差错，底层信道还会出现丢包问题。

丢包：物理线路故障、设备故障、病毒攻击、路由信息错误等原因，会导致数据包的丢失。这里的数据包其实就是一个数据，在链路层可以叫做帧，在网络层可以叫做IP数据报或者是分组，在传输层可以叫做报文段。

为了解决这个丢包问题，同时也为了实现流量控制，就需要有这样的停止等待协议。

> 虽然现在常用全双工通信方式，但为了讨论问题方便，仅考虑一方发送数据 (发送方)，一方接收数据(接收方)。且因为是在讨论可靠传输的原理，所以并不考虑数据是在哪一个层次上传送的。

"停止等待"协议就是每发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组。

停止等待协议两种应用情况：无差错情况和有差错情况

- 无差错情况

  <img src="https://image.sybblogs.fun/img-common/202402201314699.png" alt="无差错情况" style="zoom: 25%;" />

  发送方发送数据，先发送$0$号帧，接收方会收下$0$号帧，之后回复一个对$0$号帧的确认(ACK0)。发送方接收到这个$0$号确认帧后会接着发送$1$号帧。之后每一帧发送过程和接收过程一样。

  要注意每发送$1$个数据帧就停止并等待，因此用$1$bit来编号就够。

- 有差错情况

  但是在实际中经常出现差错。出现差错有以下几种情况：

  1. 数据帧丢失或检测到帧出错

     计算机内部会有一个超时计时器：每次发送一个帧就启动一个计时器。如果发送方发送一帧，在计时器结束后发送方还没有收到接收方的确认消息，发送方会再次将这一帧发送给接收方。

     <img src="https://image.sybblogs.fun/img-common/202402201343729.png" alt="有差错情况" style="zoom:25%;" />

     这里的超时计时器设置的重传时间应当比帧传输的平均RTT(帧往返传播时延，即一帧开始发送到发送方收到确认帧这段时间)更长一些。

     实现这个重传机制，需要在发送方发完一个帧后，必须保留这个帧的副本。并且数据帧和确认帧必须编号，即接收端如果收到两个帧编号一致，就可以知道这是一个重传帧，所以这个编号可以解决接收端帧的重复、帧的丢失问题。

     同时，如果接收端发现帧出现错误，接收端会丢弃掉这个帧，并且也不会给发送端发送帧确认消息。所以之后在计时器结束后发送端会再次发送这一帧。

  2. ACK丢失(确认帧丢失)

     因为有超时计时器帮助，所以当确认帧丢失后，发送端在计时器结束后会继续向接收端发送刚刚没有收到确认帧的那一帧，接收端在收到这个帧后根据帧编号会丢弃掉重复的帧，重传确认帧给接收端。

     <img src="https://image.sybblogs.fun/img-common/202402201354628.png" alt="ACK丢失" style="zoom:25%;" />

  3. ACK迟到

     <img src="https://image.sybblogs.fun/img-common/202402201358632.png" alt="ACK迟到" style="zoom:25%;" />

     如上图，当发送端发送$0$号帧之后，接收端发送确认帧时出现确认帧迟到，所以在计时器结束后发送端会再次重复发送这一帧，接收端在收到这一帧后发现帧编号重复会丢弃掉，并再次给发送端发送确认帧，这次发送端收到确认帧后接着发送$1$号帧，但发送完$1$号帧之后又收到$0$号确认帧，此时发送端会发现帧编号重复从而丢弃这个确认帧。

可以看到使用确认及超时重传机制可以使得在不可靠的传输网络上实现相对来说比较可靠的通信。

停止等待协议性能分析：优点是简单易于实现。缺点是信道利用率太低。

这里的信道利用率指发送方在一个发送周期内，有效地发送数据所需要的时间占整个发送周期的比率。公式为：
$$
信道利用率=(L/C)/T
$$
$T$是发送周期，即从开始发送数据到收到第一个确认帧为止这段时间。$L$是数据帧长度，即在这样一个周期内能够发送多少比特的数据。$C$指发送方的数据传输率，即发送方的发送速率。另外还需要知道信道吞吐率：
$$
信道吞吐率=信道利用率*发送方的发送速率
$$
<img src="https://image.sybblogs.fun/img-common/202402201409961.png" alt="停止等待协议性能分析" style="zoom:25%;" />

如上图，信道利用率$U$为：
$$
U=\frac{T_D}{T_D+RTT+T_A}
$$
所以可以看到停止等待协议信道利用率很差。

例题：一个信道的数据传输率为$4$kb/s，单向传播时延为$30$ms，如果使停止等待协议的信道最大利用率达到$80\%$，要求的数据帧长度至少为多少？

> 设数据帧长度为$L$，数据传输率为$4$kb/s，即$C=4$。
>
> 且单向传输时延是$30$ms。所以$T$一个周期总时延$=L/4+2*30$。并且题中要求利用率$80\%$。

$$
80\%=\frac{L/4}{L/4+2*30}=960bit
$$

上面每次只发送一帧，所以导致通道利用率不高，所以发送端可以一次发送多帧：

<img src="https://image.sybblogs.fun/img-common/202402201502189.png" alt="流水线技术" style="zoom:25%;" />

这种一次发送多帧技术称为流水线技术。同时要对停止等待协议做出一定的改进：

1. 必须要增加一个序号范围。

   每个传送的帧必须有一个唯一的编号。如上图中一次发送三个数据帧，要保证这三个数据帧都是不同的编号。

2. 发送方必须要缓存多个分组

   每次需要缓存发送帧所有副本，及时在丢帧，错帧时重传帧。

停止等待协议总结：

<img src="https://image.sybblogs.fun/img-common/202402201424750.png" alt="停止等待协议总结" style="zoom:25%;" />

### 3.2 后退N帧协议(GBN)

上面的流水线技术下也有可能会出现发送帧丢失、迟到等现象。为了解决这些差错有了后退N帧协议和选择重传协议。

对于要发送的所有帧会分别进行编号。但是这里的编号可以复用。因为有发送窗口这样一个概念：发送方维持一组连续的允许发送的帧的序号。简单来说发送方要发送的数据必须在发送窗口中。

<img src="https://image.sybblogs.fun/img-common/202402201510947.png" alt="发送窗口" style="zoom: 33%;" />

同样接收方也维护一个接收窗口：指接收方维持一组连续的允许接收帧的序号。这里接收窗口只能有一个。

<img src="https://image.sybblogs.fun/img-common/202402201511666.png" alt="接收窗口" style="zoom:33%;" />

发送流程：

1. 首先发送方要发送$0$号帧，同时会留下这个$0$号帧副本(下图橙色部分)，接下来在传送过程中$1$号帧也是可以发送的(只要在发送窗口中的帧都可以发送)。

   <img src="https://image.sybblogs.fun/img-common/202402201514331.png" alt="后退N帧协议执行流程1" style="zoom:25%;" />

   $0$号帧到达接收方后，接收方会给发送方一个确认帧。接下来发送方和接收方窗口都会进行一个窗口前移任务。

   <img src="https://image.sybblogs.fun/img-common/202402201516164.png" alt="后退N帧协议执行流程2" style="zoom:25%;" />

   至此$0$号帧传输完毕。

2. 接着$1$号帧也会到接收方，这里实际上并不会对每一帧都发送确认帧(**累计确认**特性)，假如现在发送端同时发送$1,2,3$号帧，接收端窗口已经移动到$3$号窗口，此时只用给发送端发送$3$号确认帧即可。当接收端收到发送端$3$号确认帧后，会默认前面$1,2$号帧都已经被接收。接着发送端再往前移动$3$个窗口即可。

可以看到发送窗口有四区域组成：已经发送完的帧、已经发送但是等待确认的帧、还能发送的帧(可以有空)、还不能发送的帧(还没有在发送窗口中)

<img src="https://image.sybblogs.fun/img-common/202402201522293.png" alt="后退N帧协议执行流程3" style="zoom:25%;" />

再看一下发送方和接收方具体细节，即GBN中发送方必须响应的三件事：

- 上层调用

  即网络层如果要让链路层发送数据，链路层应该在GBN协议中做什么。

  上层要发送数据时，发送方先检查发送窗口是否已满，如果未满，则产生一个帧并将其发送。如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。上层等一会儿再发送。(实际实现中， 发送方可以缓存这些数据，窗口不满时再发送帧)。

- 收到一个ACK(确认帧)

  GBN协议中，对$n$号帧的确认采用==累积确认的方式==，标明接收方已经收到$n$号帧和它之前的全部帧。

- 超时事件

  协议的名字为后退N帧$/$回退N帧，来源于出现丢失和时延过长帧时发送方的行为。就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。如果出现超时，发送方重传所有已发送但未被确认的帧(多个帧)。

GBN协议中接收方要做的事：

- 如果正确收到$n$号帧，并且按序，那么接收方为$n$帧发送一个$ACK_n$， 并将该帧中的数据部分交付给上层。

- 其余情况都丢弃帧，并为最近按序接收的帧重新发送ACK。接收方无需缓存任何失序帧，只需要维护一个信息：`expectedseqnum`(下一个按序接收的帧序号)。

  <img src="https://image.sybblogs.fun/img-common/202402201738766.png" alt="后退N帧协议执行流程4" style="zoom:25%;" />

  假设发送窗口尺寸为$4$，发送端发送$0,1,2,3$号帧，此时$0,1$号帧接收端收到后返回确认帧，接收端窗口后移到$2$号窗口，即`expectedseqnum=2`下一个期待收到的是$2$号帧。但是$2$号帧发送丢失，之后的$3$号帧虽然被接收端接收，但与接收窗口值不对应，所以丢弃，并向发送端发送当前已经接收的最大序列号确认帧，即$1$号确认帧。

  接着接收方收到$0$号确认帧，放松$4$号帧。紧接着又会收到$1$号确认帧，发送$5$号帧，由于接收端没有收到$2$号帧，所以这里的$4,5$号帧都会被丢弃，并发送$1$号确认帧。

  直到$2$号帧发送端的计时器超时结束，此时发送端会重新发送$2,3,4,5$号帧。

注意这里的发送方滑动窗口并不是可以无限大。若采用$n$个比特对帧编号，那么发送窗口的尺寸$W_T$应满足：$1\le W_T\le2^n-1$。因为发送窗口尺寸过大，就会使得接收方无法区别新帧和旧帧。

> 假如$2$个比特位进行编号，标号能表示四位$0,1,2,3$。那么发送端窗口尺寸大小就是$1\le W_T\le2^2-1=3$

GBN协议重点总结：

1. 累积确认

   如果接收方按序接收到$n$个帧，此时就会返回第$n$号帧的确认帧。此时发送端在收到这个确认帧之后就会认为$n$号帧及$n$号帧之前的都已经被接收端接收到。

2. 偶尔捎带确认

   接收方也可以给发送方发送数据，在发送数据时，接收方可以将确认帧放到要发给发送端的数据中。

3. 接收方只按顺序接收帧，不按序无情丢弃。

   `expectedseqnum`中保存的值就是下一个期望接收的值。

4. 确认序列号最大的、按序到达的帧

5. 发送窗口最大为$2^n-1$，接收窗口大小为$1$

例1：数据链路层采用了后退N帧( GBN )协议，发送方已经发送了编号为$0\sim7$的帧。当计时器超时时，若发送方只收到$0,2,3$号帧的确认,则发送方需要重发的帧数量是多少？

> 由于有累计确认机制，所以这里再超时后接收到最大帧号是$3$，这就意味着$3$号帧及之前的帧都已经确认，所以会接着发送$4,5,6,7$四个帧。

例2：主机甲与主机乙之间使用后退N帧协议(GBN )传输数据，甲的发送窗口尺寸为$1000$，数据帧长为$1000$字节，信道带宽为$100$Mb/s，乙每收到一个数据帧立即利用一个短帧(忽略其传输延迟)进行确认，若甲、乙之间的单向传播时延是$50$ms，则甲可以达到的最大平均数据传输率约为多少?

> 先计算甲发送全部数据需要事件：甲一次要发送比特位数是$1000\times (1000\times8)$，且带宽是$100$Mb/s，所以发送一次所需要时间是$\frac{1000\times (1000\times8)}{100Mb/s}=80$ms。即甲一次全部传输需要$80$ms。
>
> 再计算甲发送第一个帧之后，收到确认帧时间：甲、乙之间的单向传播时延是$50$ms，所以一帧往返时延是$2\times50+\frac{1000\times8}{100Mb/s}=100.08$ms。
>
> 接着这两个数据就课看出，甲在发送完窗口中所有数据后($80$ms)，还没有收到第一个帧的确认帧($需要100.08$)ms。
>
> 所以一个往返时延是$100.08$ms，总共需要传输$1000\times (1000\times8)$，那么平均数据传输率就是$\frac{1000\times (1000\times8)}{100.08ms}=80$Mb/s

GBN协议优点：因连续发送数据帧而提高了信道利用率。

GBN协议缺点：在重传时必须把原来已经正确传送的数据帧重传，使得传送效率降低。

后退N帧协议总结：

<img src="https://image.sybblogs.fun/img-common/202402201824942.png" alt="后退N帧协议总结" style="zoom:33%;" />

### 3.3 选择重传协议(SR)

解决GBN协议中批量重传的问题方法是：设置单个确认，同时加大接收窗口，设置接收缓存，缓存乱序到达的帧。这就是本节课要将的选择重传协议(SR)核心思想。

SR协议中接收方和发送方都有窗口：

<img src="https://image.sybblogs.fun/img-common/202402201904106.png" alt="SR协议" style="zoom:25%;" />

如上图窗口的接收窗口和发送窗口都为$4$。

发送方窗口可以由发完被确认的、已经发送但等待确认的、发完被确认的、还能发送的、还不能发的这几部分组成：

<img src="https://image.sybblogs.fun/img-common/202402201908688.png" alt="SR协议组成" style="zoom: 33%;" />

接收方由希望收到但没收到的、收到且确认的(缓存)、等待接收的、已经接收、还不能被接收的：

<img src="https://image.sybblogs.fun/img-common/202402201911691.png" alt="SR协议组成2" style="zoom: 33%;" />

SR发送方必须响应的三件事：

1. 上层调用

   从上层收到数据后，SR发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧。否则就像GBN一样，要么将数据缓存，要么返回给上层之后再传输。

2. 收到了一个ACK

   如果收到ACK，假如该帧序号在窗口内，则SR发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界(最左边第一个窗口对应的序号)，则窗口向前移动到具有最小序号的未确认帧处。如果窗口移动了并且有序号在窗口内的未发送帧，则发送这些帧。

   <img src="https://image.sybblogs.fun/img-common/202402201924458.png" alt="SR发送方必须响应的三件事" style="zoom:33%;" />

   如上图，$0,1,3$号帧是已经确认接收的，$2,4$号帧是已发送但未被接收的，$5$号帧内还没有数据。假如此时接收端发送来了$2$号确认帧。此时窗口就可以往前移动到$4$号位置。

   <img src="https://image.sybblogs.fun/img-common/202402201928011.png" alt="SR发送方必须响应的三件事2" style="zoom:33%;" />

3. 超时事件

   每个帧都有自己的定时器，一个超时事件发生后只重传一个帧。

SR接收方要做的事：

1. 窗口内的帧来者不拒

   SR接收方将确认一个正确接收的帧而不管其是否按序。失序的帧将被缓存，并返回给发送方一个该帧的确认帧(收谁确认谁)，直到所有帧(即序号更小的帧)皆被收到为止，这时才可以将一批帧按序交付给上层，然后向前移动滑动窗口。

   <img src="https://image.sybblogs.fun/img-common/202402201933149.png" alt="SR接收方要做的事" style="zoom:33%;" />

   上图$5$号帧代表将要接收到数据，$6$号帧表示已经正确接收了帧并且返回确认帧。假如当前来了$7$号帧，会将这个$7$号帧缓存起来，等到$5$号帧到来。

   <img src="https://image.sybblogs.fun/img-common/202402201936335.png" alt="SR接收方要做的事2" style="zoom:33%;" />

   假如$5$号帧也确认正确接收，则滑动窗口会直接$0$号帧。如果收到了窗口序号外(小于窗口下界，即下图窗口左边)的帧，就返回该帧的ACK。其他情况则忽略该帧。

   <img src="https://image.sybblogs.fun/img-common/202402201940184.png" alt="SR接收方要做的事3" style="zoom:33%;" />

SR协议运行过程：

假设当前有$7$帧数据需要发送端发送，且窗口大小都为$4$。

- 首先发送端发送$0,1,2,3$号帧，此时接收端接收到$0,1$号帧，并向发送端发送确认帧，但是$2$号帧丢失。

  <img src="https://image.sybblogs.fun/img-common/202402201951186.png" alt="SR协议执行过程" style="zoom:25%;" />

- 之后的$3$号帧成功被接收端接收，并发送确认帧。接着接收端收到$0$号确认帧，此时窗口向前移动一格，接着会受到$1$号确认帧，窗口再往前移动一格。这里的$3,4,5$都被接收端接收并缓存。

  <img src="https://image.sybblogs.fun/img-common/202402201952852.png" alt="SR协议执行过程2" style="zoom:25%;" />

- 由于接收端没有收到$2$号帧，所以接收窗口只能移动到$2$号位置。之后$2$号帧计数器超时结束，发送端重新发送$2$号帧。

  <img src="https://image.sybblogs.fun/img-common/202402201952182.png" alt="SR协议执行过程3" style="zoom:25%;" />

- 之后接收端接收到$2$号确认帧。接收端窗口移动：

  <img src="https://image.sybblogs.fun/img-common/202402201953619.png" alt="SR协议执行过程4" style="zoom: 33%;" />

注意这里的滑动窗口并不是可以无限大。若采用$n$个比特对帧编号，那么SR协议中发送窗口的尺寸$W_T$和接收窗口尺寸$T_R$应满足：$W_{Tmax}=W_{Rmax}=2^{n-1}$。因为发送窗口尺寸过大，就会使得接收方无法区别新帧和旧帧。

> 假如用$2$个比特位进行编号，可以表示$0,1,2,3$四位数字。那么对应接收和发送窗口尺寸是$W_{Tmax}=W_{Rmax}=2^{2-1}=2$

这里发送窗口最好等于接收窗口。因为大了会溢出，小了没意义。

SR协议重点总结：

1. 对数据帧逐一确认，收一个确认一个

   只对窗口内的帧。

2. 只重传出错的帧。

3. 接收方有缓存

4. 若采用$n$个比特对帧编号，那么SR协议中发送窗口的尺寸$W_T$和接收窗口尺寸$T_R$应满足：$W_{Tmax}=W_{Rmax}=2^{n-1}$

例子：数据链路层采用了选择重传(SR)协议，发送方已经发送了编号为$0\sim3$的帧。现已收到$1$号帧的确认，而$0、2$号帧依次超时，则发送方需要重传的帧数是多少？

> 由于$1$号帧确认，且$3$号帧情况未知，所有重传帧是$0,2$，即重传帧数是$2$。

SR协议总结：

<img src="https://image.sybblogs.fun/img-common/202402202011268.png" alt="SR协议总结" style="zoom: 33%;" />

## 4. 介质访问控制

传输数据使用的两种链路：点对点链路、广播式链路。

点对点链路：两个相邻节点通过一个链路相连，没有第三者。应用：PPP协议，常用于广域网。如：两个人打电话。

广播式链路：所有主机共享通信介质。应用：早期的总线以太网、无线局域网，常用于局域网。典型拓扑结构有总线型、星型(逻辑总线型)。如：对讲机。常用介质访问控制协议。

<img src="https://image.sybblogs.fun/img-common/202402202020342.png" alt="总线型和星型" style="zoom:33%;" />

假如当前采用总线型，如果同时有两个人往中间的链路发送消息，就会导致消息冲突。介质访问控制就是要解决这个问题。

介质访问控制的内容就是，采取一定的措施， 使得两对节点之间的通信不会发生互相干扰的情况。介质访问控制可以分为两类：静态划分信道和动态分配信道(灵活)。

这里的静态划分信道就是信道划分介质访问控制是本节得学习重点。主要包括四种控制方式：频分多路复用**FDM**、时分多路复用**TDM**、波分多路复用**WDM**、码分多路复用**CDM**。

而动态分配信道会在之后介绍，动态分配信道分为两种：轮询访问介质访问控制(常用协议是令牌传递协议)、**随机访问介质访问控制**(主要有ALOHA协议、CSMA协议、**CSMA$/$CD协议**、**CSMA$/$CA协议**)。

介质访问控制总览：

<img src="https://image.sybblogs.fun/img-common/202402202028025.png" alt="介质访问控制总览" style="zoom:25%;" />

### 4.1 信道划分介质访问控制

信道划分介质访问控制：将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把时域和频域资源合理地分配给网络上的设备。这种预先分配信道的方式是静态分配方式(静态划分信道)。

<img src="https://image.sybblogs.fun/img-common/202402202035153.png" alt="信道划分介质" style="zoom: 25%;" />

如上图，当前有三组计算机进行通信。这里引用多路复用技术：把多个信号组合在一条物理信道上进行传输，使得多个计算机或终端设备共享信道资源，提高信道利用率。采用多路复用技术后通信状态如下：

<img src="https://image.sybblogs.fun/img-common/202402202036296.png" alt="信道划分介质2" style="zoom:25%;" />

中间得信道是共享信道，这三台发送端数据都可以在信道上进行传输。

<img src="https://image.sybblogs.fun/img-common/202402202037884.png" alt="多路复用技术" style="zoom:33%;" />

可以看到三台发送端将数据通过复用器发送到链路上，在接收端再通过分用器将合起来的数据分别送到对应的目的主机。

这种多路复用技术就是把一条广播信道，逻辑上分成几条用于两个节点之间通信的互不干扰的子信道，实际就是把广播信道转变为点对点信道。

上面的数据都在一条信道也不会干扰，是因为采用了信道划分介质访问控制。包括四种控制方式

- 频分多路复用FDM

  用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽(频率带宽)资源。

  这里的带宽是通信过程中的频率带宽，以Hz为单位

  <img src="https://image.sybblogs.fun/img-common/202402202047398.png" alt="FDM" style="zoom: 33%;" />

  特点是充分利用传输介质带宽，系统效率较高。由于技术比较成熟，实现也比较容易。

- 时分多路复用TDM

  与上面的FDM区别在于TDM的每一个主机并不是任何一个时间都占用信道，是交替使用信道，且频率一致。

  将时间划分为一段段等长的时分复用帧(TDM帧)。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙，所有用户轮流占用信道。

  <img src="https://image.sybblogs.fun/img-common/202402202055917.png" alt="TDM" style="zoom:33%;" />

  上面的TDM帧是在物理层传送的比特流所划分的帧，标志一个周期。和链路层的帧不是同一个。

  这种方式信道利用率较低。假如一个TDM帧传输$8000$b/s，一个TMD帧有四个时隙，即四个用户，所以每个用户只有$2000$b/s。

可以看FDM类似操作系统的并行(同时前进)。TDM类似操作系统的并发(轮流交替)。

- 统计时分复用STDM

  是对时分多路复用TDM的改进。可以明显提高信道利用率。

  <img src="https://image.sybblogs.fun/img-common/202402202104426.png" alt="STDM帧" style="zoom: 25%;" />

  如上图，四台主机$A,B,C,D$发送数据并不是一致连续发送。发送数据频率较低。对于这样一种发送情况常用的就是STDM。

  STDM主要部分有一个集中器，其功能是将四个低速用户连接起来，将四台主机发送的数据几种起来，再通过高速线路发到接收端。另外上面的每一个STDM帧中的时隙数小于连接在集中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序依次扫描输入缓存，把缓存中的输入数据放入STDM帧中，一个STDM帧满了就发出。STDM帧不是固定分配时隙，而是按需动态分配时隙。

  假如一个STDM帧传输率是$8000$b/s，有一个用户会经常传输数据，而其他用户偶尔传输，此时用户传输率就可以到达$8000$b/s。所以STDM信道利用率高。

- 波分多路复用WDM 

  波分多路复用就是光的频分多路复用，在一根光纤中传输多种不同波长(频率)的光信号，由于波长(频率)不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。

  <img src="https://image.sybblogs.fun/img-common/202402202114498.png" alt="WDM" style="zoom:33%;" />

  可以看到与频分多路复用很相似。

- ==码分多路复用CDM==

  <img src="https://image.sybblogs.fun/img-common/202402211354153.png" alt="CDM" style="zoom:33%;" />
  
  上图$A,B$是发送方，$C$是接收方。中间合并线是$A,B$共同使用的公用信道。在频分多路复用FDM情况下$A,B$在这条公用信道上是各占一半的，可以同时发送，不过不能占满这条信道，所以在FDM情况下是共享时间，而非共享空间的方式。而在时分多路复用TDM下同一时间只有一个发送方发送数据，所以在TDM下是共享空间而不是共享时间。而码分多路复用就有点类似波分多路复用WDM，先将所有数据结合在一起，在接收端再对收到的合并数据进行分离。因此难点就在于怎么分离数据。
  
  这里常用的分离方式是码分多址(CDMA，是码分复用的一种方式)。这个CDMA协议也是电信网2G的简称。具体操作方式：
  
  1. 先将$1$个比特分为多个码片$/$芯片(chip)，每一个站点被指定一个唯一的$m$位的芯片序列，发送$1$时发送芯片序列(通常会把$0$写成$-1$)。因为发送一个比特是有时间的，可以称之为$1$比特时隙时间，所以可以将这$1$比特时间分割成$n$位的芯片序列，即分割成$n$个微时隙。
  
     <img src="https://image.sybblogs.fun/img-common/202402211409609.png" alt="CDM原理" style="zoom: 25%;" />
  
     由于在发送的时候这个序列中的$0$通常会写为$-1$。所以比特$1$的芯片序列就要写为$1-1-1+1+1-1+1+1$，用向量$\overline{S}$表示。同理对于$B$的比特$1$序列表示为$\overline{T}(-1-1+1-1+1+1+1-1)$表示。
  
     而对于比特$0$序列要写为反码。假如$\overline{T}$的比特$1=00101110$则转换为比特$0$芯片序列是$11010001=+1+1-1+1-1-1-1+1=-\overline{T}$
  
  2. 接着就是对这两个向量进行线性代数上的运算，让$C$接收端能在混合数据中分离出不同站点数据，所以先让各个站点($A,B$)的芯片序列相互正交，即规格化内积为$0$。假如$\overline{S},\overline{T}$分别为两个站点，$m$为向量分量个数，则它们的规格化内积如下：
     $$
     \overline{S}·\overline{T}=\frac{1}{m}\sum_{i=1}^m\overline{S}_i·\overline{T}_i=0
     $$
     通过计算可以得知$\overline{S}$和$\overline{T}$确实是正交向量，此时就可以发送数据。假如现在$A$端发送比特$1$，即$\overline{S}$，$B$端发送比特$0$，即$-\overline{T}$。
  
     则两个向量到了公共信道上，线性相加。$\overline{S}-\overline{T}=(0,0,-2,2,0,-2,0,2)$。
  
  3. 接着线性相加的数据到了$C$接收端，分离过程：合并的数据和原站点规格化内积：
     $$
     \begin{equation*}
     	\begin{aligned}
     &\overline{S}·(\overline{S}-\overline{T})=1\\
     \\
     &\overline{T}·(\overline{S}-\overline{T})=-1
     	\end{aligned}
     \end{equation*}
     $$
     即$A$站点发送的数据是$1$，$B$站点发送的数据是$0$。
  
  总结CDMA发送过程：
  
  - 使用CDMA的每一个站会事先被指派一个唯一的$m$bit码片序列(如：分配$8$bit，为$00011010$，如果该站要发送$1$，则将该序列$00011010$直接发送出去。若发送$0$，则需要发送该序列的二进制反码，即$11100101$)。
  
    但为了方便，我们会将码片中的$0$写成$-1$，方便后边验证时候计算，上边那个码片就会被写为$-1-1-1+1+1-1+1-1$
  
    注意：CDMA为每个站分配的码片序列不仅不一样，而且还两两相互正交（正交就是两个序列对应位置相乘，然后相加，结果为$0$）
  
  - 每个站每次收到的信息都是各个站的码片序列之和(指的是码片序列对应位置相加，原来有几位，收到的就是几位)
  
    规格化内积：对应位置相乘，再相加，然后除以码片序列长度$m$。如：向量$\overline{S}$为$(-1-1-1+1+1-1+1+1)$，向量$\overline{T}$为$(-1-1+1-1+1+1+1-1)$。$\overline{S}$和$\overline{T}$做规格化内积：
    $$
    \begin{equation*}
    	\begin{aligned}
    &((-1)\times(-1)+(-1)\times(-1)+(-1)\times(+1)+\cdots)/8=0
    	\end{aligned}
    \end{equation*}
    $$
    此过程可以证明不同站之间码片序列两两正交(结果为$0$)。
  
  任何一个码片向量和自己做规格化内积结果都为$1$，和自己反码的向量的规格化内积都为$-1$。这是比较容易想到的
  
  > 所以，我们会用到上边的结论，每次收到信息后，会对各个站的码片序列进行规格化内积，验证该站是否发送了数据，并且发送了什么数据（验证的前提是，接收站得提前知道发送站的码片序列，然后用发送站的码片序列对接收到的消息进行规格化内积，看结果为$0/1$，还是$-1$。这里$0$代表没发送消息，$1$代表发送了比特$1$，$-1$代表发送了比特$0$）

### 4.2 随机访问介质访问控制

随机访问介质访问控制是动态分配信道(动态媒体接入控制$/$多点接入)方式的一种。动态分配信道的特点是：信道并非在用户通信
时固定分配给用户。

随机访问介质访问控制特点是所有用户可随机发送信息。发送信息时占全部带宽。这种随机性会导致不协调的问题，因为所有用户如果都可以随机发送信息，可能有几个用户如果不相互协调，而同时发送信息会导致数据冲突的问题。所以需要有协议来解决这种别协调导致的冲突问题。

#### ALOHA协议

ALOHA协议有两种：纯ALOHA协议、时隙ALOHA协议。其中时隙ALOHA协议是对纯ALOHA协议的改进。

- 纯ALOHA协议思想：不监听信道，不按时间槽发送，随机重发。想发就发。

  <img src="https://image.sybblogs.fun/img-common/202402211536964.png" alt="ALOHA协议" style="zoom:25%;" />

  如上图所示，可以看到每一个站点在任何时间都可以发送数据帧。其中$T_0$规定的是一个数据帧的长度，这里不用比特衡量是因为这里$T_0$表示的是发送时间，发送时间包括传输时间和传播时间，即一个帧从刚开始发送开始，到发送成功时间就是$T_0$。这里假设每个数据$T_0$都是相同的。协议发送过程如下：

  首先对于站点$1$，先发送一个$1$号数据帧。经过$T_0$时间后并没有别的数据帧和$1$号发生冲突，所以发送成功。

  之后站点$2$开始发送$2$号数据帧。可以看到在阴影部分与$3$号数据帧发生冲突。因为信道同时有两个数据帧$2,3$发送。

  **发送冲突检测方式**：如果发生冲突，接收方就会检测出差错，然后不予确认，发送方在一定时间内收不到就判断发生冲突。即等到接收方同时收到$2,3$号数据帧时会发现帧错误，此时接收方会返回一个否定确认帧(NAK)或者不进行回复。这样发送方在计时器超市后会重新发送。

  **所以这里解决冲突方式是**：超时后等一随机时间再重传。直到发送方收到来自接收方的确认帧。

- 时隙ALOHA协议

  可以看到上面纯ALOHA协议随机性太强，导致数据发送成功率低。这里数据发送成功率用**数据吞吐量**表示。

  时隙ALOHA协议的思想：把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。

  <img src="https://image.sybblogs.fun/img-common/202402211547583.png" alt="时隙ALOHA协议" style="zoom:25%;" />

  这里时间片就对应上面的$T_0$。协议特点就是每个站点在发送帧的时候只能在时间片的开始来发送。

  如果结点发送的帧在发送过程中$T_0$时间内，并没有其他数据帧产生冲突，这个帧就成功发送。另一种情况是如果发生碰撞这个结点就会在时隙结束后，即经过一个$T_0$后发送方发现碰撞，从而不会发送确认帧，之后接收方在计时器结束后会重新发送这个帧。

两种协议总结：

1. 纯ALOHA比时隙ALOHA吞吐量更低，效率更低。
2. 纯ALOHA想发就发，时隙ALOHA只有在时间片段开始时才能发。

#### CSMA协议

全称是载波监听多路访问协议CSMA (carrier sense multiple access)。

$CS$：载波侦听$/$监听， 每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据。$MA$：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

> 检测原理：当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大(互相叠加)。当一个站检测到的信号电压摆动值超过一定门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，即发生了冲突。

协议思想：发送帧之前，监听信道。监听结果有两种：信道空闲(发送完整帧)、信道忙(推迟发送)。

对于推迟多久、或者是否立即发送完整帧有三种不同协议：1-坚持CSMA、非坚持CSMA、p-坚持CSMA。

- 1-坚持CSMA

  1-坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

  空闲则直接传输，不必等待。忙则一直监听，直到空闲马上传输。如果有冲突(一段时间内未收到肯定回复)，则等待一个随机长的时间再监听，重复上述过程。

  优点：只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。

  缺点：假如有两个或两个以上的站点有数据要发送，冲突就不可避免。

- 非坚持CSMA

  非坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

  空闲则直接传输，不必等待。忙则等待一个随机的时间之后再进行监听。

  优点：采用随机的重发延迟时间可以减少冲突发生的可能性。

  缺点：可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低。

- p-坚持CSMA

  p-坚持指的是对于监听信道空闲的处理。

  p-坚持CSMA思想：如果一个主机要发送消息， 那么它先监听信道。

  空闲则以$p$概率直接传输，不必等待。概率$1-p$​时等待到下一个时间槽再传输。忙则持续监听直到信道空闲再以$p$概率发送。若冲突则等到下一个时间槽开始再监听并重复上述过程。

  优点：既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间的这种方案。

  如果信道上此时发送冲突，但是并没有检测冲突过程，所以还是会坚持将数据发送完，这时候就导致了数据浪费。

三种CSMA对比总结：

<img src="https://image.sybblogs.fun/img-common/202402211624292.png" alt="三种CSMA协议对比" style="zoom: 25%;" />

#### ==CSMA/CD协议==

载波监听多点接入/碰撞检测CSMA/CD (carrier sense multiple access with collision detection)。

CS：载波侦听/监听，每一个站在发送数据之前以及发送数据时都要检测一下总线上是否有其他计算机在发送数据。MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。应用与总线型网络。CD：碰撞检测(冲突检测)，"边发送边监听"，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据，说明用于与半双工网络(一方发送数据乙方接收数据，但是也可以互换)。

因为电磁波在总线上总是以有限的速率传播的。所以即使当前信道空闲，还是要进行传输。

传播时延对载波监听的影响：

<img src="https://image.sybblogs.fun/img-common/202402211646290.png" alt="传播时延对载波监听的影响" style="zoom:33%;" />

可以看到当$A$给$B$发数据，如果$A$的数据还没有发送到$A$的监听范围之内，此时$B$监听信道结果就是空闲，所以如果$B$再往信道上发送数据就会产生数据冲突问题。

<img src="https://image.sybblogs.fun/img-common/202402211652390.png" alt="传播时延对载波监听的影响2" style="zoom:25%;" />

如上图在数据产生碰撞后仍会到达接收端，两个主机互相发送数据都有在一段时间后到达目的机，即使数据产生碰撞，在双方接收到碰撞数据帧之后都会检测出数据帧出错，所以都会停发。

假设单程端到端的传播延迟是$\tau$。则$A$从$T_0$时刻开始经过一段时间发生碰撞，再经过一段时间B接收到$A$发送的数据。此时接收到这个时间点$t$就是$\tau$，即$t=\tau$，因为$A$段数据发送到$B$端经历了一个传播时延。

若$B$从$t$时刻也开始发送数据，设$t=\tau-\delta$。则可以得出发生碰撞事件结点是$t=\tau-\frac{\delta}{2}$

由于$B$发送时间点是$t=\tau-\delta$，且一个端到端传播时延是$\tau$，所以$A$端接收$B$发送来的数据时间是$2\tau-\delta$。

<img src="https://image.sybblogs.fun/img-common/202402211706506.png" alt="传播时延对载波监听的影响3" style="zoom:25%;" />

最迟多久才能知道自己发送的数据没和别人碰撞?

> 当$\delta$趋近于$0$时，也就是数最迟是$2\tau$时候才能直到数据没和别人碰撞。即==最多是两倍的总线端到端的传播时延($2\tau$)==。
>
> 同理最短知道发送数据碰撞事件是$0$。

$2\tau$也是总线的端到端往返传播时延，也可以叫做争用期$/$冲突窗口$/$碰撞窗口。所以可以得知只要经过$2\tau$时间还没有检测到碰撞，就能肯定这久发送不会发生碰撞。

在CSMA/CD协议中采用截断二进制指数规避算法计算碰撞后重新的发送时机：

1. 确定基本退避(推迟)时间为争用期$2\tau$。
2. 定义参数$k$，它等于重传次数，但$k$不超过$10$，即$k=\min[重传次数,10]$。 当重传次数不超过$10$时，$k$等于重传次数。当重传次数大于$10$时，就不再增大而一直等于$10$。
3. 从离散的整数集合$[0,1,2^k-1]$中随机取出一个数$r$，重传所需要退避的时间就是$r$倍的基本退避时间，即$2r\tau$。
4. 当重传达$16$次仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告出错。

> 第一次重传，$k=1$，r从$\{0,1\}$选，重传推迟时间为$0$或$2\tau$，在这两个时间中随机选一个。
>
> 若再次碰撞，则在第二次重传时，$k=2$，$r$从$\{0,1,2,3\}$中选，重传推迟时间为$0$或$2\tau$或$4\tau$或$6\tau$，在这四个时间中随机选一个。
>
> 若之后再碰撞，则重复上述步骤。当重复$16$次仍不能发送就报错。

可以看出若连续多次发生冲突，就表明可能有较多的站参与争用信道。使用此算法可使重传需要推迟的平均时间随重传次数的增大而增大，因而减小发生碰撞的概率，有利于整个系统的稳定。

例：在以太网的二进制回退算法中，在$11$次碰撞之后，站点会在$0\sim(?)$之间选择一个随机数。

> 可以看到碰撞次数为$11$次，大于$10$此时，所以$k=10$。则$2^k-1=1023$。
>
> 故站点会在$0\sim1023$之间选择一个随机数。

但还有一种情况，假如$A$站发了一个很短的帧但发生了碰撞，不过帧在发送完毕后才检测到发生碰撞，所以没有办法停止发送。为了比卖你这种情况就要定义一个最小帧长，以达到帧发生碰撞及时叫停的目的。

由于帧最晚可以在$2\tau$时间内检测到碰撞，所以可以使帧的传输时延至少要两倍于信号在总线中的传播时延，就可以在检测到碰撞之前帧还没有发完，可以及时叫停。帧的传输时延计算公式：
$$
传输时延=\frac{帧长(bit)}{数据传输速率}\ge 2·总线传播时延(2\tau)
$$
所以可以得出==最小帧长$=2\tau\times数据传输速率$==。

故以太网规定最短帧长为$64$B，凡是长度小于$64$B的都是由于冲突而异常终止的无效帧。

CSMA$/$CD协议总结：

<img src="https://image.sybblogs.fun/img-common/202402211737674.png" alt="CSMACD协议总结" style="zoom: 25%;" />

#### CSMA/CA协议

载波监听多点接入$/$碰撞避免CSMA/CA (carrier sense multiple access with collision avoidance)。

CSMA$/$CA协议用于无线局域网当中。而上面的CSMA$/$CD用于优先网络(以太网)。CSMA$/$CD无法用于无限局域网原因是，无线网络空间大，所以要求全面碰撞检测，同时还会有隐蔽站的问题，即当$A$和$C$都检测不到信号，都认为信道空闲时，同时向终端$B$发送数据帧，就会导致冲突。这里如果$A$发数据给$B$，$C$就相当于一个隐蔽站。

协议工作原理：在发送数据前，先检测信道是否空闲。

1. 如果空闲：则发出RTS (request to send)，RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息。信道忙则等待。接着接收端会收到RTS，同时会向发送端响应CTS(clear to send)。

   上面的RTS和CTS就能很好解决隐蔽站的问题。假如有$A,B,C$三个，$A,C$都要给$B$发送数据，但是目前是希望$A$先能和$B$发送数据。此时$A$会先给$B$发送一个$RTS$，告诉$B$发送端$A$要发送数据。$B$收到$RTS$之后，就会返回给$A$一个CTS。逻辑上相当于两个主机此时建立一个连接。如果$C$此时给$B$发送数据帧，$B$会拒收。

2. 发送端收到CTS后，开始发送数据帧(同时预约信道：发送方告知其他站点自己要传多久数据)。
3. 接收端收到数据帧后，将用CRC循环冗余码来检验数据是否正确，正确则响应ACK帧。
4. 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止(采用二进制指数退避算法来确定随机的推迟时间)。这种重传有上限，具体次数根据系统决定。

CSMA$/$CD与CSMA$/$CA相同点：

CSMA$/$CD与CSMA$/$CA机制都从属于CSMA的思路，其核心是先听再说。换言之，两个在接入信道之前都须要进行监听。当发现信道空闲后，才能进行接入。

CSMA$/$CD与CSMA$/$CA不同点：

1. 传输介质不同：CSMA$/$CD 用于总线式以太网(有线)，而CSMA$/$CA用于无线局域网(无线)。
2. 载波检测方式不同：因传输介质不同，CSMA$/$CD与CSMA$/$CA的检测方式也不同。CSMA$/$CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随着发生变化。而CSMA$/$CA采用能量检测(ED)、载波检测(CS) 和能量载波混合检测三种检测信道空闲的方式。
3. CSMA$/$CD检测冲突，CSMA$/$CA避免冲突，二者出现冲突后都会进行有上限的重传。

### 4.3 轮询访问介质访问控制

回顾：

- 信道划分介质访问控制(MAC Multiple Access Control )协议：基于多路复用技术划分资源。

  在网络负载重情况下：共享信道效率高，且公平。在网络负载轻情况下：共享信道效率低。

- 随机访问MAC协议：冲突用户根据意愿随机发送信息，发送信息时可独占信道带宽。

  在网络负载重情况下：产生冲突开销。在网络负载轻情况下：共享信道效率高，单个结点可利用信道全部带宽。

- 轮询访问MAC协议$/$轮流协议$/$轮转访问MAC协议：既要不产生冲突，又要发送时占全部带宽，所以是拥有上面两种方式所有有点。

上面几种方式只有随机访问MAC协议会发生数据帧冲突。

轮询访问MAC协议常见的有两类：轮询协议、令牌传递协议。

#### 轮询协议

原理：主结点轮流"邀请"从属结点发送数据。

<img src="https://image.sybblogs.fun/img-common/202402211817692.png" alt="轮询协议" style="zoom: 25%;" />

如上图，主节点会一个个询问四个主机是否具有消息发送，在没有询问到的主机即使有数据也不能发送。询问过程其实就是发送一个数据帧，这个数据帧较短，只是用来询问。

可以看到这种协议方式不会产生数据冲突。同时一次询问主机会让一台主机占用一个信道，这台主机享用整条信道带宽。

问题：

1. 有轮询开销

   如上图有四个主机和一个主节点。如果主机个数很多，主节点就需要多次轮询询问。这个询问时间会有较大的开销。

2. 等待延迟

   越靠后的主机等待时间越长。

3. 单点故障

   如果主节点宕机，则整个网络系统都会瘫痪。实际中会建立多个备用主机当主节点，当一个主节点宕机，备用节点可以替代当主节点。

#### 令牌传递协议

<img src="https://image.sybblogs.fun/img-common/202402211829027.png" alt="令牌协议" style="zoom: 25%;" />

上图是令牌协议常用的令牌环网，在逻辑上是环形结构，但在物理上是星型结构。TCU转发器其实就是在传递数据帧时的转发接口，可以传递所有经过的帧，而且为接入栈发送和接收数据提高一个接口。

这里的令牌是一个特殊格式的MAC控制帧，不含任何信息。可以控制信道的使用，确保同一时刻只有一一个结点独占信道。

执行原理：

如上图所示，假如当前令牌环网中所有主机都是空闲的，那么令牌会在网络中一直循环传递，直到传递到有一个主机需要发送数据。在主机拿到令牌后首先要对令牌的标志位进行修改，这个修改意义是将令牌从空闲状态变为使用状态。然后在令牌的控制帧之后加上数据，因此就构成一个令牌数据帧。然后会将令牌发送出去，这个发送过程也是环状发送，没经过一个主机都会检查其中地址，如果地址不对应就会传递给下一个主机，直到发送到目的主机手中。目的主机会复制一份令牌帧，接着传递下一个主机，直到最后令牌回到发送端主机。

此时发送端主机要检查令牌帧是否出错，如果出错要进行重传，没有出错就会将令牌内的帧回收，并将令牌改回闲置状态。继续传递给下一条主机。之后要发送数据的主机步骤如上。

所以每个结点都可以在一定的时间内(令牌持有时间)获得发送数据的权利，并不是无限制地持有令牌。

问题：

1. 令牌开销

   有的时候令牌会在传输过程中消失，此时会重新产生一个令牌。

2. 等待延迟

   假如主机$D$在发送数据，但是主机$A$也要发送数据，此时就要一直等待令牌到自己这里才能发送。

3. 单点故障

   如果其中一台主机宕机，那么环就会断掉。解决方法是用备用机。

这种采用令牌传送方式的网络常用于负载较重、通信量较大的网络中。

介质访问控制总结：

<img src="https://image.sybblogs.fun/img-common/202402211856565.png" alt="介质访问控制总结" style="zoom: 25%;" />

## 5. 局域网基本概念和体系结构

局域网(Local Area Network)：简称LAN，是指在某一区域内由多台计算机互联成的计算机组，使用**广播信道**。

特点：

1. 覆盖的地理范围较小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内。
2. 使用专门铺设的传输介质(双绞线、同轴电缆)进行联网，数据传输速率高($10$Mb/s$\sim10$Gb/s)。

3. 由于覆盖地理范围小，通信延迟时间短，误码率低，可靠性较高。
4. 各站为平等关系，共享传输信道。
5. 多采用分布式控制和广播式通信，能进行广播和组播。

局域网以上特点是由网络拓扑，传输介质与介质访问控制方法，三个要素组成的。

网络拓扑分为四种：星型拓扑、总线型拓扑、环形拓扑、树型拓扑

<img src="https://image.sybblogs.fun/img-common/202402211919399.png" alt="局域网拓扑结构" style="zoom:25%;" />

- 星型拓扑

  中心节点是控制中心，任意两个节点间的通信最多只需两步，传输速度快，并且网络构形简单、建网容易、便于控制和管理。但这种网络系统，网络可靠性低，网络共享能力差，有单点故障问题。

- 总线型拓扑

  网络可靠性高、网络节点间响应速度快、共享资源能力强、设备投入量少、成本低、安装使用方便，当某个工作站节点出现故障时，对整个网络系统影响小。

  是一种常用的拓扑结构。

- 环形拓扑

  系统中通信设备和线路比较节省。有单点故障问题。由于环路是封闭的，所以不便于扩充，系统响应延时长，且信息传输效率相对较低。

- 树型拓扑

  易于拓展，易于隔离故障，也容易有单点故障。

局域网按照传输介质可以分为有线局域网和无线局域网。

有线局域网常用介质：双绞线、同轴电缆、光纤。无线局域网常用介质：电磁波。

局域网介质访问控制方法：

1. CSMA$/$CD

   常用于总线型局域网，也用于树型网络。

2. 令牌总线

   常用于总线型局域网，也用于树型网络。结合令牌传递和总线网络特点。

   它是把总线型或树型网络中的各个工作站按一定顺序如按接口地址大小排列形成一个逻辑环。只有令牌持有者才能控制总线，才有发送信息的权力。

3. 令牌环

   用于环形局域网，如令牌环网。

局域网分类：

1. 以太网

   以太网是应用最为广泛的局域网，包括标准以太网($10$Mbps)、快速以太网($100$Mbps)、千兆以太网($1000$Mbps)和$10$G以太网，它们都符合IEEE802.3系列标准规范。逻辑拓扑总线型，物理拓扑是星型或拓展星型。使用CSMA$/$CD。

2. 令牌环网

   物理上采用了星形拓扑结构，逻辑上是环形拓扑结构。由于造价贵，已是"明日黄花"。

3. FDDI网 (Fiber Distributed Data Interface)

   物理上采用了双环拓扑结构，逻辑上是环形拓扑结构。

4. ATM网(Asynchronous Transfer Mode)

   较新型的单元交换技术，使用$53$字节固定长度的单元进行交换。

5. 无线局域网(Wireless Local Area Network; WLAN)

   采用IEEE 802.11标准。平时的WiFi是无线局网的一种应用。

可以看到上面很多标准都是IEEE802标准。IEEE 802系列标准是IEEE 802 LAN$/$MAN标准委员会制定的局域网、城域网技术标准(1980年2月成立)。其中最广泛使用的有以太网、令牌环、无线局域网等。这一系列标准中的每一个子标准都由委员会中的一个专门工作组负责。

重要标准有以下几个：

- IEEE 802.3：以太网介质访问控制协议(CSMA$/$CD)及物理层技术规范。
- IEEE 802.5：令牌环网(Token-Ring)的介 质访问控制协议及物理层技术规范。
- IEEE 802.8：光纤技术咨询组，提供有关光纤联网的技术咨询。即FDDI网。
- IEEE802.11：无线局域网(WLAN)的介质访问控制协议及物理层技术规范。

MAC子层和LLC子层：IEEE802标准所描述的局域网参考模型只对应OSI参考模型的数据链路层与物理层，它将数据链路层划分为逻辑链路层LC子层和介质访问控制MAC子层。

<img src="https://image.sybblogs.fun/img-common/202402211958372.png" alt="LLC子层和MAC子层" style="zoom: 33%;" />

LLC负责识别网络层协议，然后对它们进行封装。LLC报头告诉数据链路层一旦帧被接收到时，应当对数据包做何处理。为网络层提供服务：无确认无连接、面向连接、带确认无连接、高速传送。

MAC子层的主要功能包括数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，链路的管理，帧的差错控制等。MAC子层的存在屏蔽了不同物理链路种类的差异性。

### 5.1 以太网

是局域网技术的一种。以太网(Ethernet)指的是由Xerox公司创建并由Xerox、Intel和DEC公 司联合开发的基带总线局域网规范，是当今现有局域网采用的最通用的通信协议标准。以太网络使用CSMA$/$CD ( 载波监听多路访阎及冲突检测)技术。

以太网在局域网各种技术中占统治性地位：

1. 造价低廉(以太网网卡不到$100$块)
2. 是应用最广泛的局域网技术;
3. 比令牌环网、ATM网便宜，简单;
4. 满足网络速率要求：$10$Mb/s$\sim10$Gb/s.

以太网两个标准：

1. DIX EthernetV2：第一个局域网产品(以太网)规约。
2. IEEE 802.3：IEEE 802委员会802.3工作组制定的第一个IEEE的 以太网标准(帧格式有一丢丢改动)。

这两个区别在于帧的格式上会有两个字节的微小不同。

以太网提供无连接、不可靠的服务：

- 无连接：发送方和接收方之间无"握手过程"。

- 不可靠：不对发送方的数据帧编号，接收方不向发送方进行确认，差错帧直接丢弃，差错纠正由高层(传输层)负责。

所以以太网只实现无差错接收(丢弃错误帧)，不实现可靠传输。

以太网传输介质发展：粗同轴电缆$\rightarrow$细同轴电缆$\rightarrow$双绞线$+$集线器。

以太网拓扑结构发展：物理拓扑刚开始是总线型结构，再后来是星型拓扑结构。

<img src="https://image.sybblogs.fun/img-common/202402221411514.png" alt="星型拓扑结构" style="zoom: 33%;" />

星型拓扑是现在以太网最常用的物理拓扑。中间有个物理层的集线器，可以对比特进行简单的转发。也就相当于将主机要发送的数据广播出去。所以使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA$/$CD协议。

故以太网拓扑在逻辑上总线型，而物理上是星型。但传统的以太网逻辑上和物理上都是总线型。

#### 10BASE-T以太网

10BASE-T以太网是常见的以太网。10BASE-T是传送基带信号的双绞线以太网，$T$表示采用双绞线，现10BASE-T采用的是无屏蔽双绞线(UTP)，传输速率是$10$Mb$/$s。

物理上采用星型拓扑，逻辑上总线型，每段双绞线最长为100m。采用曼彻斯特编码。

<img src="https://image.sybblogs.fun/img-common/202402221423928.png" alt="10BAASE-T以太网" style="zoom:33%;" />

使用采用CSMA/CD介质访问控制机制。所以10BASE-T以太网数据帧会发生冲突和碰撞。

计算机与外界有局域网的连接是通过**通信适配器**实现的。

<img src="https://image.sybblogs.fun/img-common/202402221425389.png" alt="通信适配器" style="zoom:33%;" />

是在主机箱内部插入的网络接口板，也叫做网络接口卡NIC(network interface card)，即网卡。但是现在网卡一般直接嵌入到主板上。

适配器上装有处理器和存储器(包括RAM和ROM)，而ROM上有计算机硬件地址**MAC地址**。

MAC地址：在局域网中，硬件地址又称为物理地址，或MAC地址。实际上就是标识符，唯一ID。所以每个网卡适配器有一个全球唯一的$48$位二进制地址，前$24$位代表厂家(由IEEE规定)，后24位厂家自己指定。常用$6$个十六进制数表示，如：02-60-8c-e4-b1-21。

#### 以太网MAC帧

最常用的MAC帧是以太网V2的格式。

<img src="https://image.sybblogs.fun/img-common/202402221437878.png" alt="以太网MAC帧" style="zoom:33%;" />

可以看到最上面是网络层的IP数据报，到链路层需要对数据报进行一个封装。对于链路层的封装需要加头(目的地址、源地址、类型)加尾(FCS)。为了使接收端和发送端保持一个接收同步，就需要在MAC层往物理层传递的帧前面插入一个$8$B的前导码。

这个前导码前面七个字节叫做前同步码。都是由$10$组成的。而最后$1$B最后两位是$11$。具体意思就是前面$1010\cdots$可以使发送方和接收方能够进行时钟同步。最后一个字节的后两位$11$就是发送方告诉接收方现在可以准备接收MAC帧了。这个前导码不属于MAC帧。

以太网MAC帧包括：前面$6$B是目的地址、之后$6$B是源地址。目的地址会有三种情况：第一种情况就是单播地址(专有MAC地址)，假如要发送给一个固定主机，这个主机的MAC地址就是目的地址。第二种情况目的地址可能是一个广播地址，即全$1$的地址，这样地址会发送给所有的主机，所有主机看到这样一个地址都会接收下来。第三种情况就是多播地址，了解即可。

后面还会有$2$B的类型，类型就是为了指明上面网络层使用的协议，以便把收到的MAC帧数据上交给上一层协议。

第四个就是数据部分，是最关键的部分。数据部分的长度是可变的($46\sim1500$)。最后$4$BFCS就是之前CRC循环冗余检验的序列。

与IEEE 802.3的区别：

1. IEEE802.3中MAC帧第三个字段是长度$/$类型
2. IEEE802.3规定当长度$/$类型字段值小于$0x0600$时，数据字段必须装入LLC子层。

#### 高速以太网

速率$\ge100$Mb/s的以太网称为高速以太网。主要包括：

1. 100BASE-T以太网

   在双绞线上传送100Mb/s基带信号的星型拓扑以太网，仍使用IEEE802.3的CSMA/CD协议。

   支持全双工和半双工，可在全双工方式下工作而无冲突。这里全双工形式如下：

   <img src="https://image.sybblogs.fun/img-common/202402221516537.png" alt="全双工" style="zoom:33%;" />

   可以看到星型拓扑中间节点变为交换机，每一个交换机端口就是一个冲突域。因此一个主机在一个冲突域中既能发送数据又可以接收数据不会发生冲突。所以在全双工情况下不使用CSMA$/$CD协议。

2. 吉比特以太网

   在光纤或双绞线上传送1Gb/s信号。支持全双工和半双工，可在全双工方式下工作而无冲突。

3. $10$吉比特

   10吉比特以太网在光纤，上传送10Gb/s信号。采用介质是光纤。只支持全双工，无争用问题。

以太网总结：

<img src="https://image.sybblogs.fun/img-common/202402221520757.png" alt="以太网总结" style="zoom: 25%;" />

### 5.2 无线局域网

先来看一下IEEE802.11标准：IEEE 802.11是无线局域网通用的标准，它是由IEEE所定义的无线网络通信的标准。

<img src="https://image.sybblogs.fun/img-common/202402221524618.png" alt="IEEE标准" style="zoom:33%;" />

上图是IEEE802.11的多个标准，对该标准进行完善和扩充。WiFi协议需要满足802.11b和802.11g所定义的标准。

802.11的MAC帧头格式：因为MAC帧的长度较长，且IEEE802.11当中MAC帧的各个字符种类很多，所以这里只讲述MAC帧头。

<img src="https://image.sybblogs.fun/img-common/202402221528298.png" alt="MAC帧头" style="zoom:33%;" />

假如现在有两台主机$A$和$B$要进行通信，主机$A$附近有一个基站$AP1$，$B$附近有一个基站叫做$AP2$。这里的$AP$即指无线接入点也称作基站。此时$A$给$B$发消息，这个消息会先通过电磁波发给$AP1$，之后$AP1$再发给$AP2$，之后$AP2$再以电磁波形式发送给主机$B$。

上图是一个MAC帧头，解释如下：

- 地址$1$是RA，指接收端

  接收端即上面例子的$AP2$，即$AP2$的MAC地址

- 地址$2$是TA，指发送端

  发送端即上面例子的$AP1$，即$AP1$的MAC地址

- 地址$3$是DA，指目的地址

  这里目的地址即上面例子中$B$的MAC地址。

- 地址$4$是SA，指源地址

  这里源地址即上面例子中$A$的MAC地址。

上面是IEEE802.11一种帧类型，还有以下几种：

<img src="https://image.sybblogs.fun/img-common/202402221554207.png" alt="MAC帧头格式" style="zoom:33%;" />

刚才四种地址帧格式就是WDS(无限分布式系统)。前面三种格式只有三个地址。`BSSID`是基站地址。

上面WDS就是不同服务集内的两个移动站之间的通信(漫游)。IBSS就是一个服务集内的移动站点不通过基站的直接通信。To AP就是服务集内的移动站点向基站的通信。From AP 就是服务集内基站向移动站的通信。

无线局域网分类：	

1. 有固定基础设施无线局域网

   <img src="https://image.sybblogs.fun/img-common/202402221613950.png" alt="有固定基础设施无线局域网" style="zoom: 25%;" />

   可以看到假如一个主机要给基站内部的主机通信，实现起来很简单。发送端只用发送数据帧给基站，基站根据数据帧找到目的主机发送即可。因此一个基本覆盖范围就是基本服务集(BSS)。所有主机在本BSS中都可以进行直接通信。

   但是有两台基本服务集，且两台主机要进行跨区域通信，此时就要借助分配系统DS。假如上图左边$A$主机要给右边BSS中的$B$主机进行通信。$A$先将数据发送给本地基站，所有基站都会接入在有线的线缆上，即分配系统。数据会经过DS分配到目的主机$B$附近的基站中，在由主机$B$所在本地基站转发给主机$B$。这就实现了有线和无线结合的通信过程。

   这样几个基本服务集(BSS)组合在一起就形成一个扩展服务集ESS。如家庭网络WiFi名叫服务集标识符，每一个WiFi都是一个无线接入点，对应一个基站。

2. 无固定基础设施无线局域网的自组织网络

   <img src="https://image.sybblogs.fun/img-common/202402221622745.png" alt="无固定基础设施无线局域网" style="zoom:25%;" />

   指没有任何转发设备，如集线器、转发器、路由器、基站等设备。只有一些主机组成一个网络。每一台主机都快有充当主机以及路由器的功能，即每台主机既可以发送数据，也可以帮忙转发数据，各个结点之间的地位相同。

## 6. VLAN基本概念与原理

传统局域网有一定的局限性：

1. 缺乏流量隔离：即使把组流量局域化道一个单一交换机中，广播流量仍会跨越整个机构网络(ARP、RIP、DHCP协议)。即一个主机发送广播帧，其他主机都可以收到。

   <img src="https://image.sybblogs.fun/img-common/202402221645783.png" alt="传统局域网局限" style="zoom:25%;" />

2. 管理用户不便：如果一个主机在不同组间移动，必须改变物理布线，连接到新的交换机上。
3. 路由器成本较高：局域网内使用很多路由器花销较大。

解决以上问题需要引入VLAN概念：虚拟局域网VLAN (Virtual Local Area Network)是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组有某些共同的需求。每个VLAN是一个单独的广播域$/$不同的子网。

<img src="https://image.sybblogs.fun/img-common/202402221651294.png" alt="VLAN划分" style="zoom: 25%;" />

经过VLAN划分，一个局域网中可以划分出两个广播域。而且不仅可以在一个交换机所连接的主机上进行划分，可以在一个大的局域网中进行划分。如上图，每一个局域网内部有划分为两个虚拟机局域网VLAN1和VLAN2。

VLAN实现：

<img src="https://image.sybblogs.fun/img-common/202402221709593.png" alt="VLAN实现" style="zoom: 33%;" />

如上图，交换机四个端口连接了四台主机。$1,2$端口连接的$A,B$主机处于VLAN1中。$3,4$端口连接的$C,D$主机处于VLAN2中。此时让$A$主机和$C$主机进行通信，即处于两个不同局域网设备进行通信，现在不能直接进行通信，因为进行虚拟局域网划分后，本质上就是两个子网。不同子网需要借助交换机或者路由器才能实现通信。交换机内部有一个转发表，基于MAC地址和端口映射关系：

<img src="https://image.sybblogs.fun/img-common/202402221717935.png" alt="VLAN实现映射表" style="zoom: 33%;" />

当前$A$主机连接在$1$端口，$B$主机连接在$2$端口，如上图所示。除此之外交换机还有虚拟局域网功能，所以还有一个VLAN表：

<img src="https://image.sybblogs.fun/img-common/202402221718755.png" alt="VLAN表" style="zoom:33%;" />

上图的VLAN ID指的是处于哪个虚拟局域网当中。端口与之前一样。假如$A$发送数据给$B$主机，也就是$1$号端口对应的是`VLAN ID=1`。此时交换机直到主机$A$数据只能发送给VLAN1中其他主机，即主机$B$。具体过程是$A$数据到交换机，交换机查看转发表中$B$对应的端口，当前是$2$，交换机会到VLAN表中查看$2$号端口对应的VLAN ID是不是和$A$对应在同一个虚拟局域网中，因此就可以直接转发给主机$B$。

以上这种实现方法是基于接口的VLAN技术。同时还有基于MAC地址的VLAN技术：

<img src="https://image.sybblogs.fun/img-common/202402221724647.png" alt="MAC交换技术" style="zoom:33%;" />

可以看到交换机VLAN表变了，右边变为MAC地址。原理同上。

上面是交换机内部虚拟局域网通信，下面看交换机和交换机之间如何进行通信：

<img src="https://image.sybblogs.fun/img-common/202402221729247.png" alt="VLAN多个交换机之间通信" style="zoom: 25%;" />

假如$A$发送数据给$E$，首先$A$会准备好一个数据帧，到了交换机$1$中会知道这个帧从VLAN1过来，因此会在帧上附加一个字段，即`tag=1`，表示的是当前数据帧属于VLAN1的。接着这个新的数据帧会通过链路发送给交换机$2$。之后交换机$2$会将受到的数据帧分析，发现这个数据帧属于VLAN1，接下来就只会发给VLAN1当中的一个主机，在结合其他一些MAC地址字段等就知道要发送给VLAN1的$E$主机。

上面增加标签`tag`字段其实就是对数据帧进行改变，再多插入$4$字节的VLAN标记。

<img src="https://image.sybblogs.fun/img-common/202402221738340.png" alt="IEEE802.1Q帧" style="zoom: 25%;" />

VLAN标记的前两个字节表明是IEEE 802.1Q帧，接下来4位没用，后面$12$位是VLAN标识符VID，唯一表示了该以太网帧属于哪个VLAN。

注意：

1. VID的取值范围为$0\sim4095$，但$0$和$4095$都不用来表示VLAN，因此用于表示VLAN的有效VID取值范围为$1\sim4094$。
2. IEEE 802.1Q帧是由交换机来处理的，而不是由用户主机来处理的。(即主机和交换机之间只交换普通的以太网帧)

> 所以可以知道A和E之间可以实现访问，而对于A和D、H之间不能实现访问控制，因为不在一个虚拟局域网内。

注意：虚拟网络建立在网络交换机之上，它以软件方式来实现逻辑工作组的划分与管理。

## 7. 广域网及其相关协议

广域网(WAN, Wide Area Network)，通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个城市或国家，或横跨几个洲并能提供远距离通信，形成国际性的远程网络。

广域网的通信子网主要使用分组交换技术。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将分布在不同地区的局域网或计算机系统互连起来，达到资源共享的目的。如因特网(Internet)是世界范围内最大的广域网。

<img src="https://image.sybblogs.fun/img-common/202402221922885.png" alt="广域网" style="zoom:25%;" />

如上图，中间是大型广域网，旁边是连接两个局域网，从而实现相隔很远的局域网的互连。中间连接结点是结点交换机，是链路层设备，该设备和路由器功能很像，但要注意结点交换机只能在单个网络中转发分组，路由器可以在多个网络之间转发分组。

广域网和局域网一大区别是：广域网所覆盖的网络结构体系层次从链路层一直到网络层。但是局域网只覆盖链路层和物理层，这两个层次。并且局域网普遍采用多点接入技术，广域网通常采用点对点，一个发送端一个接收端通过链路相连这样一种全双工或半双工通信模式。广域网强调资源共享，局域网强调数据传输。

目前最常用两种广域网协议是：PPP协议和HDLC协议

### 7.1 PPP协议

点对点协议PRP(Pont-to-Point Protocol)是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般都使用PPP协议。PPP协议和之后要学习的HDLC协议都只支持全双工链路。

PPP协议应满足的要求：

1. 简单

   对于链路层的帧， 无需纠错，无需序号，无需流量控制。

2. 封装成帧

   要在帧头和帧尾加上帧定界符

3. 透明传输

   与帧定界符一样比特组合的数据应该如何处理:异步线路(逐个字节发送)用字节填充，同步线路(一位一位比特发送)用比特填充。

4. 多种网络层协议

   封装的IP数据报可以采用多种协议。

5. 多种类型链路

   要满足：串行$/$并行链路， 同步$/$异步链路，电$/$光链路等。

6. 差错检测

   采用CRC循环冗余，发现错误直接丢弃帧即可。

7. 检测连接状态

   检测链路是否正常工作。

8. 最大传输单元

   在PPP协议帧中，数据部分是上层交付下来的IP数据报，所以对于这样的数据部分有一个最大传送单元要求MTU，这个MTU不超过$1500$B。

9. 网络层地址协商

   要知道通信双方的网络层地址。即PPP协议需要满足一个通信双方可以通过一些协议来确定双方网络层地址是多少。

10. 数据压缩协商

    PPP发送数据时，需要对数据进行压缩。

PPP协议无需满足要求：

1. 纠错

   只需要检测错误即可

2. 流量控制

   交给上层负责流量控制

3. 序号

   无需对帧编号

4. 不需要支持多点线路

   即PPP协议只需要满足点对点之间的连接过程即可。

PPP协议三个组成部分(PPP协议实现三个功能)：

- 一个将IP数据报封装到串行链路(同步串行$/$异步串行)的方法。
- 链路控制协议LCP：建立并维护数据链路连接。要实现管理身份验证功能。如：拨号上网输入账号和密码。

- 有了LCP协议才有网络控制协议NCP：PPP可支持多种网络层协议，每个不同的网络层协议都要一个相应的NCP来配置，为网络层协议建立和配置逻辑连接。将网络层数据报进行封装给链路层，这一个过程就是NCP负责。

PPP协议工作原理：

<img src="https://image.sybblogs.fun/img-common/202402221946927.png" alt="PPP协议连接" style="zoom:25%;" />

如上图，首先设备之间无链路，即还没有连上网，先要点开宽带连接输入账号密码，如果账号密码正确就相当于建立好了一个物理链路。这个时候通过LCP将物理链路构造成一个LCP链路，接着LCP链路再经过NCP配置协商，形成一个NCP链路。

PPP协议帧格式：

<img src="https://image.sybblogs.fun/img-common/202402221949035.png" alt="PPP帧格式" style="zoom:33%;" />

可以看到PPP帧是以字节为单位的，第一个字节和最后一个字节是$7E$，由十六进制表示。这两个字段就是标志字段，也就是帧定界符。当然也有可能在数据部分就存在八位和帧定界符一样导致出现歧义，这个时候为了实现透明传输就需要插入一个转义字符$7D$。只要在数据信息部分出现帧定界符，就在其前面插入一个转义字符，到了接收端只需要将转义字符去掉即可。

第二部分$A$代表地址字段，这里的地址字段用$FF$表示。与$C$字段一样，设计之处知道现在并没有赋予任何意义。所以$A,C$字段并没有携带PPP帧的任何有用信息。

协议部分用于标识这个IP数据报或者说信息部分是什么类型，类型可能是：IP数据报、LCP的数据、网络层控制数据等。

最后的FCS就是为了实现差错检测，采用CRC循环冗余检验算法安排的$2$B检验序列。

<img src="https://image.sybblogs.fun/img-common/202402222007013.png" alt="PPP协议帧总结" style="zoom:25%;" />

所以可以看到在PPP协议中帧格式是以字节为单位的，所以传输的数据都是整数个字节。因此PPP协议是面向字节的协议。

### 7.2 HDLC协议

高级数据链路控制(High-Level Data Link Control或简称HDLC)，是一个在同步网上传输数据、面向比特的数据链路层协议，它是由国际标准化组织(ISO)根据IBM公司的SDLC(SynchronousData Link Control)协议扩展开发而成的。

数据报文可透明传输，用于实现透明传输的"$0$比特插入法"易于硬件实现。即遇到$5$个$1$就插入一个$0$。与PPP协议不同之处在于这里PPP协议在透明传输上还采用字节填充，即数据部分出现歧义用转义字符。

采用全双工通信。所有帧采用CRC检验，对信息帧进行顺序编号，可防止漏收或重份，传输可靠性高。

HDLC的站：有主站、从站、符合站。

- 主站的主要功能是发送命令(包括数据信息)帧、接收响应帧，并负责对整个链路的控制系统的初启、流程的控制、差错检测或恢复等。
- 从站的主要功能是接收由主站发来的命令帧，向主站发送响应帧，并且配合主站参与差错恢复等链路控制。
- 复合站的主要功能是既能发送，又能接收命令帧和响应帧，并且负责整个链路的控制。

根据这三种站就有三种数据操作方式：

1. 正常响应方式

   假如从站要发送消息，要先经过主站同意。

2. 异步平衡方式

   每一个站都可以进行对别的栈的数据传输。每个站都是平等的地位。

3. 异步响应方式

   从站可以不经过主站同意就可以进行数据传输。

HDLC帧格式：

<img src="https://image.sybblogs.fun/img-common/202402222007492.png" alt="HDLC帧格式" style="zoom: 33%;" />

首位都增加一个标志符字段，而且标志符字段都是一样的二进制数$01111110$。因此如果在透明传输区间有相同比特流形式，就在当中插入一个$0$，即$5$个$1$添加$1$个$0$。

地址为$A$就取决于三种数据操作方式，如果使用正常响应方式和异步响应方式，地址位填充的都是从站的地址。但是如果是异步平衡方式填充的是对应站(应答站)地址。

控制$C$决定了帧的类型：

1. 信息帧(I)第$1$位为$0$，用来传输数据信息，或使用捎带技术对数据进行确认。
2. 监督帧(S)第一位是$1$，第二位是$0$， 用于流量控制和差错控制，执行对信息帧的确认、请求重发和请求暂停发送等功能。
3. 无编号帧(U) 第一位是$1$，第二位是$1$， 用于提供对链路的建立、拆除等多种控制功能。

PPP协议和HDLC协议相同点：

- HDLC、PPP只 支持全双工链路。
- 都可以实现透明传输。PPP协议既可以实现$0$比特填充也可以实现字节填充。HDLC协议只适合$0$比特填充法。

- 都可以实现差错检测，但不纠正差错。

PPP协议和HDLC协议不同点：

<img src="https://image.sybblogs.fun/img-common/202402222019902.png" alt="PPP协议和HDLC协议不同点" style="zoom:33%;" />

可靠传输一般交给传输层。因为现在对于网络速率要求比较高，如果在链路层和网络层还要进行差错检测以及纠正的话，这样花费时间和延迟就更高。所以一般情况下用PPP协议多。

PPP协议和HDLC协议总结：

<img src="https://image.sybblogs.fun/img-common/202402222023167.png" alt="PPP协议和HDLC协议总结" style="zoom:25%;" />

## 8. 链路层设备

根据之前的学习可以知道主机和集线器之间的距离不能很远，一把不超过$100$m，如果超过$100$m失帧就非常严重，难以恢复。所以为了能使距离远的主机之间进行通信就要在物理层将这个以太网进行扩展。

第一种方式就是采用光纤方式，由于光纤信号损耗很小，所以可以采用光纤扩展以太网范围，使得两台主机通信的距离可以变得更远。

<img src="https://image.sybblogs.fun/img-common/202402222030327.png" alt="物理层扩展以太网" style="zoom:33%;" />

如上图，光纤需要有一个调制器和解调器，将电信号转换为光信号，在光纤上传输，之后再将光信号通过解调器转换为电信号传给集线器

第二种方法就是利用集线器将很多集线器再组合起来，这样每一个集线器所构成的区域就是冲突域。冲突域指的是在物理层设备所连接的主机之内进行通信的话，同一时间只能有一台主机发送信息。

<img src="https://image.sybblogs.fun/img-common/202402222035489.png" alt="主干集线器" style="zoom:33%;" />

这样做的好处在于，可以实现跨域通信，一台主机可以和很远另一台在主干集线器下的设备进行通信。同时扩大了以太网地理范围。但是这样也有缺点，原本冲突域内只有四台主机，发生冲突可能性比较小。但是当前主干集线器导致冲突增加。因此导致实际通信效率变低。

为了实现冲突小，而且能扩大以太网范围，可以在链路层对以太网进行扩展。主要使用网桥和交换机。

### 8.1 网桥

网桥根据MAC帧的目的地址对帧进行转发和过滤。当网桥收到一个帧时，并不向所有接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口，或者是把它丢弃(即过滤)。

与集线器区别是，集线器会通过所有端口转发出去，而网桥会选择端口进行转发，如果端口都不能转发会直接丢弃掉。

<img src="https://image.sybblogs.fun/img-common/202402222046397.png" alt="网桥" style="zoom:33%;" />

如上图，网桥将几个以太网进行连接，形成一个更大的以太网。而原来的每一个以太网就是一个冲突域。或称为网段。

<img src="https://image.sybblogs.fun/img-common/202402222047555.png" alt="网桥冲突域" style="zoom: 25%;" />

网段：一般指一个计算机网络中使用同一物理层设备(传输介质，中继器，集线器等)能够直接通讯的那一部分。

使用网桥优点：

1. 过滤通信量，增大吞吐量。

   可以将各个冲突域分割开，如上图A和B通信同时E也能和F进行通信。

   假如每一个网段数据传输速率(带宽)是$10$Mb/s。则三个网段总共吞吐量就是$30$Mb/s。

2. 扩大了物理范围。

3. 提高了可靠性。

   当网络出现故障时，通常只会一个网段受到影响。

4. 可互连不同物理层、不同MAC子层和不同速率的以太网。

网桥可以分为两类：透明网桥和源路由网桥。

- 透明网桥

  透明网桥：透明指以太网上的站点并不知道所发送的帧将经过哪几个网桥，是一种即插即用设备，工作通过自学习算法进行。

  <img src="https://image.sybblogs.fun/img-common/202402222055259.png" alt="透明网桥" style="zoom:33%;" />

  如上图六台主机通过两个网桥进行连接，连接好后网桥就会产生一个转发表(地址$+$接口)。自学习就是在通信的过程中逐步填满这个空的转发表。

  假设A给B发送数据帧，因此A发送的数据会通过链路广播出去，B可以收到。同时数据也会传到网桥接口处，这里定义网桥左边是接口$1$，右边是接口$2$。此时A发出的数据被网桥接口$1$接收，网桥会根据收到的帧来找应该从哪个接口转发出去，或是直接丢弃。具体是网桥会先按照原地址，即A的MAC地址查找转发表，由于转发表中并没有A的地址，于是就将这个地址$A$和收到数据帧的接口$1$写入转发表当中。

  <img src="https://image.sybblogs.fun/img-common/202402222115415.png" alt="透明网桥原理" style="zoom: 25%;" />

  如果之后哪一台主机再给$A$发送数据，网桥查询转发表就可以知道应该从$1$号接口发出去。

  接着再按照目的地址$B$来查找转发表，发现转发表中没有B地址，于是通过除了$1$接口之外的所有接口转发出去，即从网桥$2$接口转发出去，这个数据帧会到$C,D$两个主机，这两个主机发现并不是传输给自己的所以会直接丢弃。之后数据帧会通过链路到第二个网桥$1$接口网桥$2$会查找转发表有没有源地址$A$，如果没有就将源地址$A$，即哪个接口收到数据帧写入，这里是$1$号接口。接着网桥$2$会在转发表中查找有没有目的地址$B$的。如果没有数据帧就会从$2$接口转发出去。此时$A$发送数据给$B$过程结束。

  之后如果$F$给$C$发送数据，首先$F$发送的数据帧会从$2$号网桥接口$2$。$2$号网桥对比转发表寻找源地址$F$，发现没有则写入。接着查询有没有包含目的地址$C$信息，发现也没有，之后会直接通过$2$号网桥$1$接口转发出去。

  <img src="https://image.sybblogs.fun/img-common/202402222136993.png" alt="透明网桥原理2" style="zoom: 25%;" />

  接着数据帧会在网段中广播给$C,D$两个主机，虽然$C$主机此时已经接收到目的帧，但是发送仍然没有停止。数据帧之后从$1$号网桥的$2$接口传入，$1$号网桥会查询转发表中源地址和目的地址，没有则将源地址写入。

  <img src="https://image.sybblogs.fun/img-common/202402222139613.png" alt="透明网桥原理3" style="zoom:25%;" />

  之后从$1$号网桥$1$接口广播出数据帧，至此$F$发送数据给$C$主机执行结束。

  如果此时$B$要给$A$发送数据，首先数据帧会通过链路广播给到当前网段的所有主机。同时数据帧也会传播到$1$号网桥的$1$接口中。网桥$1$会查询自己的转发表中有没有源地址$B$，没有则写入。

  <img src="https://image.sybblogs.fun/img-common/202402222143132.png" alt="透明网桥原理4" style="zoom:25%;" />

  接着网桥会查询目的地址$A$，结果在转发表中发现目的地址$A$，其对应的接口是$1$，最后网桥$1$会将这个帧丢弃。因为知道$A$已经接收到数据帧。

  总结：发送端发送数据到接收端流程如下：

  1. 首选会通过链路广播给到当前网段的所有主机。无论当前网段是否存在目的主机(目的主机已经接收到)都会执行以下步骤。
  2. 接着数据帧通过网桥一个接口进入，网桥根据转发表查询源地址(发送端地址)，如果没有查到则将`源地址+哪个接口收到数据帧`写入转发表。之后网桥会接着在转发表中查询目的主机(接收端地址)，如果没有查到则将数据从另一个接口广播出去。
  3. 如果源地址$/$目的地址查到则网桥会将数据帧与转发表中对应接口值处转发出去。如果接口的值是接收到数据帧的接口号，则直接将该数据帧丢弃(证明数据帧已经被目的主机收到)。

  这个转发表并不是一成不变的，会有刷新时间。

- 源路由网桥

  指在发送帧时，把详细的最佳路由信息(路由最少$/$时间最短)放在帧的首部中。

  方法：源站以广播方式向欲通信的目的站发送一个**发现帧**。

  <img src="https://image.sybblogs.fun/img-common/202402222147585.png" alt="源路由网桥" style="zoom: 33%;" />

  上图迷宫可以类比实际中复杂网络。源站的发现帧会以广播方式在迷宫中进行传播。此时发现帧会有多条路径从起点到终点，每次一条路径到达终点，重点目的站会发送一个响应帧(或者发现帧会原路返回)。所以可以得到$n$种路径。这$n$种路径中一定有经过路由最少的或者时间最短的。就将这条路径信息作为最佳路由信息放在帧的首部，以后只要是发送的数据帧源站和目的站是已经找到最佳路由信息，就可以直接发送。

### 8.2 以太网交换机

又叫多端口多接口网桥。

<img src="https://image.sybblogs.fun/img-common/202402222055259.png" alt="透明网桥" style="zoom: 25%;" />

随着技术发展，每个网桥接口变得越来越多，这样一个网桥就变为以太网交换机。以太网交换机通常会有十几个端口(接口)。每一个端口都可以连接集线器或者直接连在主机上。

<img src="https://image.sybblogs.fun/img-common/202402222155887.png" alt="以太网交换机" style="zoom: 25%;" />

与网桥原理一样，每一个端口都是一个冲突域。

<img src="https://image.sybblogs.fun/img-common/202402222156027.png" alt="以太网交换机2" style="zoom: 25%;" />

但是以太网独占传输媒体带宽。假如上图中一个冲突域的带宽是$10$Mb/s。集线器下有四台主机，那么每个主机能分到的带宽是$2.5$Mb/s。但是如果以太网交换机带宽是$10$Mb/s，那么每个集线器，集线器下的主机都是$10$Mb/s。

以太网交换机的两种交换方式：直通式交换机和存储转发式交换机。

- 直通式交换机

  只检查帧的目的地址。目的地址长度是$6$B，检查完就立即出发。

  延迟小，但是可靠性低(不会对错误帧进行检查)，无法支持具有不同速率的端口的交换。

- 存储转发式交换机

  将帧放入高速缓存，并检查否正确，正确则转发，错误则丢弃。

  可靠性高，可以支持具有不同速率的端口的交换，但是延迟大。是生活中经常使用的。

无论用哪一种交换方式最终都是希望交换机能够找到一个转发的端口，才把这个数据帧转发出去。而交换机转发机制与网桥自学习功能几乎一致，唯一不同的是交换机接口有多个。

<img src="https://image.sybblogs.fun/img-common/202402222206923.png" alt="交换机自学习功能" style="zoom: 25%;" />

此时如果$A$要发送地址给$B$，则数据帧通过$1$号接口输入，交换机会查询转发表中是否有源地址$A$对应的接口值，没有则加入该信息。

<img src="https://image.sybblogs.fun/img-common/202402222209767.png" alt="交换机自学习功能2" style="zoom:25%;" />

接着交换机查询目的地址$B$有没有在转发表中，没有则交换机会通过广播从$2,3,4$号端口将数据帧发送出去，此时$B$接收到数据帧，而$D,C$会将数据帧丢弃。

之后如果$B$要发送数据给$A$，交换机会通过$2$号接口将$B$源地址记录到转发表中，之后查询目的地址$A$，查到对应的接口是$1$，则数据帧直接从$1$号接口转发出去。

<img src="https://image.sybblogs.fun/img-common/202402222213891.png" alt="交换机自学习功能3" style="zoom:25%;" />

转发表中每一个表项都会设置一个生存周期，当超过生存周期就会被删除，这是为了及时刷新转发表。

冲突域与广播域：

冲突域：在同一个冲突域中的每一个节点都能收到所有被发送的帧。简单的说就是同一时间内只能有一台设备发送信息的范围。

广播域：网络中能接收任一设备发出的广播帧的所有设备的集合。简单的说如果站点发出一个广播信号，所有能接收收到这个信号的设备范围称为一个广播域。

<img src="https://image.sybblogs.fun/img-common/202402222218921.png" alt="冲突域与广播域" style="zoom:25%;" />

例子：下图有几个冲突域与广播域

<img src="https://image.sybblogs.fun/img-common/202402222219025.png" alt="冲突域与广播域2" style="zoom: 33%;" />

> 一个广播域，四个冲突域(物理层设备集线器无法分割冲突域)。

链路层设备总结：

<img src="https://image.sybblogs.fun/img-common/202402222220742.png" alt="链路层设备总结" style="zoom: 33%;" />

